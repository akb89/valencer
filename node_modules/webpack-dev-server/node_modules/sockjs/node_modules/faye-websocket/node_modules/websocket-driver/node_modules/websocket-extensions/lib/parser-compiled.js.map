{"version":3,"sources":["parser.js"],"names":[],"mappings":"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","file":"parser-compiled.js","sourcesContent":["'use strict';\n\nvar TOKEN    = /([!#\\$%&'\\*\\+\\-\\.\\^_`\\|~0-9a-z]+)/,\n    NOTOKEN  = /([^!#\\$%&'\\*\\+\\-\\.\\^_`\\|~0-9a-z])/g,\n    QUOTED   = /\"((?:\\\\[\\x00-\\x7f]|[^\\x00-\\x08\\x0a-\\x1f\\x7f\"])*)\"/,\n    PARAM    = new RegExp(TOKEN.source + '(?:=(?:' + TOKEN.source + '|' + QUOTED.source + '))?'),\n    EXT      = new RegExp(TOKEN.source + '(?: *; *' + PARAM.source + ')*', 'g'),\n    EXT_LIST = new RegExp('^' + EXT.source + '(?: *, *' + EXT.source + ')*$'),\n    NUMBER   = /^-?(0|[1-9][0-9]*)(\\.[0-9]+)?$/;\n\nvar Parser = {\n  parseHeader: function(header) {\n    var offers = new Offers();\n    if (header === '' || header === undefined) return offers;\n\n    if (!EXT_LIST.test(header))\n      throw new SyntaxError('Invalid Sec-WebSocket-Extensions header: ' + header);\n\n    var values = header.match(EXT);\n\n    values.forEach(function(value) {\n      var params = value.match(new RegExp(PARAM.source, 'g')),\n          name   = params.shift(),\n          offer  = {};\n\n      params.forEach(function(param) {\n        var args = param.match(PARAM), key = args[1], data;\n\n        if (args[2] !== undefined) {\n          data = args[2];\n        } else if (args[3] !== undefined) {\n          data = args[3].replace(/\\\\/g, '');\n        } else {\n          data = true;\n        }\n        if (NUMBER.test(data)) data = parseFloat(data);\n\n        if (offer.hasOwnProperty(key)) {\n          offer[key] = [].concat(offer[key]);\n          offer[key].push(data);\n        } else {\n          offer[key] = data;\n        }\n      }, this);\n      offers.push(name, offer);\n    }, this);\n\n    return offers;\n  },\n\n  serializeParams: function(name, params) {\n    var values = [];\n\n    var print = function(key, value) {\n      if (value instanceof Array) {\n        value.forEach(function(v) { print(key, v) });\n      } else if (value === true) {\n        values.push(key);\n      } else if (typeof value === 'number') {\n        values.push(key + '=' + value);\n      } else if (NOTOKEN.test(value)) {\n        values.push(key + '=\"' + value.replace(/\"/g, '\\\\\"') + '\"');\n      } else {\n        values.push(key + '=' + value);\n      }\n    };\n\n    for (var key in params) print(key, params[key]);\n\n    return [name].concat(values).join('; ');\n  }\n};\n\nvar Offers = function() {\n  this._byName  = {};\n  this._inOrder = [];\n};\n\nOffers.prototype.push = function(name, params) {\n  this._byName[name] = this._byName[name] || [];\n  this._byName[name].push(params);\n  this._inOrder.push({name: name, params: params});\n};\n\nOffers.prototype.eachOffer = function(callback, context) {\n  var list = this._inOrder;\n  for (var i = 0, n = list.length; i < n; i++)\n    callback.call(context, list[i].name, list[i].params);\n};\n\nOffers.prototype.byName = function(name) {\n  return this._byName[name] || [];\n};\n\nOffers.prototype.toArray = function() {\n  return this._inOrder.slice();\n};\n\nmodule.exports = Parser;\n"]}