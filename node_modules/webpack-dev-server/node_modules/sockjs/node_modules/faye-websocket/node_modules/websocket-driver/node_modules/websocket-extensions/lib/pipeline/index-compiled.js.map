{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,OAAS,QAAQ,QAAR,CAAb;IACI,SAAS,QAAQ,UAAR,CADb;;AAGA,IAAI,WAAW,UAAS,QAAT,EAAmB;AAChC,OAAK,MAAL,GAAgB,SAAS,GAAT,CAAa,UAAS,OAAT,EAAkB;AAAE,WAAO,IAAI,IAAJ,CAAS,OAAT,CAAP;AAA0B,GAA3D,CAAhB;AACA,OAAK,QAAL,GAAgB,EAAC,UAAU,KAAX,EAAkB,UAAU,KAA5B,EAAhB;AACD,CAHD;;AAKA,SAAS,SAAT,CAAmB,sBAAnB,GAA4C,UAAS,OAAT,EAAkB,QAAlB,EAA4B,OAA5B,EAAqC;AAC/E,MAAI,KAAK,QAAL,CAAc,QAAlB,EAA4B;AAC5B,OAAK,KAAL,CAAW,UAAX,EAAuB,KAAK,MAAL,CAAY,MAAZ,GAAqB,CAA5C,EAA+C,CAAC,CAAhD,EAAmD,CAAC,CAApD,EAAuD,OAAvD,EAAgE,QAAhE,EAA0E,OAA1E;AACD,CAHD;;AAKA,SAAS,SAAT,CAAmB,sBAAnB,GAA4C,UAAS,OAAT,EAAkB,QAAlB,EAA4B,OAA5B,EAAqC;AAC/E,MAAI,KAAK,QAAL,CAAc,QAAlB,EAA4B;AAC5B,OAAK,KAAL,CAAW,UAAX,EAAuB,CAAvB,EAA0B,KAAK,MAAL,CAAY,MAAtC,EAA8C,CAA9C,EAAiD,OAAjD,EAA0D,QAA1D,EAAoE,OAApE;AACD,CAHD;;AAKA,SAAS,SAAT,CAAmB,KAAnB,GAA2B,UAAS,QAAT,EAAmB,OAAnB,EAA4B;AACrD,OAAK,QAAL,GAAgB,EAAC,UAAU,IAAX,EAAiB,UAAU,IAA3B,EAAhB;;AAEA,MAAI,SAAS,KAAK,MAAL,CAAY,GAAZ,CAAgB,UAAS,CAAT,EAAY;AAAE,WAAO,EAAE,KAAF,EAAP;AAAkB,GAAhD,CAAb;AACA,MAAI,QAAJ,EACE,OAAO,GAAP,CAAW,MAAX,EAAmB,IAAnB,CAAwB,YAAW;AAAE,aAAS,IAAT,CAAc,OAAd;AAAwB,GAA7D;AACH,CAND;;AAQA,SAAS,SAAT,CAAmB,KAAnB,GAA2B,UAAS,SAAT,EAAoB,KAApB,EAA2B,GAA3B,EAAgC,IAAhC,EAAsC,OAAtC,EAA+C,QAA/C,EAAyD,OAAzD,EAAkE;AAC3F,MAAI,QAAQ,KAAK,MAAjB;MACI,IAAQ,MAAM,MADlB;MAEI,OAAQ,IAFZ;;AAIA,SAAO,GAAP,EAAY,MAAM,CAAN,EAAS,OAAT,CAAiB,SAAjB;;AAEZ,MAAI,OAAO,UAAS,KAAT,EAAgB,KAAhB,EAAuB,GAAvB,EAA4B;AACrC,QAAI,UAAU,GAAd,EAAmB,OAAO,SAAS,IAAT,CAAc,OAAd,EAAuB,KAAvB,EAA8B,GAA9B,CAAP;;AAEnB,UAAM,KAAN,EAAa,SAAb,EAAwB,KAAxB,EAA+B,GAA/B,EAAoC,UAAS,GAAT,EAAc,CAAd,EAAiB;AACnD,UAAI,GAAJ,EAAS,KAAK,QAAL,CAAc,SAAd,IAA2B,IAA3B;AACT,WAAK,QAAQ,IAAb,EAAmB,GAAnB,EAAwB,CAAxB;AACD,KAHD;AAID,GAPD;AAQA,OAAK,KAAL,EAAY,IAAZ,EAAkB,OAAlB;AACD,CAhBD;;AAkBA,OAAO,OAAP,GAAiB,QAAjB","file":"index-compiled.js","sourcesContent":["'use strict';\n\nvar Cell   = require('./cell'),\n    Pledge = require('./pledge');\n\nvar Pipeline = function(sessions) {\n  this._cells   = sessions.map(function(session) { return new Cell(session) });\n  this._stopped = {incoming: false, outgoing: false};\n};\n\nPipeline.prototype.processIncomingMessage = function(message, callback, context) {\n  if (this._stopped.incoming) return;\n  this._loop('incoming', this._cells.length - 1, -1, -1, message, callback, context);\n};\n\nPipeline.prototype.processOutgoingMessage = function(message, callback, context) {\n  if (this._stopped.outgoing) return;\n  this._loop('outgoing', 0, this._cells.length, 1, message, callback, context);\n};\n\nPipeline.prototype.close = function(callback, context) {\n  this._stopped = {incoming: true, outgoing: true};\n\n  var closed = this._cells.map(function(a) { return a.close() });\n  if (callback)\n    Pledge.all(closed).then(function() { callback.call(context) });\n};\n\nPipeline.prototype._loop = function(direction, start, end, step, message, callback, context) {\n  var cells = this._cells,\n      n     = cells.length,\n      self  = this;\n\n  while (n--) cells[n].pending(direction);\n\n  var pipe = function(index, error, msg) {\n    if (index === end) return callback.call(context, error, msg);\n\n    cells[index][direction](error, msg, function(err, m) {\n      if (err) self._stopped[direction] = true;\n      pipe(index + step, err, m);\n    });\n  };\n  pipe(start, null, message);\n};\n\nmodule.exports = Pipeline;\n"]}