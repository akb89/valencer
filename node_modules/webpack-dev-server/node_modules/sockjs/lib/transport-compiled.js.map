{"version":3,"sources":["transport.js"],"names":[],"mappings":"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","file":"transport-compiled.js","sourcesContent":["// Generated by CoffeeScript 1.9.3\n(function() {\n  var GenericReceiver, MAP, ResponseReceiver, Session, SockJSConnection, Transport, closeFrame, register, stream, utils, uuid,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  stream = require('stream');\n\n  uuid = require('uuid');\n\n  utils = require('./utils');\n\n  Transport = (function() {\n    function Transport() {}\n\n    return Transport;\n\n  })();\n\n  Transport.CONNECTING = 0;\n\n  Transport.OPEN = 1;\n\n  Transport.CLOSING = 2;\n\n  Transport.CLOSED = 3;\n\n  closeFrame = function(status, reason) {\n    return 'c' + JSON.stringify([status, reason]);\n  };\n\n  SockJSConnection = (function(superClass) {\n    extend(SockJSConnection, superClass);\n\n    function SockJSConnection(_session) {\n      this._session = _session;\n      this.id = uuid.v4();\n      this.headers = {};\n      this.prefix = this._session.prefix;\n    }\n\n    SockJSConnection.prototype.toString = function() {\n      return '<SockJSConnection ' + this.id + '>';\n    };\n\n    SockJSConnection.prototype.write = function(string) {\n      return this._session.send('' + string);\n    };\n\n    SockJSConnection.prototype.end = function(string) {\n      if (string) {\n        this.write(string);\n      }\n      this.close();\n      return null;\n    };\n\n    SockJSConnection.prototype.close = function(code, reason) {\n      return this._session.close(code, reason);\n    };\n\n    SockJSConnection.prototype.destroy = function() {\n      this.end();\n      return this.removeAllListeners();\n    };\n\n    SockJSConnection.prototype.destroySoon = function() {\n      return this.destroy();\n    };\n\n    return SockJSConnection;\n\n  })(stream.Stream);\n\n  SockJSConnection.prototype.__defineGetter__('readable', function() {\n    return this._session.readyState === Transport.OPEN;\n  });\n\n  SockJSConnection.prototype.__defineGetter__('writable', function() {\n    return this._session.readyState === Transport.OPEN;\n  });\n\n  SockJSConnection.prototype.__defineGetter__('readyState', function() {\n    return this._session.readyState;\n  });\n\n  MAP = {};\n\n  Session = (function() {\n    function Session(session_id1, server) {\n      this.session_id = session_id1;\n      this.heartbeat_delay = server.options.heartbeat_delay;\n      this.disconnect_delay = server.options.disconnect_delay;\n      this.prefix = server.options.prefix;\n      this.send_buffer = [];\n      this.is_closing = false;\n      this.readyState = Transport.CONNECTING;\n      if (this.session_id) {\n        MAP[this.session_id] = this;\n      }\n      this.timeout_cb = (function(_this) {\n        return function() {\n          return _this.didTimeout();\n        };\n      })(this);\n      this.to_tref = setTimeout(this.timeout_cb, this.disconnect_delay);\n      this.connection = new SockJSConnection(this);\n      this.emit_open = (function(_this) {\n        return function() {\n          _this.emit_open = null;\n          return server.emit('connection', _this.connection);\n        };\n      })(this);\n    }\n\n    Session.prototype.register = function(req, recv) {\n      if (this.recv) {\n        recv.doSendFrame(closeFrame(2010, \"Another connection still open\"));\n        recv.didClose();\n        return;\n      }\n      if (this.to_tref) {\n        clearTimeout(this.to_tref);\n        this.to_tref = null;\n      }\n      if (this.readyState === Transport.CLOSING) {\n        this.flushToRecv(recv);\n        recv.doSendFrame(this.close_frame);\n        recv.didClose();\n        this.to_tref = setTimeout(this.timeout_cb, this.disconnect_delay);\n        return;\n      }\n      this.recv = recv;\n      this.recv.session = this;\n      this.decorateConnection(req);\n      if (this.readyState === Transport.CONNECTING) {\n        this.recv.doSendFrame('o');\n        this.readyState = Transport.OPEN;\n        process.nextTick(this.emit_open);\n      }\n      if (!this.recv) {\n        return;\n      }\n      this.tryFlush();\n    };\n\n    Session.prototype.decorateConnection = function(req) {\n      var address, headers, i, key, len, ref, remoteAddress, remotePort, socket, x;\n      if (!(socket = this.recv.connection)) {\n        socket = this.recv.response.connection;\n      }\n      try {\n        remoteAddress = socket.remoteAddress;\n        remotePort = socket.remotePort;\n        address = socket.address();\n      } catch (_error) {\n        x = _error;\n      }\n      if (remoteAddress) {\n        this.connection.remoteAddress = remoteAddress;\n        this.connection.remotePort = remotePort;\n        this.connection.address = address;\n      }\n      this.connection.url = req.url;\n      this.connection.pathname = req.pathname;\n      this.connection.protocol = this.recv.protocol;\n      headers = {};\n      ref = ['referer', 'x-client-ip', 'x-forwarded-for', 'x-cluster-client-ip', 'via', 'x-real-ip', 'x-forwarded-proto', 'x-ssl', 'host', 'user-agent', 'accept-language'];\n      for (i = 0, len = ref.length; i < len; i++) {\n        key = ref[i];\n        if (req.headers[key]) {\n          headers[key] = req.headers[key];\n        }\n      }\n      if (headers) {\n        return this.connection.headers = headers;\n      }\n    };\n\n    Session.prototype.unregister = function() {\n      var delay;\n      delay = this.recv.delay_disconnect;\n      this.recv.session = null;\n      this.recv = null;\n      if (this.to_tref) {\n        clearTimeout(this.to_tref);\n      }\n      if (delay) {\n        return this.to_tref = setTimeout(this.timeout_cb, this.disconnect_delay);\n      } else {\n        return this.timeout_cb();\n      }\n    };\n\n    Session.prototype.flushToRecv = function(recv) {\n      var ref, sb;\n      if (this.send_buffer.length > 0) {\n        ref = [this.send_buffer, []], sb = ref[0], this.send_buffer = ref[1];\n        recv.doSendBulk(sb);\n        return true;\n      }\n      return false;\n    };\n\n    Session.prototype.tryFlush = function() {\n      var x;\n      if (!this.flushToRecv(this.recv) || !this.to_tref) {\n        if (this.to_tref) {\n          clearTimeout(this.to_tref);\n        }\n        x = (function(_this) {\n          return function() {\n            if (_this.recv) {\n              _this.to_tref = setTimeout(x, _this.heartbeat_delay);\n              return _this.recv.heartbeat();\n            }\n          };\n        })(this);\n        this.to_tref = setTimeout(x, this.heartbeat_delay);\n      }\n    };\n\n    Session.prototype.didTimeout = function() {\n      if (this.to_tref) {\n        clearTimeout(this.to_tref);\n        this.to_tref = null;\n      }\n      if (this.readyState !== Transport.CONNECTING && this.readyState !== Transport.OPEN && this.readyState !== Transport.CLOSING) {\n        throw Error('INVALID_STATE_ERR');\n      }\n      if (this.recv) {\n        throw Error('RECV_STILL_THERE');\n      }\n      this.readyState = Transport.CLOSED;\n      this.connection.emit('end');\n      this.connection.emit('close');\n      this.connection = null;\n      if (this.session_id) {\n        delete MAP[this.session_id];\n        return this.session_id = null;\n      }\n    };\n\n    Session.prototype.didMessage = function(payload) {\n      if (this.readyState === Transport.OPEN) {\n        this.connection.emit('data', payload);\n      }\n    };\n\n    Session.prototype.send = function(payload) {\n      if (this.readyState !== Transport.OPEN) {\n        return false;\n      }\n      this.send_buffer.push('' + payload);\n      if (this.recv) {\n        this.tryFlush();\n      }\n      return true;\n    };\n\n    Session.prototype.close = function(status, reason) {\n      if (status == null) {\n        status = 1000;\n      }\n      if (reason == null) {\n        reason = \"Normal closure\";\n      }\n      if (this.readyState !== Transport.OPEN) {\n        return false;\n      }\n      this.readyState = Transport.CLOSING;\n      this.close_frame = closeFrame(status, reason);\n      if (this.recv) {\n        this.recv.doSendFrame(this.close_frame);\n        if (this.recv) {\n          this.recv.didClose();\n        }\n        if (this.recv) {\n          this.unregister();\n        }\n      }\n      return true;\n    };\n\n    return Session;\n\n  })();\n\n  Session.bySessionId = function(session_id) {\n    if (!session_id) {\n      return null;\n    }\n    return MAP[session_id] || null;\n  };\n\n  register = function(req, server, session_id, receiver) {\n    var session;\n    session = Session.bySessionId(session_id);\n    if (!session) {\n      session = new Session(session_id, server);\n    }\n    session.register(req, receiver);\n    return session;\n  };\n\n  exports.register = function(req, server, receiver) {\n    return register(req, server, req.session, receiver);\n  };\n\n  exports.registerNoSession = function(req, server, receiver) {\n    return register(req, server, void 0, receiver);\n  };\n\n  GenericReceiver = (function() {\n    function GenericReceiver(thingy) {\n      this.thingy = thingy;\n      this.setUp(this.thingy);\n    }\n\n    GenericReceiver.prototype.setUp = function() {\n      this.thingy_end_cb = (function(_this) {\n        return function() {\n          return _this.didAbort();\n        };\n      })(this);\n      this.thingy.addListener('close', this.thingy_end_cb);\n      return this.thingy.addListener('end', this.thingy_end_cb);\n    };\n\n    GenericReceiver.prototype.tearDown = function() {\n      this.thingy.removeListener('close', this.thingy_end_cb);\n      this.thingy.removeListener('end', this.thingy_end_cb);\n      return this.thingy_end_cb = null;\n    };\n\n    GenericReceiver.prototype.didAbort = function() {\n      this.delay_disconnect = false;\n      return this.didClose();\n    };\n\n    GenericReceiver.prototype.didClose = function() {\n      if (this.thingy) {\n        this.tearDown(this.thingy);\n        this.thingy = null;\n      }\n      if (this.session) {\n        return this.session.unregister();\n      }\n    };\n\n    GenericReceiver.prototype.doSendBulk = function(messages) {\n      var m, q_msgs;\n      q_msgs = (function() {\n        var i, len, results;\n        results = [];\n        for (i = 0, len = messages.length; i < len; i++) {\n          m = messages[i];\n          results.push(utils.quote(m));\n        }\n        return results;\n      })();\n      return this.doSendFrame('a' + '[' + q_msgs.join(',') + ']');\n    };\n\n    GenericReceiver.prototype.heartbeat = function() {\n      return this.doSendFrame('h');\n    };\n\n    return GenericReceiver;\n\n  })();\n\n  ResponseReceiver = (function(superClass) {\n    extend(ResponseReceiver, superClass);\n\n    ResponseReceiver.prototype.max_response_size = void 0;\n\n    ResponseReceiver.prototype.delay_disconnect = true;\n\n    function ResponseReceiver(request, response, options) {\n      var x;\n      this.request = request;\n      this.response = response;\n      this.options = options;\n      this.curr_response_size = 0;\n      try {\n        this.request.connection.setKeepAlive(true, 5000);\n      } catch (_error) {\n        x = _error;\n      }\n      ResponseReceiver.__super__.constructor.call(this, this.request.connection);\n      if (this.max_response_size === void 0) {\n        this.max_response_size = this.options.response_limit;\n      }\n    }\n\n    ResponseReceiver.prototype.doSendFrame = function(payload) {\n      var r, x;\n      this.curr_response_size += payload.length;\n      r = false;\n      try {\n        this.response.write(payload);\n        r = true;\n      } catch (_error) {\n        x = _error;\n      }\n      if (this.max_response_size && this.curr_response_size >= this.max_response_size) {\n        this.didClose();\n      }\n      return r;\n    };\n\n    ResponseReceiver.prototype.didClose = function() {\n      var x;\n      ResponseReceiver.__super__.didClose.apply(this, arguments);\n      try {\n        this.response.end();\n      } catch (_error) {\n        x = _error;\n      }\n      return this.response = null;\n    };\n\n    return ResponseReceiver;\n\n  })(GenericReceiver);\n\n  exports.GenericReceiver = GenericReceiver;\n\n  exports.Transport = Transport;\n\n  exports.Session = Session;\n\n  exports.ResponseReceiver = ResponseReceiver;\n\n  exports.SockJSConnection = SockJSConnection;\n\n}).call(this);\n"]}