{"version":3,"sources":["webjs.js"],"names":[],"mappings":";AACA,CAAC,YAAW;AACV,MAAI,UAAJ,EAAgB,eAAhB,EAAiC,aAAjC,EAAgD,EAAhD,EAAoD,IAApD,EAA0D,WAA1D,EAAuE,GAAvE,EAA4E,KAA5E;;AAEA,QAAM,QAAQ,KAAR,CAAN;;AAEA,gBAAc,QAAQ,aAAR,CAAd;;AAEA,OAAK,QAAQ,IAAR,CAAL;;AAEA,SAAO,QAAQ,MAAR,CAAP;;AAEA,UAAQ,QAAQ,SAAR,CAAR;;AAEA,oBAAkB,UAAS,GAAT,EAAc,IAAd,EAAoB,GAApB,EAAyB,GAAzB,EAA8B,IAA9B,EAAoC;AACpD,QAAI,GAAJ,EAAS,OAAT,EAAkB,CAAlB;AACA,QAAI;AACF,gBAAU,EAAV;AACA,aAAO,KAAK,MAAL,GAAc,CAArB,EAAwB;AACtB,cAAM,KAAK,KAAL,EAAN;AACA,YAAI,QAAJ,GAAe,GAAf;AACA,gBAAQ,IAAR,CAAa,OAAO,IAAI,GAAJ,EAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB,IAAI,WAA7B,CAApB;AACD;AACD,aAAO,OAAP;AACD,KARD,CAQE,OAAO,MAAP,EAAe;AACf,UAAI,MAAJ;AACA,UAAI,OAAO,CAAP,KAAa,QAAb,IAAyB,YAAY,CAAzC,EAA4C;AAC1C,YAAI,EAAE,MAAF,KAAa,CAAjB,EAAoB;AAClB;AACD,SAFD,MAEO,IAAI,YAAY,EAAE,MAAd,IAAwB,GAA5B,EAAiC;AACtC,cAAI,YAAY,EAAE,MAAlB,EAA0B,GAA1B,EAA+B,GAA/B,EAAoC,CAApC;AACD,SAFM,MAEA;AACL,cAAI,cAAJ,EAAoB,GAApB,EAAyB,GAAzB,EAA8B,CAA9B;AACD;AACF,OARD,MAQO;AACL,YAAI,cAAJ,EAAoB,GAApB,EAAyB,GAAzB,EAA8B,CAA9B;AACD;AACD,aAAO,IAAI,aAAJ,EAAmB,GAAnB,EAAwB,GAAxB,EAA6B,IAA7B,CAAP;AACD;AACF,GAzBD;;AA2BA,kBAAgB,UAAS,GAAT,EAAc,GAAd,EAAmB;AACjC,QAAI,OAAJ;AACA,cAAU;AACR,oBAAc;AADN,KAAV;AAGA,QAAI,SAAJ,GAAgB,UAAS,MAAT,EAAiB,YAAjB,EAA+B;AAC7C,UAAI,CAAJ,EAAO,CAAP,EAAU,CAAV;AACA,UAAI,gBAAgB,IAApB,EAA0B;AACxB,uBAAe,EAAf;AACD;AACD,UAAI,EAAJ;AACA,QAAE,IAAF,CAAO,UAAU,IAAI,WAAd,GAA4B,GAA5B,GAAkC,MAAlC,GAA2C,GAA3C,GAAiD,KAAK,YAAL,CAAkB,MAAlB,CAAxD;AACA,YAAM,YAAN,CAAmB,OAAnB,EAA4B,YAA5B;AACA,WAAK,CAAL,IAAU,OAAV,EAAmB;AACjB,UAAE,IAAF,CAAO,IAAI,IAAJ,GAAW,QAAQ,CAAR,CAAlB;AACD;AACD,UAAI,EAAE,MAAF,CAAS,CAAC,EAAD,EAAK,EAAL,CAAT,CAAJ;AACA,UAAI;AACF,YAAI,KAAJ,CAAU,EAAE,IAAF,CAAO,MAAP,CAAV;AACD,OAFD,CAEE,OAAO,MAAP,EAAe;AACf,YAAI,MAAJ;AACD;AACD,UAAI;AACF,eAAO,IAAI,GAAJ,EAAP;AACD,OAFD,CAEE,OAAO,MAAP,EAAe;AACf,YAAI,MAAJ;AACD;AACF,KAtBD;AAuBA,WAAO,IAAI,SAAJ,GAAgB,UAAS,CAAT,EAAY,CAAZ,EAAe;AACpC,aAAO,QAAQ,CAAR,IAAa,CAApB;AACD,KAFD;AAGD,GA/BD;;AAiCA,UAAQ,eAAR,GAA0B,UAAS,GAAT,EAAc,UAAd,EAA0B;AAClD,WAAO,UAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB;AAC9B,UAAI,eAAJ,EAAqB,KAArB,EAA4B,IAA5B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,GAA3C,EAAgD,CAAhD,EAAmD,MAAnD,EAA2D,IAA3D,EAAiE,GAAjE,EAAsE,GAAtE;AACA,UAAI,OAAO,IAAI,SAAX,KAAyB,WAA7B,EAA0C;AACxC,sBAAc,GAAd,EAAmB,GAAnB;AACD;AACD,YAAM,YAAN,CAAmB,GAAnB,EAAwB,IAAI,KAAJ,CAAU,IAAI,GAAd,EAAmB,IAAnB,CAAxB;AACA,UAAI,UAAJ,GAAiB,IAAI,IAAJ,EAAjB;AACA,cAAQ,KAAR;AACA,wBAAkB,EAAlB;AACA,WAAK,IAAI,CAAJ,EAAO,MAAM,WAAW,MAA7B,EAAqC,IAAI,GAAzC,EAA8C,GAA9C,EAAmD;AACjD,cAAM,WAAW,CAAX,CAAN;AACA,iBAAS,IAAI,CAAJ,CAAT,EAAiB,OAAO,IAAI,CAAJ,CAAxB,EAAgC,OAAO,IAAI,CAAJ,CAAvC;AACA,YAAI,KAAK,WAAL,KAAqB,KAAzB,EAAgC;AAC9B,iBAAO,CAAC,IAAD,CAAP;AACD;AACD,YAAI,IAAI,QAAJ,CAAa,KAAb,CAAmB,KAAK,CAAL,CAAnB,CAAJ;AACA,YAAI,CAAC,CAAL,EAAQ;AACN;AACD;AACD,YAAI,CAAC,IAAI,MAAJ,CAAW,KAAX,CAAiB,IAAI,MAAJ,CAAW,MAAX,CAAjB,CAAL,EAA2C;AACzC,0BAAgB,IAAhB,CAAqB,MAArB;AACA;AACD;AACD,aAAK,IAAI,IAAI,CAAR,EAAW,MAAM,KAAK,MAA3B,EAAmC,KAAK,GAAL,GAAW,IAAI,GAAf,GAAqB,IAAI,GAA5D,EAAiE,IAAI,KAAK,GAAL,GAAW,EAAE,CAAb,GAAiB,EAAE,CAAxF,EAA2F;AACzF,cAAI,KAAK,CAAL,CAAJ,IAAe,EAAE,CAAF,CAAf;AACD;AACD,eAAO,KAAK,KAAL,CAAW,CAAX,CAAP;AACA,aAAK,IAAL,CAAU,aAAV;AACA,YAAI,WAAJ,GAAkB,UAAS,IAAT,EAAe;AAC/B,iBAAO,gBAAgB,GAAhB,EAAqB,IAArB,EAA2B,GAA3B,EAAgC,GAAhC,EAAqC,IAArC,CAAP;AACD,SAFD;AAGA,YAAI,WAAJ,CAAgB,IAAhB;AACA,gBAAQ,IAAR;AACA;AACD;AACD,UAAI,CAAC,KAAL,EAAY;AACV,YAAI,gBAAgB,MAAhB,KAA2B,CAA/B,EAAkC;AAChC,cAAI,YAAJ,EAAkB,GAAlB,EAAuB,GAAvB,EAA4B,eAA5B;AACD,SAFD,MAEO;AACL,cAAI,YAAJ,EAAkB,GAAlB,EAAuB,GAAvB;AACD;AACD,YAAI,aAAJ,EAAmB,GAAnB,EAAwB,GAAxB,EAA6B,IAA7B;AACD;AACF,KA3CD;AA4CD,GA7CD;;AA+CA,UAAQ,UAAR,GAAqB,aAAc,YAAW;AAC5C,aAAS,UAAT,GAAsB,CAAE;;AAExB,eAAW,SAAX,CAAqB,UAArB,GAAkC,UAAS,GAAT,EAAc,GAAd,EAAmB,CAAnB,EAAsB;AACtD,UAAI,IAAI,QAAR,EAAkB;AAChB,eAAO,CAAP;AACD;AACD,UAAI,SAAJ,CAAc,GAAd,EAAmB,EAAnB;AACA,UAAI,GAAJ;AACA,aAAO,IAAP;AACD,KAPD;;AASA,eAAW,SAAX,CAAqB,UAArB,GAAkC,UAAS,GAAT,EAAc,GAAd,EAAmB,OAAnB,EAA4B;AAC5D,UAAI,SAAJ,CAAc,GAAd,EAAmB;AACjB,iBAAS,QAAQ,IAAR,CAAa,IAAb;AADQ,OAAnB;AAGA,UAAI,GAAJ;AACA,aAAO,IAAP;AACD,KAND;;AAQA,eAAW,SAAX,CAAqB,YAArB,GAAoC,UAAS,GAAT,EAAc,GAAd,EAAmB,CAAnB,EAAsB;AACxD,UAAI,IAAI,QAAR,EAAkB;AAChB,eAAO,CAAP;AACD;AACD,UAAI,OAAO,CAAP,KAAa,QAAb,IAAyB,YAAY,CAAzC,EAA4C;AAC1C,YAAI,SAAJ,CAAc,EAAE,MAAhB,EAAwB,EAAxB;AACA,YAAI,GAAJ,CAAQ,EAAE,OAAF,IAAa,EAArB;AACD,OAHD,MAGO;AACL,YAAI;AACF,cAAI,SAAJ,CAAc,GAAd,EAAmB,EAAnB;AACA,cAAI,GAAJ,CAAQ,6BAAR;AACD,SAHD,CAGE,OAAO,MAAP,EAAe;AACf,cAAI,MAAJ;AACD;AACD,aAAK,GAAL,CAAS,OAAT,EAAkB,mBAAmB,IAAI,MAAvB,GAAgC,GAAhC,GAAsC,IAAI,IAA1C,GAAiD,eAAjD,GAAmE,IAAI,QAAvE,GAAkF,MAAlF,IAA4F,EAAE,KAAF,IAAW,CAAvG,CAAlB;AACD;AACD,aAAO,IAAP;AACD,KAjBD;;AAmBA,eAAW,SAAX,CAAqB,WAArB,GAAmC,UAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB;AAC1D,UAAI,EAAJ;AACA,WAAM,IAAI,IAAJ,EAAD,GAAe,IAAI,UAAxB;AACA,WAAK,GAAL,CAAS,MAAT,EAAiB,IAAI,MAAJ,GAAa,GAAb,GAAmB,IAAI,GAAvB,GAA6B,GAA7B,GAAmC,EAAnC,GAAwC,KAAxC,IAAiD,IAAI,QAAJ,GAAe,IAAI,OAAJ,CAAY,KAAZ,CAAkB,IAAlB,EAAwB,CAAxB,EAA2B,KAA3B,CAAiC,GAAjC,EAAsC,CAAtC,CAAf,GAA0D,cAA3G,CAAjB;AACA,aAAO,IAAP;AACD,KALD;;AAOA,eAAW,SAAX,CAAqB,GAArB,GAA2B,UAAS,QAAT,EAAmB,IAAnB,EAAyB;AAClD,aAAO,QAAQ,GAAR,CAAY,IAAZ,CAAP;AACD,KAFD;;AAIA,eAAW,SAAX,CAAqB,WAArB,GAAmC,UAAS,GAAT,EAAc,GAAd,EAAmB,OAAnB,EAA4B;AAC7D,UAAI,IAAI,QAAR,EAAkB;AAChB,eAAO,OAAP;AACD;AACD,UAAI,CAAC,IAAI,SAAJ,CAAc,cAAd,CAAL,EAAoC;AAClC,YAAI,SAAJ,CAAc,cAAd,EAA8B,0BAA9B;AACD;AACD,aAAO,KAAK,MAAL,CAAY,GAAZ,EAAiB,GAAjB,EAAsB,OAAtB,CAAP;AACD,KARD;;AAUA,eAAW,SAAX,CAAqB,WAArB,GAAmC,UAAS,GAAT,EAAc,GAAd,EAAmB,OAAnB,EAA4B;AAC7D,UAAI,IAAI,QAAR,EAAkB;AAChB,eAAO,OAAP;AACD;AACD,UAAI,CAAC,IAAI,SAAJ,CAAc,cAAd,CAAL,EAAoC;AAClC,YAAI,SAAJ,CAAc,cAAd,EAA8B,kBAA9B;AACD;AACD,aAAO,KAAK,MAAL,CAAY,GAAZ,EAAiB,GAAjB,EAAsB,KAAK,SAAL,CAAe,OAAf,CAAtB,CAAP;AACD,KARD;;AAUA,eAAW,SAAX,CAAqB,MAArB,GAA8B,UAAS,GAAT,EAAc,GAAd,EAAmB,OAAnB,EAA4B;AACxD,UAAI,IAAI,QAAR,EAAkB;AAChB,eAAO,OAAP;AACD;AACD,UAAI,WAAW,CAAC,IAAI,SAAJ,CAAc,cAAd,CAAhB,EAA+C;AAC7C,YAAI,SAAJ,CAAc,cAAd,EAA8B,YAA9B;AACD;AACD,UAAI,OAAJ,EAAa;AACX,YAAI,SAAJ,CAAc,gBAAd,EAAgC,QAAQ,MAAxC;AACD;AACD,UAAI,SAAJ,CAAc,IAAI,UAAlB;AACA,UAAI,GAAJ,CAAQ,OAAR,EAAiB,MAAjB;AACA,aAAO,IAAP;AACD,KAbD;;AAeA,eAAW,SAAX,CAAqB,UAArB,GAAkC,UAAS,GAAT,EAAc,GAAd,EAAmB,QAAnB,EAA6B,WAA7B,EAA0C;AAC1E,UAAI,CAAJ;AACA,UAAI,UAAS,KAAT,EAAgB,OAAhB,EAAyB;AAC3B,YAAI,KAAJ,EAAW;AACT,cAAI,SAAJ,CAAc,GAAd;AACA,cAAI,GAAJ,CAAQ,iBAAR;AACD,SAHD,MAGO;AACL,cAAI,SAAJ,CAAc,gBAAd,EAAgC,QAAQ,MAAxC;AACA,cAAI,SAAJ,CAAc,IAAI,UAAlB,EAA8B,IAAI,OAAlC;AACA,cAAI,GAAJ,CAAQ,OAAR,EAAiB,MAAjB;AACD;AACD,eAAO,YAAY,IAAZ,CAAP;AACD,OAVD;AAWA,SAAG,QAAH,CAAY,QAAZ,EAAsB,CAAtB;AACA,YAAM;AACJ,gBAAQ;AADJ,OAAN;AAGD,KAjBD;;AAmBA,eAAW,SAAX,CAAqB,SAArB,GAAiC,UAAS,GAAT,EAAc,GAAd,EAAmB,OAAnB,EAA4B;AAC3D,UAAI,GAAJ;AACA,UAAI,SAAJ,GAAgB,IAAI,SAAJ,IAAiB,MAAM,EAAN,GAAW,EAAX,GAAgB,EAAjD;AACA,UAAI,SAAJ,CAAc,eAAd,EAA+B,qBAAqB,IAAI,SAAxD;AACA,YAAM,IAAI,IAAJ,EAAN;AACA,UAAI,OAAJ,CAAY,IAAI,OAAJ,KAAgB,IAAI,SAAJ,GAAgB,IAA5C;AACA,UAAI,SAAJ,CAAc,SAAd,EAAyB,IAAI,WAAJ,EAAzB;AACA,aAAO,OAAP;AACD,KARD;;AAUA,eAAW,SAAX,CAAqB,UAArB,GAAkC,UAAS,GAAT,EAAc,GAAd,EAAmB,OAAnB,EAA4B;AAC5D,UAAI,SAAJ,CAAc,eAAd,EAA+B,8DAA/B;AACA,aAAO,OAAP;AACD,KAHD;;AAKA,eAAW,SAAX,CAAqB,WAArB,GAAmC,UAAS,GAAT,EAAc,GAAd,EAAmB,KAAnB,EAA0B,WAA1B,EAAuC;AACxE,UAAI,IAAJ;AACA,aAAO,IAAI,MAAJ,CAAW,CAAX,CAAP;AACA,UAAI,EAAJ,CAAO,MAAP,EAAgB,UAAS,KAAT,EAAgB;AAC9B,eAAO,UAAS,CAAT,EAAY;AACjB,iBAAO,OAAO,MAAM,aAAN,CAAoB,IAApB,EAA0B,IAAI,MAAJ,CAAW,CAAX,EAAc,QAAd,CAA1B,CAAd;AACD,SAFD;AAGD,OAJc,CAIZ,IAJY,CAAf;AAKA,UAAI,EAAJ,CAAO,KAAP,EAAe,UAAS,KAAT,EAAgB;AAC7B,eAAO,YAAW;AAChB,cAAI,CAAJ;AACA,iBAAO,KAAK,QAAL,CAAc,OAAd,CAAP;AACA,kBAAQ,CAAC,IAAI,OAAJ,CAAY,cAAZ,KAA+B,EAAhC,EAAoC,KAApC,CAA0C,GAA1C,EAA+C,CAA/C,CAAR;AACE,iBAAK,mCAAL;AACE,kBAAI,YAAY,KAAZ,CAAkB,IAAlB,CAAJ;AACA;AACF,iBAAK,YAAL;AACA,iBAAK,EAAL;AACE,kBAAI,IAAJ;AACA;AACF;AACE,oBAAM,GAAN,CAAU,OAAV,EAAmB,8BAA8B,IAAI,OAAJ,CAAY,cAAZ,CAAjD;AACA,kBAAI,KAAK,CAAT;AAVJ;AAYA,iBAAO,YAAY,CAAZ,CAAP;AACD,SAhBD;AAiBD,OAlBa,CAkBX,IAlBW,CAAd;AAmBA,YAAM;AACJ,gBAAQ;AADJ,OAAN;AAGD,KA9BD;;AAgCA,eAAW,SAAX,CAAqB,UAArB,GAAkC,UAAS,GAAT,EAAc,GAAd,EAAmB,KAAnB,EAA0B,WAA1B,EAAuC;AACvE,UAAI,IAAJ;AACA,aAAO,IAAI,MAAJ,CAAW,CAAX,CAAP;AACA,UAAI,EAAJ,CAAO,MAAP,EAAgB,UAAS,KAAT,EAAgB;AAC9B,eAAO,UAAS,CAAT,EAAY;AACjB,iBAAO,OAAO,MAAM,aAAN,CAAoB,IAApB,EAA0B,IAAI,MAAJ,CAAW,CAAX,EAAc,QAAd,CAA1B,CAAd;AACD,SAFD;AAGD,OAJc,CAIZ,IAJY,CAAf;AAKA,UAAI,EAAJ,CAAO,KAAP,EAAe,UAAS,KAAT,EAAgB;AAC7B,eAAO,YAAW;AAChB,cAAI,CAAJ;AACA,iBAAO,KAAK,QAAL,CAAc,OAAd,CAAP;AACA,kBAAQ,CAAC,IAAI,OAAJ,CAAY,cAAZ,KAA+B,EAAhC,EAAoC,KAApC,CAA0C,GAA1C,EAA+C,CAA/C,CAAR;AACE,iBAAK,YAAL;AACA,iBAAK,GAAL;AACA,iBAAK,kBAAL;AACA,iBAAK,iBAAL;AACA,iBAAK,EAAL;AACA,iBAAK,UAAL;AACE,kBAAI,IAAJ;AACA;AACF;AACE,oBAAM,GAAN,CAAU,OAAV,EAAmB,8BAA8B,IAAI,OAAJ,CAAY,cAAZ,CAAjD;AACA,kBAAI,KAAK,CAAT;AAXJ;AAaA,iBAAO,YAAY,CAAZ,CAAP;AACD,SAjBD;AAkBD,OAnBa,CAmBX,IAnBW,CAAd;AAoBA,YAAM;AACJ,gBAAQ;AADJ,OAAN;AAGD,KA/BD;;AAiCA,WAAO,UAAP;AAED,GA1LiC,EAAlC;AA4LD,CApTD,EAoTG,IApTH,CAoTQ,IApTR","file":"webjs-compiled.js","sourcesContent":["// Generated by CoffeeScript 1.9.3\n(function() {\n  var GenericApp, execute_request, fake_response, fs, http, querystring, url, utils;\n\n  url = require('url');\n\n  querystring = require('querystring');\n\n  fs = require('fs');\n\n  http = require('http');\n\n  utils = require('./utils');\n\n  execute_request = function(app, funs, req, res, data) {\n    var fun, results, x;\n    try {\n      results = [];\n      while (funs.length > 0) {\n        fun = funs.shift();\n        req.last_fun = fun;\n        results.push(data = app[fun](req, res, data, req.next_filter));\n      }\n      return results;\n    } catch (_error) {\n      x = _error;\n      if (typeof x === 'object' && 'status' in x) {\n        if (x.status === 0) {\n          return;\n        } else if ('handle_' + x.status in app) {\n          app['handle_' + x.status](req, res, x);\n        } else {\n          app['handle_error'](req, res, x);\n        }\n      } else {\n        app['handle_error'](req, res, x);\n      }\n      return app['log_request'](req, res, true);\n    }\n  };\n\n  fake_response = function(req, res) {\n    var headers;\n    headers = {\n      'Connection': 'close'\n    };\n    res.writeHead = function(status, user_headers) {\n      var k, r, x;\n      if (user_headers == null) {\n        user_headers = {};\n      }\n      r = [];\n      r.push('HTTP/' + req.httpVersion + ' ' + status + ' ' + http.STATUS_CODES[status]);\n      utils.objectExtend(headers, user_headers);\n      for (k in headers) {\n        r.push(k + ': ' + headers[k]);\n      }\n      r = r.concat(['', '']);\n      try {\n        res.write(r.join('\\r\\n'));\n      } catch (_error) {\n        x = _error;\n      }\n      try {\n        return res.end();\n      } catch (_error) {\n        x = _error;\n      }\n    };\n    return res.setHeader = function(k, v) {\n      return headers[k] = v;\n    };\n  };\n\n  exports.generateHandler = function(app, dispatcher) {\n    return function(req, res, head) {\n      var allowed_methods, found, funs, i, j, l, len, m, method, path, ref, row;\n      if (typeof res.writeHead === \"undefined\") {\n        fake_response(req, res);\n      }\n      utils.objectExtend(req, url.parse(req.url, true));\n      req.start_date = new Date();\n      found = false;\n      allowed_methods = [];\n      for (j = 0, len = dispatcher.length; j < len; j++) {\n        row = dispatcher[j];\n        method = row[0], path = row[1], funs = row[2];\n        if (path.constructor !== Array) {\n          path = [path];\n        }\n        m = req.pathname.match(path[0]);\n        if (!m) {\n          continue;\n        }\n        if (!req.method.match(new RegExp(method))) {\n          allowed_methods.push(method);\n          continue;\n        }\n        for (i = l = 1, ref = path.length; 1 <= ref ? l < ref : l > ref; i = 1 <= ref ? ++l : --l) {\n          req[path[i]] = m[i];\n        }\n        funs = funs.slice(0);\n        funs.push('log_request');\n        req.next_filter = function(data) {\n          return execute_request(app, funs, req, res, data);\n        };\n        req.next_filter(head);\n        found = true;\n        break;\n      }\n      if (!found) {\n        if (allowed_methods.length !== 0) {\n          app['handle_405'](req, res, allowed_methods);\n        } else {\n          app['handle_404'](req, res);\n        }\n        app['log_request'](req, res, true);\n      }\n    };\n  };\n\n  exports.GenericApp = GenericApp = (function() {\n    function GenericApp() {}\n\n    GenericApp.prototype.handle_404 = function(req, res, x) {\n      if (res.finished) {\n        return x;\n      }\n      res.writeHead(404, {});\n      res.end();\n      return true;\n    };\n\n    GenericApp.prototype.handle_405 = function(req, res, methods) {\n      res.writeHead(405, {\n        'Allow': methods.join(', ')\n      });\n      res.end();\n      return true;\n    };\n\n    GenericApp.prototype.handle_error = function(req, res, x) {\n      if (res.finished) {\n        return x;\n      }\n      if (typeof x === 'object' && 'status' in x) {\n        res.writeHead(x.status, {});\n        res.end(x.message || \"\");\n      } else {\n        try {\n          res.writeHead(500, {});\n          res.end(\"500 - Internal Server Error\");\n        } catch (_error) {\n          x = _error;\n        }\n        this.log('error', 'Exception on \"' + req.method + ' ' + req.href + '\" in filter \"' + req.last_fun + '\":\\n' + (x.stack || x));\n      }\n      return true;\n    };\n\n    GenericApp.prototype.log_request = function(req, res, data) {\n      var td;\n      td = (new Date()) - req.start_date;\n      this.log('info', req.method + ' ' + req.url + ' ' + td + 'ms ' + (res.finished ? res._header.split('\\r')[0].split(' ')[1] : '(unfinished)'));\n      return data;\n    };\n\n    GenericApp.prototype.log = function(severity, line) {\n      return console.log(line);\n    };\n\n    GenericApp.prototype.expose_html = function(req, res, content) {\n      if (res.finished) {\n        return content;\n      }\n      if (!res.getHeader('Content-Type')) {\n        res.setHeader('Content-Type', 'text/html; charset=UTF-8');\n      }\n      return this.expose(req, res, content);\n    };\n\n    GenericApp.prototype.expose_json = function(req, res, content) {\n      if (res.finished) {\n        return content;\n      }\n      if (!res.getHeader('Content-Type')) {\n        res.setHeader('Content-Type', 'application/json');\n      }\n      return this.expose(req, res, JSON.stringify(content));\n    };\n\n    GenericApp.prototype.expose = function(req, res, content) {\n      if (res.finished) {\n        return content;\n      }\n      if (content && !res.getHeader('Content-Type')) {\n        res.setHeader('Content-Type', 'text/plain');\n      }\n      if (content) {\n        res.setHeader('Content-Length', content.length);\n      }\n      res.writeHead(res.statusCode);\n      res.end(content, 'utf8');\n      return true;\n    };\n\n    GenericApp.prototype.serve_file = function(req, res, filename, next_filter) {\n      var a;\n      a = function(error, content) {\n        if (error) {\n          res.writeHead(500);\n          res.end(\"can't read file\");\n        } else {\n          res.setHeader('Content-length', content.length);\n          res.writeHead(res.statusCode, res.headers);\n          res.end(content, 'utf8');\n        }\n        return next_filter(true);\n      };\n      fs.readFile(filename, a);\n      throw {\n        status: 0\n      };\n    };\n\n    GenericApp.prototype.cache_for = function(req, res, content) {\n      var exp;\n      res.cache_for = res.cache_for || 365 * 24 * 60 * 60;\n      res.setHeader('Cache-Control', 'public, max-age=' + res.cache_for);\n      exp = new Date();\n      exp.setTime(exp.getTime() + res.cache_for * 1000);\n      res.setHeader('Expires', exp.toGMTString());\n      return content;\n    };\n\n    GenericApp.prototype.h_no_cache = function(req, res, content) {\n      res.setHeader('Cache-Control', 'no-store, no-cache, no-transform, must-revalidate, max-age=0');\n      return content;\n    };\n\n    GenericApp.prototype.expect_form = function(req, res, _data, next_filter) {\n      var data;\n      data = new Buffer(0);\n      req.on('data', (function(_this) {\n        return function(d) {\n          return data = utils.buffer_concat(data, new Buffer(d, 'binary'));\n        };\n      })(this));\n      req.on('end', (function(_this) {\n        return function() {\n          var q;\n          data = data.toString('utf-8');\n          switch ((req.headers['content-type'] || '').split(';')[0]) {\n            case 'application/x-www-form-urlencoded':\n              q = querystring.parse(data);\n              break;\n            case 'text/plain':\n            case '':\n              q = data;\n              break;\n            default:\n              _this.log('error', \"Unsupported content-type \" + req.headers['content-type']);\n              q = void 0;\n          }\n          return next_filter(q);\n        };\n      })(this));\n      throw {\n        status: 0\n      };\n    };\n\n    GenericApp.prototype.expect_xhr = function(req, res, _data, next_filter) {\n      var data;\n      data = new Buffer(0);\n      req.on('data', (function(_this) {\n        return function(d) {\n          return data = utils.buffer_concat(data, new Buffer(d, 'binary'));\n        };\n      })(this));\n      req.on('end', (function(_this) {\n        return function() {\n          var q;\n          data = data.toString('utf-8');\n          switch ((req.headers['content-type'] || '').split(';')[0]) {\n            case 'text/plain':\n            case 'T':\n            case 'application/json':\n            case 'application/xml':\n            case '':\n            case 'text/xml':\n              q = data;\n              break;\n            default:\n              _this.log('error', 'Unsupported content-type ' + req.headers['content-type']);\n              q = void 0;\n          }\n          return next_filter(q);\n        };\n      })(this));\n      throw {\n        status: 0\n      };\n    };\n\n    return GenericApp;\n\n  })();\n\n}).call(this);\n"]}