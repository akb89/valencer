{"version":3,"sources":["route.js"],"names":[],"mappings":"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","file":"route-compiled.js","sourcesContent":["/*!\n * express\n * Copyright(c) 2009-2013 TJ Holowaychuk\n * Copyright(c) 2013 Roman Shtylman\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar debug = require('debug')('express:router:route');\nvar flatten = require('array-flatten');\nvar Layer = require('./layer');\nvar methods = require('methods');\n\n/**\n * Module variables.\n * @private\n */\n\nvar slice = Array.prototype.slice;\nvar toString = Object.prototype.toString;\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = Route;\n\n/**\n * Initialize `Route` with the given `path`,\n *\n * @param {String} path\n * @public\n */\n\nfunction Route(path) {\n  this.path = path;\n  this.stack = [];\n\n  debug('new %s', path);\n\n  // route handlers for various http methods\n  this.methods = {};\n}\n\n/**\n * Determine if the route handles a given method.\n * @private\n */\n\nRoute.prototype._handles_method = function _handles_method(method) {\n  if (this.methods._all) {\n    return true;\n  }\n\n  var name = method.toLowerCase();\n\n  if (name === 'head' && !this.methods['head']) {\n    name = 'get';\n  }\n\n  return Boolean(this.methods[name]);\n};\n\n/**\n * @return {Array} supported HTTP methods\n * @private\n */\n\nRoute.prototype._options = function _options() {\n  var methods = Object.keys(this.methods);\n\n  // append automatic head\n  if (this.methods.get && !this.methods.head) {\n    methods.push('head');\n  }\n\n  for (var i = 0; i < methods.length; i++) {\n    // make upper case\n    methods[i] = methods[i].toUpperCase();\n  }\n\n  return methods;\n};\n\n/**\n * dispatch req, res into this route\n * @private\n */\n\nRoute.prototype.dispatch = function dispatch(req, res, done) {\n  var idx = 0;\n  var stack = this.stack;\n  if (stack.length === 0) {\n    return done();\n  }\n\n  var method = req.method.toLowerCase();\n  if (method === 'head' && !this.methods['head']) {\n    method = 'get';\n  }\n\n  req.route = this;\n\n  next();\n\n  function next(err) {\n    if (err && err === 'route') {\n      return done();\n    }\n\n    var layer = stack[idx++];\n    if (!layer) {\n      return done(err);\n    }\n\n    if (layer.method && layer.method !== method) {\n      return next(err);\n    }\n\n    if (err) {\n      layer.handle_error(err, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n  }\n};\n\n/**\n * Add a handler for all HTTP verbs to this route.\n *\n * Behaves just like middleware and can respond or call `next`\n * to continue processing.\n *\n * You can use multiple `.all` call to add multiple handlers.\n *\n *   function check_something(req, res, next){\n *     next();\n *   };\n *\n *   function validate_user(req, res, next){\n *     next();\n *   };\n *\n *   route\n *   .all(validate_user)\n *   .all(check_something)\n *   .get(function(req, res, next){\n *     res.send('hello world');\n *   });\n *\n * @param {function} handler\n * @return {Route} for chaining\n * @api public\n */\n\nRoute.prototype.all = function all() {\n  var handles = flatten(slice.call(arguments));\n\n  for (var i = 0; i < handles.length; i++) {\n    var handle = handles[i];\n\n    if (typeof handle !== 'function') {\n      var type = toString.call(handle);\n      var msg = 'Route.all() requires callback functions but got a ' + type;\n      throw new TypeError(msg);\n    }\n\n    var layer = Layer('/', {}, handle);\n    layer.method = undefined;\n\n    this.methods._all = true;\n    this.stack.push(layer);\n  }\n\n  return this;\n};\n\nmethods.forEach(function(method){\n  Route.prototype[method] = function(){\n    var handles = flatten(slice.call(arguments));\n\n    for (var i = 0; i < handles.length; i++) {\n      var handle = handles[i];\n\n      if (typeof handle !== 'function') {\n        var type = toString.call(handle);\n        var msg = 'Route.' + method + '() requires callback functions but got a ' + type;\n        throw new Error(msg);\n      }\n\n      debug('%s %s', method, this.path);\n\n      var layer = Layer('/', {}, handle);\n      layer.method = method;\n\n      this.methods[method] = true;\n      this.stack.push(layer);\n    }\n\n    return this;\n  };\n});\n"]}