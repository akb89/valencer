{"version":3,"sources":["layer.js"],"names":[],"mappings":"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","file":"layer-compiled.js","sourcesContent":["/*!\n * express\n * Copyright(c) 2009-2013 TJ Holowaychuk\n * Copyright(c) 2013 Roman Shtylman\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar pathRegexp = require('path-to-regexp');\nvar debug = require('debug')('express:router:layer');\n\n/**\n * Module variables.\n * @private\n */\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = Layer;\n\nfunction Layer(path, options, fn) {\n  if (!(this instanceof Layer)) {\n    return new Layer(path, options, fn);\n  }\n\n  debug('new %s', path);\n  var opts = options || {};\n\n  this.handle = fn;\n  this.name = fn.name || '<anonymous>';\n  this.params = undefined;\n  this.path = undefined;\n  this.regexp = pathRegexp(path, this.keys = [], opts);\n\n  if (path === '/' && opts.end === false) {\n    this.regexp.fast_slash = true;\n  }\n}\n\n/**\n * Handle the error for the layer.\n *\n * @param {Error} error\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\n\nLayer.prototype.handle_error = function handle_error(error, req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length !== 4) {\n    // not a standard error handler\n    return next(error);\n  }\n\n  try {\n    fn(error, req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Handle the request for the layer.\n *\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\n\nLayer.prototype.handle_request = function handle(req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length > 3) {\n    // not a standard request handler\n    return next();\n  }\n\n  try {\n    fn(req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Check if this route matches `path`, if so\n * populate `.params`.\n *\n * @param {String} path\n * @return {Boolean}\n * @api private\n */\n\nLayer.prototype.match = function match(path) {\n  if (path == null) {\n    // no path, nothing matches\n    this.params = undefined;\n    this.path = undefined;\n    return false;\n  }\n\n  if (this.regexp.fast_slash) {\n    // fast path non-ending match for / (everything matches)\n    this.params = {};\n    this.path = '';\n    return true;\n  }\n\n  var m = this.regexp.exec(path);\n\n  if (!m) {\n    this.params = undefined;\n    this.path = undefined;\n    return false;\n  }\n\n  // store values\n  this.params = {};\n  this.path = m[0];\n\n  var keys = this.keys;\n  var params = this.params;\n\n  for (var i = 1; i < m.length; i++) {\n    var key = keys[i - 1];\n    var prop = key.name;\n    var val = decode_param(m[i]);\n\n    if (val !== undefined || !(hasOwnProperty.call(params, prop))) {\n      params[prop] = val;\n    }\n  }\n\n  return true;\n};\n\n/**\n * Decode param value.\n *\n * @param {string} val\n * @return {string}\n * @private\n */\n\nfunction decode_param(val) {\n  if (typeof val !== 'string' || val.length === 0) {\n    return val;\n  }\n\n  try {\n    return decodeURIComponent(val);\n  } catch (err) {\n    if (err instanceof URIError) {\n      err.message = 'Failed to decode param \\'' + val + '\\'';\n      err.status = err.statusCode = 400;\n    }\n\n    throw err;\n  }\n}\n"]}