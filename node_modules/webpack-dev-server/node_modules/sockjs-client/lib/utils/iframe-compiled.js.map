{"version":3,"sources":["iframe.js"],"names":[],"mappings":"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","file":"iframe-compiled.js","sourcesContent":["'use strict';\n\nvar eventUtils = require('./event')\n  , JSON3 = require('json3')\n  , browser = require('./browser')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:utils:iframe');\n}\n\nmodule.exports = {\n  WPrefix: '_jp'\n, currentWindowId: null\n\n, polluteGlobalNamespace: function() {\n    if (!(module.exports.WPrefix in global)) {\n      global[module.exports.WPrefix] = {};\n    }\n  }\n\n, postMessage: function(type, data) {\n    if (global.parent !== global) {\n      global.parent.postMessage(JSON3.stringify({\n        windowId: module.exports.currentWindowId\n      , type: type\n      , data: data || ''\n      }), '*');\n    } else {\n      debug('Cannot postMessage, no parent window.', type, data);\n    }\n  }\n\n, createIframe: function(iframeUrl, errorCallback) {\n    var iframe = global.document.createElement('iframe');\n    var tref, unloadRef;\n    var unattach = function() {\n      debug('unattach');\n      clearTimeout(tref);\n      // Explorer had problems with that.\n      try {\n        iframe.onload = null;\n      } catch (x) {\n        // intentionally empty\n      }\n      iframe.onerror = null;\n    };\n    var cleanup = function() {\n      debug('cleanup');\n      if (iframe) {\n        unattach();\n        // This timeout makes chrome fire onbeforeunload event\n        // within iframe. Without the timeout it goes straight to\n        // onunload.\n        setTimeout(function() {\n          if (iframe) {\n            iframe.parentNode.removeChild(iframe);\n          }\n          iframe = null;\n        }, 0);\n        eventUtils.unloadDel(unloadRef);\n      }\n    };\n    var onerror = function(err) {\n      debug('onerror', err);\n      if (iframe) {\n        cleanup();\n        errorCallback(err);\n      }\n    };\n    var post = function(msg, origin) {\n      debug('post', msg, origin);\n      try {\n        // When the iframe is not loaded, IE raises an exception\n        // on 'contentWindow'.\n        setTimeout(function() {\n          if (iframe && iframe.contentWindow) {\n            iframe.contentWindow.postMessage(msg, origin);\n          }\n        }, 0);\n      } catch (x) {\n        // intentionally empty\n      }\n    };\n\n    iframe.src = iframeUrl;\n    iframe.style.display = 'none';\n    iframe.style.position = 'absolute';\n    iframe.onerror = function() {\n      onerror('onerror');\n    };\n    iframe.onload = function() {\n      debug('onload');\n      // `onload` is triggered before scripts on the iframe are\n      // executed. Give it few seconds to actually load stuff.\n      clearTimeout(tref);\n      tref = setTimeout(function() {\n        onerror('onload timeout');\n      }, 2000);\n    };\n    global.document.body.appendChild(iframe);\n    tref = setTimeout(function() {\n      onerror('timeout');\n    }, 15000);\n    unloadRef = eventUtils.unloadAdd(cleanup);\n    return {\n      post: post\n    , cleanup: cleanup\n    , loaded: unattach\n    };\n  }\n\n/* jshint undef: false, newcap: false */\n/* eslint no-undef: 0, new-cap: 0 */\n, createHtmlfile: function(iframeUrl, errorCallback) {\n    var axo = ['Active'].concat('Object').join('X');\n    var doc = new global[axo]('htmlfile');\n    var tref, unloadRef;\n    var iframe;\n    var unattach = function() {\n      clearTimeout(tref);\n      iframe.onerror = null;\n    };\n    var cleanup = function() {\n      if (doc) {\n        unattach();\n        eventUtils.unloadDel(unloadRef);\n        iframe.parentNode.removeChild(iframe);\n        iframe = doc = null;\n        CollectGarbage();\n      }\n    };\n    var onerror = function(r) {\n      debug('onerror', r);\n      if (doc) {\n        cleanup();\n        errorCallback(r);\n      }\n    };\n    var post = function(msg, origin) {\n      try {\n        // When the iframe is not loaded, IE raises an exception\n        // on 'contentWindow'.\n        setTimeout(function() {\n          if (iframe && iframe.contentWindow) {\n              iframe.contentWindow.postMessage(msg, origin);\n          }\n        }, 0);\n      } catch (x) {\n        // intentionally empty\n      }\n    };\n\n    doc.open();\n    doc.write('<html><s' + 'cript>' +\n              'document.domain=\"' + global.document.domain + '\";' +\n              '</s' + 'cript></html>');\n    doc.close();\n    doc.parentWindow[module.exports.WPrefix] = global[module.exports.WPrefix];\n    var c = doc.createElement('div');\n    doc.body.appendChild(c);\n    iframe = doc.createElement('iframe');\n    c.appendChild(iframe);\n    iframe.src = iframeUrl;\n    iframe.onerror = function() {\n      onerror('onerror');\n    };\n    tref = setTimeout(function() {\n      onerror('timeout');\n    }, 15000);\n    unloadRef = eventUtils.unloadAdd(cleanup);\n    return {\n      post: post\n    , cleanup: cleanup\n    , loaded: unattach\n    };\n  }\n};\n\nmodule.exports.iframeEnabled = false;\nif (global.document) {\n  // postMessage misbehaves in konqueror 4.6.5 - the messages are delivered with\n  // huge delay, or not at all.\n  module.exports.iframeEnabled = (typeof global.postMessage === 'function' ||\n    typeof global.postMessage === 'object') && (!browser.isKonqueror());\n}\n"]}