{"version":3,"sources":["ajax-based.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,WAAW,QAAQ,UAAR,CAAf;IACI,WAAW,QAAQ,iBAAR,CADf;IAEI,iBAAiB,QAAQ,mBAAR,CAFrB;;AAKA,IAAI,QAAQ,YAAW,CAAE,CAAzB;AACA,IAAI,QAAQ,GAAR,CAAY,QAAZ,KAAyB,YAA7B,EAA2C;AACzC,UAAQ,QAAQ,OAAR,EAAiB,0BAAjB,CAAR;AACD;;AAED,SAAS,gBAAT,CAA0B,UAA1B,EAAsC;AACpC,SAAO,UAAS,GAAT,EAAc,OAAd,EAAuB,QAAvB,EAAiC;AACtC,UAAM,oBAAN,EAA4B,GAA5B,EAAiC,OAAjC;AACA,QAAI,MAAM,EAAV;AACA,QAAI,OAAO,OAAP,KAAmB,QAAvB,EAAiC;AAC/B,UAAI,OAAJ,GAAc,EAAC,gBAAgB,YAAjB,EAAd;AACD;AACD,QAAI,UAAU,SAAS,OAAT,CAAiB,GAAjB,EAAsB,WAAtB,CAAd;AACA,QAAI,KAAK,IAAI,UAAJ,CAAe,MAAf,EAAuB,OAAvB,EAAgC,OAAhC,EAAyC,GAAzC,CAAT;AACA,OAAG,IAAH,CAAQ,QAAR,EAAkB,UAAS,MAAT,EAAiB;AACjC,YAAM,QAAN,EAAgB,MAAhB;AACA,WAAK,IAAL;;AAEA,UAAI,WAAW,GAAX,IAAkB,WAAW,GAAjC,EAAsC;AACpC,eAAO,SAAS,IAAI,KAAJ,CAAU,iBAAiB,MAA3B,CAAT,CAAP;AACD;AACD;AACD,KARD;AASA,WAAO,YAAW;AAChB,YAAM,OAAN;AACA,SAAG,KAAH;AACA,WAAK,IAAL;;AAEA,UAAI,MAAM,IAAI,KAAJ,CAAU,SAAV,CAAV;AACA,UAAI,IAAJ,GAAW,IAAX;AACA,eAAS,GAAT;AACD,KARD;AASD,GA1BD;AA2BD;;AAED,SAAS,kBAAT,CAA4B,QAA5B,EAAsC,SAAtC,EAAiD,QAAjD,EAA2D,UAA3D,EAAuE;AACrE,iBAAe,IAAf,CAAoB,IAApB,EAA0B,QAA1B,EAAoC,SAApC,EAA+C,iBAAiB,UAAjB,CAA/C,EAA6E,QAA7E,EAAuF,UAAvF;AACD;;AAED,SAAS,kBAAT,EAA6B,cAA7B;;AAEA,OAAO,OAAP,GAAiB,kBAAjB","file":"ajax-based-compiled.js","sourcesContent":["'use strict';\n\nvar inherits = require('inherits')\n  , urlUtils = require('../../utils/url')\n  , SenderReceiver = require('./sender-receiver')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:ajax-based');\n}\n\nfunction createAjaxSender(AjaxObject) {\n  return function(url, payload, callback) {\n    debug('create ajax sender', url, payload);\n    var opt = {};\n    if (typeof payload === 'string') {\n      opt.headers = {'Content-type': 'text/plain'};\n    }\n    var ajaxUrl = urlUtils.addPath(url, '/xhr_send');\n    var xo = new AjaxObject('POST', ajaxUrl, payload, opt);\n    xo.once('finish', function(status) {\n      debug('finish', status);\n      xo = null;\n\n      if (status !== 200 && status !== 204) {\n        return callback(new Error('http status ' + status));\n      }\n      callback();\n    });\n    return function() {\n      debug('abort');\n      xo.close();\n      xo = null;\n\n      var err = new Error('Aborted');\n      err.code = 1000;\n      callback(err);\n    };\n  };\n}\n\nfunction AjaxBasedTransport(transUrl, urlSuffix, Receiver, AjaxObject) {\n  SenderReceiver.call(this, transUrl, urlSuffix, createAjaxSender(AjaxObject), Receiver, AjaxObject);\n}\n\ninherits(AjaxBasedTransport, SenderReceiver);\n\nmodule.exports = AjaxBasedTransport;\n"]}