{"version":3,"sources":["jsonp.js"],"names":[],"mappings":"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","file":"jsonp-compiled.js","sourcesContent":["'use strict';\n\nvar random = require('../../utils/random')\n  , urlUtils = require('../../utils/url')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:sender:jsonp');\n}\n\nvar form, area;\n\nfunction createIframe(id) {\n  debug('createIframe', id);\n  try {\n    // ie6 dynamic iframes with target=\"\" support (thanks Chris Lambacher)\n    return global.document.createElement('<iframe name=\"' + id + '\">');\n  } catch (x) {\n    var iframe = global.document.createElement('iframe');\n    iframe.name = id;\n    return iframe;\n  }\n}\n\nfunction createForm() {\n  debug('createForm');\n  form = global.document.createElement('form');\n  form.style.display = 'none';\n  form.style.position = 'absolute';\n  form.method = 'POST';\n  form.enctype = 'application/x-www-form-urlencoded';\n  form.acceptCharset = 'UTF-8';\n\n  area = global.document.createElement('textarea');\n  area.name = 'd';\n  form.appendChild(area);\n\n  global.document.body.appendChild(form);\n}\n\nmodule.exports = function(url, payload, callback) {\n  debug(url, payload);\n  if (!form) {\n    createForm();\n  }\n  var id = 'a' + random.string(8);\n  form.target = id;\n  form.action = urlUtils.addQuery(urlUtils.addPath(url, '/jsonp_send'), 'i=' + id);\n\n  var iframe = createIframe(id);\n  iframe.id = id;\n  iframe.style.display = 'none';\n  form.appendChild(iframe);\n\n  try {\n    area.value = payload;\n  } catch (e) {\n    // seriously broken browsers get here\n  }\n  form.submit();\n\n  var completed = function(err) {\n    debug('completed', id, err);\n    if (!iframe.onerror) {\n      return;\n    }\n    iframe.onreadystatechange = iframe.onerror = iframe.onload = null;\n    // Opera mini doesn't like if we GC iframe\n    // immediately, thus this timeout.\n    setTimeout(function() {\n      debug('cleaning up', id);\n      iframe.parentNode.removeChild(iframe);\n      iframe = null;\n    }, 500);\n    area.value = '';\n    // It is not possible to detect if the iframe succeeded or\n    // failed to submit our form.\n    callback(err);\n  };\n  iframe.onerror = function() {\n    debug('onerror', id);\n    completed();\n  };\n  iframe.onload = function() {\n    debug('onload', id);\n    completed();\n  };\n  iframe.onreadystatechange = function(e) {\n    debug('onreadystatechange', id, iframe.readyState, e);\n    if (iframe.readyState === 'complete') {\n      completed();\n    }\n  };\n  return function() {\n    debug('aborted', id);\n    completed(new Error('Aborted'));\n  };\n};\n"]}