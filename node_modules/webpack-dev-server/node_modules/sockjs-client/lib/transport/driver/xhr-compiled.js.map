{"version":3,"sources":["xhr.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,eAAe,QAAQ,QAAR,EAAkB,YAArC;IACI,WAAW,QAAQ,UAAR,CADf;IAEI,OAAO,QAAQ,MAAR,CAFX;IAGI,QAAQ,QAAQ,OAAR,CAHZ;IAII,MAAM,QAAQ,WAAR,CAJV;;AAOA,IAAI,QAAQ,YAAW,CAAE,CAAzB;AACA,IAAI,QAAQ,GAAR,CAAY,QAAZ,KAAyB,YAA7B,EAA2C;AACzC,UAAQ,QAAQ,OAAR,EAAiB,0BAAjB,CAAR;AACD;;AAED,SAAS,SAAT,CAAmB,MAAnB,EAA2B,GAA3B,EAAgC,OAAhC,EAAyC,IAAzC,EAA+C;AAC7C,QAAM,MAAN,EAAc,GAAd,EAAmB,OAAnB;AACA,MAAI,OAAO,IAAX;AACA,eAAa,IAAb,CAAkB,IAAlB;;AAEA,MAAI,YAAY,IAAI,GAAJ,CAAQ,GAAR,CAAhB;AACA,MAAI,UAAU;AACZ,YAAQ,MADI;AAEZ,cAAU,UAAU,QAAV,CAAmB,OAAnB,CAA2B,QAA3B,EAAqC,EAArC,CAFE;AAGZ,UAAM,UAAU,IAHJ;AAIZ,UAAM,UAAU,QAAV,IAAsB,UAAU,KAAV,IAAmB,EAAzC,CAJM;AAKZ,aAAS,QAAQ,KAAK,OALV;AAMZ,WAAO;AANK,GAAd;;AASA,MAAI,WAAW,UAAU,QAAV,KAAuB,QAAvB,GAAkC,KAAlC,GAA0C,IAAzD;AACA,OAAK,GAAL,GAAW,SAAS,OAAT,CAAiB,OAAjB,EAA0B,UAAS,GAAT,EAAc;AACjD,QAAI,WAAJ,CAAgB,MAAhB;AACA,QAAI,eAAe,EAAnB;;AAEA,QAAI,EAAJ,CAAO,MAAP,EAAe,UAAS,KAAT,EAAgB;AAC7B,YAAM,MAAN,EAAc,KAAd;AACA,sBAAgB,KAAhB;AACA,WAAK,IAAL,CAAU,OAAV,EAAmB,GAAnB,EAAwB,YAAxB;AACD,KAJD;AAKA,QAAI,IAAJ,CAAS,KAAT,EAAgB,YAAW;AACzB,YAAM,KAAN;AACA,WAAK,IAAL,CAAU,QAAV,EAAoB,IAAI,UAAxB,EAAoC,YAApC;AACA,WAAK,GAAL,GAAW,IAAX;AACD,KAJD;AAKD,GAdU,CAAX;;AAgBA,OAAK,GAAL,CAAS,EAAT,CAAY,OAAZ,EAAqB,UAAS,CAAT,EAAY;AAC/B,UAAM,OAAN,EAAe,CAAf;AACA,SAAK,IAAL,CAAU,QAAV,EAAoB,CAApB,EAAuB,EAAE,OAAzB;AACD,GAHD;;AAKA,MAAI,OAAJ,EAAa;AACX,SAAK,GAAL,CAAS,KAAT,CAAe,OAAf;AACD;AACD,OAAK,GAAL,CAAS,GAAT;AACD;;AAED,SAAS,SAAT,EAAoB,YAApB;;AAEA,UAAU,SAAV,CAAoB,KAApB,GAA4B,YAAW;AACrC,QAAM,OAAN;AACA,OAAK,kBAAL;AACA,MAAI,KAAK,GAAT,EAAc;AACZ,SAAK,GAAL,CAAS,KAAT;AACA,SAAK,GAAL,GAAW,IAAX;AACD;AACF,CAPD;;AASA,UAAU,OAAV,GAAoB,IAApB;AACA,UAAU,YAAV,GAAyB,IAAzB;;AAEA,OAAO,OAAP,GAAiB,SAAjB","file":"xhr-compiled.js","sourcesContent":["'use strict';\n\nvar EventEmitter = require('events').EventEmitter\n  , inherits = require('inherits')\n  , http = require('http')\n  , https = require('https')\n  , URL = require('url-parse')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:driver:xhr');\n}\n\nfunction XhrDriver(method, url, payload, opts) {\n  debug(method, url, payload);\n  var self = this;\n  EventEmitter.call(this);\n\n  var parsedUrl = new URL(url);\n  var options = {\n    method: method\n  , hostname: parsedUrl.hostname.replace(/\\[|\\]/g, '')\n  , port: parsedUrl.port\n  , path: parsedUrl.pathname + (parsedUrl.query || '')\n  , headers: opts && opts.headers\n  , agent: false\n  };\n\n  var protocol = parsedUrl.protocol === 'https:' ? https : http;\n  this.req = protocol.request(options, function(res) {\n    res.setEncoding('utf8');\n    var responseText = '';\n\n    res.on('data', function(chunk) {\n      debug('data', chunk);\n      responseText += chunk;\n      self.emit('chunk', 200, responseText);\n    });\n    res.once('end', function() {\n      debug('end');\n      self.emit('finish', res.statusCode, responseText);\n      self.req = null;\n    });\n  });\n\n  this.req.on('error', function(e) {\n    debug('error', e);\n    self.emit('finish', 0, e.message);\n  });\n\n  if (payload) {\n    this.req.write(payload);\n  }\n  this.req.end();\n}\n\ninherits(XhrDriver, EventEmitter);\n\nXhrDriver.prototype.close = function() {\n  debug('close');\n  this.removeAllListeners();\n  if (this.req) {\n    this.req.abort();\n    this.req = null;\n  }\n};\n\nXhrDriver.enabled = true;\nXhrDriver.supportsCORS = true;\n\nmodule.exports = XhrDriver;\n"]}