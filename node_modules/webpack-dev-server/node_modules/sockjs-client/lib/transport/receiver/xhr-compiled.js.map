{"version":3,"sources":["xhr.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,WAAW,QAAQ,UAAR,CAAf;IACI,eAAe,QAAQ,QAAR,EAAkB,YADrC;;AAIA,IAAI,QAAQ,YAAW,CAAE,CAAzB;AACA,IAAI,QAAQ,GAAR,CAAY,QAAZ,KAAyB,YAA7B,EAA2C;AACzC,UAAQ,QAAQ,OAAR,EAAiB,4BAAjB,CAAR;AACD;;AAED,SAAS,WAAT,CAAqB,GAArB,EAA0B,UAA1B,EAAsC;AACpC,QAAM,GAAN;AACA,eAAa,IAAb,CAAkB,IAAlB;AACA,MAAI,OAAO,IAAX;;AAEA,OAAK,cAAL,GAAsB,CAAtB;;AAEA,OAAK,EAAL,GAAU,IAAI,UAAJ,CAAe,MAAf,EAAuB,GAAvB,EAA4B,IAA5B,CAAV;AACA,OAAK,EAAL,CAAQ,EAAR,CAAW,OAAX,EAAoB,KAAK,aAAL,CAAmB,IAAnB,CAAwB,IAAxB,CAApB;AACA,OAAK,EAAL,CAAQ,IAAR,CAAa,QAAb,EAAuB,UAAS,MAAT,EAAiB,IAAjB,EAAuB;AAC5C,UAAM,QAAN,EAAgB,MAAhB,EAAwB,IAAxB;AACA,SAAK,aAAL,CAAmB,MAAnB,EAA2B,IAA3B;AACA,SAAK,EAAL,GAAU,IAAV;AACA,QAAI,SAAS,WAAW,GAAX,GAAiB,SAAjB,GAA6B,WAA1C;AACA,UAAM,OAAN,EAAe,MAAf;AACA,SAAK,IAAL,CAAU,OAAV,EAAmB,IAAnB,EAAyB,MAAzB;AACA,SAAK,QAAL;AACD,GARD;AASD;;AAED,SAAS,WAAT,EAAsB,YAAtB;;AAEA,YAAY,SAAZ,CAAsB,aAAtB,GAAsC,UAAS,MAAT,EAAiB,IAAjB,EAAuB;AAC3D,QAAM,eAAN,EAAuB,MAAvB;AACA,MAAI,WAAW,GAAX,IAAkB,CAAC,IAAvB,EAA6B;AAC3B;AACD;;AAED,OAAK,IAAI,MAAM,CAAC,CAAhB,GAAqB,KAAK,cAAL,IAAuB,MAAM,CAAlD,EAAqD;AACnD,QAAI,MAAM,KAAK,KAAL,CAAW,KAAK,cAAhB,CAAV;AACA,UAAM,IAAI,OAAJ,CAAY,IAAZ,CAAN;AACA,QAAI,QAAQ,CAAC,CAAb,EAAgB;AACd;AACD;AACD,QAAI,MAAM,IAAI,KAAJ,CAAU,CAAV,EAAa,GAAb,CAAV;AACA,QAAI,GAAJ,EAAS;AACP,YAAM,SAAN,EAAiB,GAAjB;AACA,WAAK,IAAL,CAAU,SAAV,EAAqB,GAArB;AACD;AACF;AACF,CAlBD;;AAoBA,YAAY,SAAZ,CAAsB,QAAtB,GAAiC,YAAW;AAC1C,QAAM,UAAN;AACA,OAAK,kBAAL;AACD,CAHD;;AAKA,YAAY,SAAZ,CAAsB,KAAtB,GAA8B,YAAW;AACvC,QAAM,OAAN;AACA,MAAI,KAAK,EAAT,EAAa;AACX,SAAK,EAAL,CAAQ,KAAR;AACA,UAAM,OAAN;AACA,SAAK,IAAL,CAAU,OAAV,EAAmB,IAAnB,EAAyB,MAAzB;AACA,SAAK,EAAL,GAAU,IAAV;AACD;AACD,OAAK,QAAL;AACD,CATD;;AAWA,OAAO,OAAP,GAAiB,WAAjB","file":"xhr-compiled.js","sourcesContent":["'use strict';\n\nvar inherits = require('inherits')\n  , EventEmitter = require('events').EventEmitter\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:receiver:xhr');\n}\n\nfunction XhrReceiver(url, AjaxObject) {\n  debug(url);\n  EventEmitter.call(this);\n  var self = this;\n\n  this.bufferPosition = 0;\n\n  this.xo = new AjaxObject('POST', url, null);\n  this.xo.on('chunk', this._chunkHandler.bind(this));\n  this.xo.once('finish', function(status, text) {\n    debug('finish', status, text);\n    self._chunkHandler(status, text);\n    self.xo = null;\n    var reason = status === 200 ? 'network' : 'permanent';\n    debug('close', reason);\n    self.emit('close', null, reason);\n    self._cleanup();\n  });\n}\n\ninherits(XhrReceiver, EventEmitter);\n\nXhrReceiver.prototype._chunkHandler = function(status, text) {\n  debug('_chunkHandler', status);\n  if (status !== 200 || !text) {\n    return;\n  }\n\n  for (var idx = -1; ; this.bufferPosition += idx + 1) {\n    var buf = text.slice(this.bufferPosition);\n    idx = buf.indexOf('\\n');\n    if (idx === -1) {\n      break;\n    }\n    var msg = buf.slice(0, idx);\n    if (msg) {\n      debug('message', msg);\n      this.emit('message', msg);\n    }\n  }\n};\n\nXhrReceiver.prototype._cleanup = function() {\n  debug('_cleanup');\n  this.removeAllListeners();\n};\n\nXhrReceiver.prototype.abort = function() {\n  debug('abort');\n  if (this.xo) {\n    this.xo.close();\n    debug('close');\n    this.emit('close', null, 'user');\n    this.xo = null;\n  }\n  this._cleanup();\n};\n\nmodule.exports = XhrReceiver;\n"]}