{"version":3,"sources":["eventsource.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,WAAW,QAAQ,UAAR,CAAf;IACI,eAAe,QAAQ,QAAR,EAAkB,YADrC;IAEI,oBAAoB,QAAQ,aAAR,CAFxB;;AAKA,IAAI,QAAQ,YAAW,CAAE,CAAzB;AACA,IAAI,QAAQ,GAAR,CAAY,QAAZ,KAAyB,YAA7B,EAA2C;AACzC,UAAQ,QAAQ,OAAR,EAAiB,oCAAjB,CAAR;AACD;;AAED,SAAS,mBAAT,CAA6B,GAA7B,EAAkC;AAChC,QAAM,GAAN;AACA,eAAa,IAAb,CAAkB,IAAlB;;AAEA,MAAI,OAAO,IAAX;AACA,MAAI,KAAK,KAAK,EAAL,GAAU,IAAI,iBAAJ,CAAsB,GAAtB,CAAnB;AACA,KAAG,SAAH,GAAe,UAAS,CAAT,EAAY;AACzB,UAAM,SAAN,EAAiB,EAAE,IAAnB;AACA,SAAK,IAAL,CAAU,SAAV,EAAqB,UAAU,EAAE,IAAZ,CAArB;AACD,GAHD;AAIA,KAAG,OAAH,GAAa,UAAS,CAAT,EAAY;AACvB,UAAM,OAAN,EAAe,GAAG,UAAlB,EAA8B,CAA9B;;;AAGA,QAAI,SAAU,GAAG,UAAH,KAAkB,CAAlB,GAAsB,SAAtB,GAAkC,WAAhD;AACA,SAAK,QAAL;AACA,SAAK,MAAL,CAAY,MAAZ;AACD,GAPD;AAQD;;AAED,SAAS,mBAAT,EAA8B,YAA9B;;AAEA,oBAAoB,SAApB,CAA8B,KAA9B,GAAsC,YAAW;AAC/C,QAAM,OAAN;AACA,OAAK,QAAL;AACA,OAAK,MAAL,CAAY,MAAZ;AACD,CAJD;;AAMA,oBAAoB,SAApB,CAA8B,QAA9B,GAAyC,YAAW;AAClD,QAAM,SAAN;AACA,MAAI,KAAK,KAAK,EAAd;AACA,MAAI,EAAJ,EAAQ;AACN,OAAG,SAAH,GAAe,GAAG,OAAH,GAAa,IAA5B;AACA,OAAG,KAAH;AACA,SAAK,EAAL,GAAU,IAAV;AACD;AACF,CARD;;AAUA,oBAAoB,SAApB,CAA8B,MAA9B,GAAuC,UAAS,MAAT,EAAiB;AACtD,QAAM,OAAN,EAAe,MAAf;AACA,MAAI,OAAO,IAAX;;;;AAIA,aAAW,YAAW;AACpB,SAAK,IAAL,CAAU,OAAV,EAAmB,IAAnB,EAAyB,MAAzB;AACA,SAAK,kBAAL;AACD,GAHD,EAGG,GAHH;AAID,CAVD;;AAYA,OAAO,OAAP,GAAiB,mBAAjB","file":"eventsource-compiled.js","sourcesContent":["'use strict';\n\nvar inherits = require('inherits')\n  , EventEmitter = require('events').EventEmitter\n  , EventSourceDriver = require('eventsource')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:receiver:eventsource');\n}\n\nfunction EventSourceReceiver(url) {\n  debug(url);\n  EventEmitter.call(this);\n\n  var self = this;\n  var es = this.es = new EventSourceDriver(url);\n  es.onmessage = function(e) {\n    debug('message', e.data);\n    self.emit('message', decodeURI(e.data));\n  };\n  es.onerror = function(e) {\n    debug('error', es.readyState, e);\n    // ES on reconnection has readyState = 0 or 1.\n    // on network error it's CLOSED = 2\n    var reason = (es.readyState !== 2 ? 'network' : 'permanent');\n    self._cleanup();\n    self._close(reason);\n  };\n}\n\ninherits(EventSourceReceiver, EventEmitter);\n\nEventSourceReceiver.prototype.abort = function() {\n  debug('abort');\n  this._cleanup();\n  this._close('user');\n};\n\nEventSourceReceiver.prototype._cleanup = function() {\n  debug('cleanup');\n  var es = this.es;\n  if (es) {\n    es.onmessage = es.onerror = null;\n    es.close();\n    this.es = null;\n  }\n};\n\nEventSourceReceiver.prototype._close = function(reason) {\n  debug('close', reason);\n  var self = this;\n  // Safari and chrome < 15 crash if we close window before\n  // waiting for ES cleanup. See:\n  // https://code.google.com/p/chromium/issues/detail?id=89155\n  setTimeout(function() {\n    self.emit('close', null, reason);\n    self.removeAllListeners();\n  }, 200);\n};\n\nmodule.exports = EventSourceReceiver;\n"]}