{"version":3,"sources":["htmlfile.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,WAAW,QAAQ,UAAR,CAAf;IACI,cAAc,QAAQ,oBAAR,CADlB;IAEI,WAAW,QAAQ,iBAAR,CAFf;IAGI,eAAe,QAAQ,QAAR,EAAkB,YAHrC;IAII,SAAS,QAAQ,oBAAR,CAJb;;AAOA,IAAI,QAAQ,YAAW,CAAE,CAAzB;AACA,IAAI,QAAQ,GAAR,CAAY,QAAZ,KAAyB,YAA7B,EAA2C;AACzC,UAAQ,QAAQ,OAAR,EAAiB,iCAAjB,CAAR;AACD;;AAED,SAAS,gBAAT,CAA0B,GAA1B,EAA+B;AAC7B,QAAM,GAAN;AACA,eAAa,IAAb,CAAkB,IAAlB;AACA,MAAI,OAAO,IAAX;AACA,cAAY,sBAAZ;;AAEA,OAAK,EAAL,GAAU,MAAM,OAAO,MAAP,CAAc,CAAd,CAAhB;AACA,QAAM,SAAS,QAAT,CAAkB,GAAlB,EAAuB,OAAO,mBAAmB,YAAY,OAAZ,GAAsB,GAAtB,GAA4B,KAAK,EAApD,CAA9B,CAAN;;AAEA,QAAM,gBAAN,EAAwB,iBAAiB,eAAzC;AACA,MAAI,gBAAgB,iBAAiB,eAAjB,GAChB,YAAY,cADI,GACa,YAAY,YAD7C;;AAGA,SAAO,YAAY,OAAnB,EAA4B,KAAK,EAAjC,IAAuC;AACrC,WAAO,YAAW;AAChB,YAAM,OAAN;AACA,WAAK,SAAL,CAAe,MAAf;AACD,KAJoC;AAKrC,aAAS,UAAS,IAAT,EAAe;AACtB,YAAM,SAAN,EAAiB,IAAjB;AACA,WAAK,IAAL,CAAU,SAAV,EAAqB,IAArB;AACD,KARoC;AASrC,UAAM,YAAW;AACf,YAAM,MAAN;AACA,WAAK,QAAL;AACA,WAAK,MAAL,CAAY,SAAZ;AACD;AAboC,GAAvC;AAeA,OAAK,SAAL,GAAiB,cAAc,GAAd,EAAmB,YAAW;AAC7C,UAAM,UAAN;AACA,SAAK,QAAL;AACA,SAAK,MAAL,CAAY,WAAZ;AACD,GAJgB,CAAjB;AAKD;;AAED,SAAS,gBAAT,EAA2B,YAA3B;;AAEA,iBAAiB,SAAjB,CAA2B,KAA3B,GAAmC,YAAW;AAC5C,QAAM,OAAN;AACA,OAAK,QAAL;AACA,OAAK,MAAL,CAAY,MAAZ;AACD,CAJD;;AAMA,iBAAiB,SAAjB,CAA2B,QAA3B,GAAsC,YAAW;AAC/C,QAAM,UAAN;AACA,MAAI,KAAK,SAAT,EAAoB;AAClB,SAAK,SAAL,CAAe,OAAf;AACA,SAAK,SAAL,GAAiB,IAAjB;AACD;AACD,SAAO,OAAO,YAAY,OAAnB,EAA4B,KAAK,EAAjC,CAAP;AACD,CAPD;;AASA,iBAAiB,SAAjB,CAA2B,MAA3B,GAAoC,UAAS,MAAT,EAAiB;AACnD,QAAM,QAAN,EAAgB,MAAhB;AACA,OAAK,IAAL,CAAU,OAAV,EAAmB,IAAnB,EAAyB,MAAzB;AACA,OAAK,kBAAL;AACD,CAJD;;AAMA,iBAAiB,eAAjB,GAAmC,KAAnC;;;AAGA,IAAI,MAAM,CAAC,QAAD,EAAW,MAAX,CAAkB,QAAlB,EAA4B,IAA5B,CAAiC,GAAjC,CAAV;AACA,IAAI,OAAO,MAAX,EAAmB;AACjB,MAAI;AACF,qBAAiB,eAAjB,GAAmC,CAAC,CAAC,IAAI,OAAO,GAAP,CAAJ,CAAgB,UAAhB,CAArC;AACD,GAFD,CAEE,OAAO,CAAP,EAAU;;AAEX;AACF;;AAED,iBAAiB,OAAjB,GAA2B,iBAAiB,eAAjB,IAAoC,YAAY,aAA3E;;AAEA,OAAO,OAAP,GAAiB,gBAAjB","file":"htmlfile-compiled.js","sourcesContent":["'use strict';\n\nvar inherits = require('inherits')\n  , iframeUtils = require('../../utils/iframe')\n  , urlUtils = require('../../utils/url')\n  , EventEmitter = require('events').EventEmitter\n  , random = require('../../utils/random')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:receiver:htmlfile');\n}\n\nfunction HtmlfileReceiver(url) {\n  debug(url);\n  EventEmitter.call(this);\n  var self = this;\n  iframeUtils.polluteGlobalNamespace();\n\n  this.id = 'a' + random.string(6);\n  url = urlUtils.addQuery(url, 'c=' + decodeURIComponent(iframeUtils.WPrefix + '.' + this.id));\n\n  debug('using htmlfile', HtmlfileReceiver.htmlfileEnabled);\n  var constructFunc = HtmlfileReceiver.htmlfileEnabled ?\n      iframeUtils.createHtmlfile : iframeUtils.createIframe;\n\n  global[iframeUtils.WPrefix][this.id] = {\n    start: function() {\n      debug('start');\n      self.iframeObj.loaded();\n    }\n  , message: function(data) {\n      debug('message', data);\n      self.emit('message', data);\n    }\n  , stop: function() {\n      debug('stop');\n      self._cleanup();\n      self._close('network');\n    }\n  };\n  this.iframeObj = constructFunc(url, function() {\n    debug('callback');\n    self._cleanup();\n    self._close('permanent');\n  });\n}\n\ninherits(HtmlfileReceiver, EventEmitter);\n\nHtmlfileReceiver.prototype.abort = function() {\n  debug('abort');\n  this._cleanup();\n  this._close('user');\n};\n\nHtmlfileReceiver.prototype._cleanup = function() {\n  debug('_cleanup');\n  if (this.iframeObj) {\n    this.iframeObj.cleanup();\n    this.iframeObj = null;\n  }\n  delete global[iframeUtils.WPrefix][this.id];\n};\n\nHtmlfileReceiver.prototype._close = function(reason) {\n  debug('_close', reason);\n  this.emit('close', null, reason);\n  this.removeAllListeners();\n};\n\nHtmlfileReceiver.htmlfileEnabled = false;\n\n// obfuscate to avoid firewalls\nvar axo = ['Active'].concat('Object').join('X');\nif (axo in global) {\n  try {\n    HtmlfileReceiver.htmlfileEnabled = !!new global[axo]('htmlfile');\n  } catch (x) {\n    // intentionally empty\n  }\n}\n\nHtmlfileReceiver.enabled = HtmlfileReceiver.htmlfileEnabled || iframeUtils.iframeEnabled;\n\nmodule.exports = HtmlfileReceiver;\n"]}