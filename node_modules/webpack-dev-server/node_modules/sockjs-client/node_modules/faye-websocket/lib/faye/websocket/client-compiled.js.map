{"version":3,"sources":["client.js"],"names":[],"mappings":"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","file":"client-compiled.js","sourcesContent":["var util   = require('util'),\n    net    = require('net'),\n    tls    = require('tls'),\n    url    = require('url'),\n    driver = require('websocket-driver'),\n    API    = require('./api'),\n    Event  = require('./api/event');\n\nvar DEFAULT_PORTS    = {'http:': 80, 'https:': 443, 'ws:':80, 'wss:': 443},\n    SECURE_PROTOCOLS = ['https:', 'wss:'];\n\nvar Client = function(_url, protocols, options) {\n  options = options || {};\n\n  this.url     = _url;\n  this._driver = driver.client(this.url, {maxLength: options.maxLength, protocols: protocols});\n\n  ['open', 'error'].forEach(function(event) {\n    this._driver.on(event, function() {\n      self.headers    = self._driver.headers;\n      self.statusCode = self._driver.statusCode;\n    });\n  }, this);\n\n  var proxy      = options.proxy || {},\n      endpoint   = url.parse(proxy.origin || this.url),\n      port       = endpoint.port || DEFAULT_PORTS[endpoint.protocol],\n      secure     = SECURE_PROTOCOLS.indexOf(endpoint.protocol) >= 0,\n      onConnect  = function() { self._onConnect() },\n      netOptions = options.net || {},\n      originTLS  = options.tls || {},\n      socketTLS  = proxy.origin ? (proxy.tls || {}) : originTLS,\n      self       = this;\n\n  netOptions.host = socketTLS.host = endpoint.hostname;\n  netOptions.port = socketTLS.port = port;\n\n  originTLS.ca = originTLS.ca || options.ca;\n  socketTLS.servername = socketTLS.servername || endpoint.hostname;\n\n  this._stream = secure\n               ? tls.connect(socketTLS, onConnect)\n               : net.connect(netOptions, onConnect);\n\n  if (proxy.origin) this._configureProxy(proxy, originTLS);\n\n  API.call(this, options);\n};\nutil.inherits(Client, API);\n\nClient.prototype._onConnect = function() {\n  var worker = this._proxy || this._driver;\n  worker.start();\n};\n\nClient.prototype._configureProxy = function(proxy, originTLS) {\n  var uri    = url.parse(this.url),\n      secure = SECURE_PROTOCOLS.indexOf(uri.protocol) >= 0,\n      self   = this,\n      name;\n\n  this._proxy = this._driver.proxy(proxy.origin);\n\n  if (proxy.headers) {\n    for (name in proxy.headers) this._proxy.setHeader(name, proxy.headers[name]);\n  }\n\n  this._proxy.pipe(this._stream, {end: false});\n  this._stream.pipe(this._proxy);\n\n  this._proxy.on('connect', function() {\n    if (secure) {\n      var options = {socket: self._stream, servername: uri.hostname};\n      for (name in originTLS) options[name] = originTLS[name];\n      self._stream = tls.connect(options);\n      self._configureStream();\n    }\n    self._driver.io.pipe(self._stream);\n    self._stream.pipe(self._driver.io);\n    self._driver.start();\n  });\n\n  this._proxy.on('error', function(error) {\n    self._driver.emit('error', error);\n  });\n};\n\nmodule.exports = Client;\n"]}