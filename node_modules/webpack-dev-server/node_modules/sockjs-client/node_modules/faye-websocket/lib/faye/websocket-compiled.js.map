{"version":3,"sources":["websocket.js"],"names":[],"mappings":";;;;;;AAMA,IAAI,OAAS,QAAQ,MAAR,CAAb;IACI,SAAS,QAAQ,kBAAR,CADb;IAEI,MAAS,QAAQ,iBAAR,CAFb;;AAIA,IAAI,YAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B,IAA1B,EAAgC,SAAhC,EAA2C,OAA3C,EAAoD;AAClE,YAAU,WAAW,EAArB;;AAEA,OAAK,OAAL,GAAe,MAAf;AACA,OAAK,OAAL,GAAe,OAAO,IAAP,CAAY,OAAZ,EAAqB,EAAC,WAAW,QAAQ,SAApB,EAA+B,WAAW,SAA1C,EAArB,CAAf;;AAEA,MAAI,OAAO,IAAX;AACA,MAAI,CAAC,KAAK,OAAN,IAAiB,CAAC,KAAK,OAAL,CAAa,QAAnC,EAA6C;AAC7C,MAAI,CAAC,KAAK,OAAL,CAAa,QAAlB,EAA4B,OAAO,KAAK,OAAL,CAAa,GAAb,EAAP;;AAE5B,MAAI,UAAU,YAAW;AAAE,SAAK,OAAL,CAAa,cAAb,CAA4B,MAA5B,EAAoC,OAApC;AAA8C,GAAzE;AACA,OAAK,OAAL,CAAa,EAAb,CAAgB,MAAhB,EAAwB,OAAxB;;AAEA,MAAI,IAAJ,CAAS,IAAT,EAAe,OAAf;;AAEA,UAAQ,QAAR,CAAiB,YAAW;AAC1B,SAAK,OAAL,CAAa,KAAb;AACA,SAAK,OAAL,CAAa,EAAb,CAAgB,KAAhB,CAAsB,IAAtB;AACD,GAHD;AAID,CAnBD;AAoBA,KAAK,QAAL,CAAc,SAAd,EAAyB,GAAzB;;AAEA,UAAU,WAAV,GAAwB,UAAS,OAAT,EAAkB;AACxC,SAAO,OAAO,WAAP,CAAmB,OAAnB,CAAP;AACD,CAFD;;AAIA,UAAU,eAAV,GAA4B,UAAS,OAAT,EAAkB,SAAlB,EAA6B;AACvD,SAAO,eAAP,CAAuB,OAAvB,EAAgC,SAAhC;AACD,CAFD;;AAIA,UAAU,SAAV,GAAwB,SAAxB;AACA,UAAU,MAAV,GAAwB,QAAQ,oBAAR,CAAxB;AACA,UAAU,WAAV,GAAwB,QAAQ,eAAR,CAAxB;;AAEA,OAAO,OAAP,GAAwB,SAAxB","file":"websocket-compiled.js","sourcesContent":["// API references:\n//\n// * http://dev.w3.org/html5/websockets/\n// * http://dvcs.w3.org/hg/domcore/raw-file/tip/Overview.html#interface-eventtarget\n// * http://dvcs.w3.org/hg/domcore/raw-file/tip/Overview.html#interface-event\n\nvar util   = require('util'),\n    driver = require('websocket-driver'),\n    API    = require('./websocket/api');\n\nvar WebSocket = function(request, socket, body, protocols, options) {\n  options = options || {};\n\n  this._stream = socket;\n  this._driver = driver.http(request, {maxLength: options.maxLength, protocols: protocols});\n\n  var self = this;\n  if (!this._stream || !this._stream.writable) return;\n  if (!this._stream.readable) return this._stream.end();\n\n  var catchup = function() { self._stream.removeListener('data', catchup) };\n  this._stream.on('data', catchup);\n\n  API.call(this, options);\n\n  process.nextTick(function() {\n    self._driver.start();\n    self._driver.io.write(body);\n  });\n};\nutil.inherits(WebSocket, API);\n\nWebSocket.isWebSocket = function(request) {\n  return driver.isWebSocket(request);\n};\n\nWebSocket.validateOptions = function(options, validKeys) {\n  driver.validateOptions(options, validKeys);\n};\n\nWebSocket.WebSocket   = WebSocket;\nWebSocket.Client      = require('./websocket/client');\nWebSocket.EventSource = require('./eventsource');\n\nmodule.exports        = WebSocket;\n"]}