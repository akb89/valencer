{"version":3,"sources":["hybi.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,SAAa,QAAQ,QAAR,CAAjB;IACI,OAAa,QAAQ,MAAR,CADjB;IAEI,aAAa,QAAQ,sBAAR,CAFjB;IAGI,OAAa,QAAQ,QAAR,CAHjB;IAII,QAAa,QAAQ,cAAR,CAJjB;IAKI,UAAa,QAAQ,gBAAR,CALjB;;AAOA,IAAI,OAAO,UAAS,OAAT,EAAkB,GAAlB,EAAuB,OAAvB,EAAgC;AACzC,OAAK,KAAL,CAAW,IAAX,EAAiB,SAAjB;;AAEA,OAAK,WAAL,GAAuB,IAAI,UAAJ,EAAvB;AACA,OAAK,MAAL,GAAuB,CAAvB;AACA,OAAK,QAAL,GAAuB,KAAK,QAAL,CAAc,OAArC;AACA,OAAK,UAAL,GAAuB,KAAK,QAAL,CAAc,SAAd,IAA2B,EAAlD;AACA,OAAK,eAAL,GAAuB,KAAK,QAAL,CAAc,cAArC;AACA,OAAK,cAAL,GAAuB,EAAvB;;AAEA,MAAI,OAAO,KAAK,UAAZ,KAA2B,QAA/B,EACE,KAAK,UAAL,GAAkB,KAAK,UAAL,CAAgB,KAAhB,CAAsB,OAAtB,CAAlB;;AAEF,MAAI,CAAC,KAAK,QAAV,EAAoB;;AAEpB,MAAI,SAAY,KAAK,QAAL,CAAc,OAAd,CAAsB,mBAAtB,CAAhB;MACI,SAAY,KAAK,QAAL,CAAc,OAAd,CAAsB,wBAAtB,CADhB;MAEI,UAAY,KAAK,QAAL,CAAc,OAAd,CAAsB,uBAAtB,CAFhB;MAGI,YAAY,KAAK,UAHrB;;AAKA,OAAK,QAAL,CAAc,GAAd,CAAkB,SAAlB,EAA6B,WAA7B;AACA,OAAK,QAAL,CAAc,GAAd,CAAkB,YAAlB,EAAgC,SAAhC;AACA,OAAK,QAAL,CAAc,GAAd,CAAkB,sBAAlB,EAA0C,KAAK,cAAL,CAAoB,MAApB,CAA1C;;AAEA,MAAI,WAAW,SAAf,EAA0B;AACxB,QAAI,OAAO,MAAP,KAAkB,QAAtB,EAAgC,SAAS,OAAO,KAAP,CAAa,OAAb,CAAT;AAChC,SAAK,QAAL,GAAgB,OAAO,MAAP,CAAc,UAAS,CAAT,EAAY;AAAE,aAAO,UAAU,OAAV,CAAkB,CAAlB,KAAwB,CAA/B;AAAkC,KAA9D,EAAgE,CAAhE,CAAhB;AACA,QAAI,KAAK,QAAT,EAAmB,KAAK,QAAL,CAAc,GAAd,CAAkB,wBAAlB,EAA4C,KAAK,QAAjD;AACpB;;AAED,OAAK,OAAL,GAAe,UAAU,OAAzB;AACD,CA/BD;AAgCA,KAAK,QAAL,CAAc,IAAd,EAAoB,IAApB;;AAEA,KAAK,IAAL,GAAY,UAAS,OAAT,EAAkB,IAAlB,EAAwB,MAAxB,EAAgC;AAC1C,MAAI,CAAC,IAAD,IAAS,KAAK,MAAL,KAAgB,CAA7B,EAAgC,OAAO,OAAP;AAChC,WAAS,UAAU,CAAnB;;AAEA,OAAK,IAAI,IAAI,CAAR,EAAW,IAAI,QAAQ,MAAR,GAAiB,MAArC,EAA6C,IAAI,CAAjD,EAAoD,GAApD,EAAyD;AACvD,YAAQ,SAAS,CAAjB,IAAsB,QAAQ,SAAS,CAAjB,IAAsB,KAAK,IAAI,CAAT,CAA5C;AACD;AACD,SAAO,OAAP;AACD,CARD;;AAUA,KAAK,cAAL,GAAsB,UAAS,GAAT,EAAc;AAClC,MAAI,OAAO,OAAO,UAAP,CAAkB,MAAlB,CAAX;AACA,OAAK,MAAL,CAAY,MAAM,KAAK,IAAvB;AACA,SAAO,KAAK,MAAL,CAAY,QAAZ,CAAP;AACD,CAJD;;AAMA,KAAK,IAAL,GAAY,sCAAZ;;AAEA,IAAI,WAAW;AACb,OAAQ,IADK;AAEb,QAAQ,IAFK;AAGb,QAAQ,IAHK;AAIb,QAAQ,IAJK;AAKb,QAAQ,IALK;AAMb,UAAQ,IANK;AAOb,UAAQ,IAPK;;AASb,WAAS;AACP,kBAAc,CADP;AAEP,UAAc,CAFP;AAGP,YAAc,CAHP;AAIP,WAAc,CAJP;AAKP,UAAc,CALP;AAMP,UAAc;AANP,GATI;;AAkBb,gBAAiB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,EAAhB,CAlBJ;AAmBb,mBAAiB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAnBJ;AAoBb,mBAAiB,CAAC,CAAD,EAAI,CAAJ,CApBJ;;AAsBb,UAAQ;AACN,oBAAsB,IADhB;AAEN,gBAAsB,IAFhB;AAGN,oBAAsB,IAHhB;AAIN,kBAAsB,IAJhB;AAKN,oBAAsB,IALhB;AAMN,sBAAsB,IANhB;AAON,eAAsB,IAPhB;AAQN,qBAAsB,IARhB;AASN,0BAAsB;AAThB,GAtBK;;AAkCb,eAAoB,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,IAAzB,EAA+B,IAA/B,EAAqC,IAArC,EAA2C,IAA3C,EAAiD,IAAjD,CAlCP;AAmCb,sBAAoB,IAnCP;AAoCb,sBAAoB,IApCP;AAqCb,sBAAoB,IArCP;;;AAwCb,cAAY,uNAxCC;;AA0Cb,gBAAc,UAAS,SAAT,EAAoB;AAChC,SAAK,WAAL,CAAiB,GAAjB,CAAqB,SAArB;AACA,WAAO,IAAP;AACD,GA7CY;;AA+Cb,SAAO,UAAS,KAAT,EAAgB;AACrB,SAAK,OAAL,CAAa,GAAb,CAAiB,KAAjB;AACA,QAAI,SAAS,IAAb;AACA,WAAO,MAAP,EAAe;AACb,cAAQ,KAAK,MAAb;AACE,aAAK,CAAL;AACE,mBAAS,KAAK,OAAL,CAAa,IAAb,CAAkB,CAAlB,CAAT;AACA,cAAI,MAAJ,EAAY,KAAK,YAAL,CAAkB,OAAO,CAAP,CAAlB;AACZ;;AAEF,aAAK,CAAL;AACE,mBAAS,KAAK,OAAL,CAAa,IAAb,CAAkB,CAAlB,CAAT;AACA,cAAI,MAAJ,EAAY,KAAK,YAAL,CAAkB,OAAO,CAAP,CAAlB;AACZ;;AAEF,aAAK,CAAL;AACE,mBAAS,KAAK,OAAL,CAAa,IAAb,CAAkB,KAAK,MAAL,CAAY,WAA9B,CAAT;AACA,cAAI,MAAJ,EAAY,KAAK,oBAAL,CAA0B,MAA1B;AACZ;;AAEF,aAAK,CAAL;AACE,mBAAS,KAAK,OAAL,CAAa,IAAb,CAAkB,CAAlB,CAAT;AACA,cAAI,MAAJ,EAAY;AACV,iBAAK,MAAL,GAAc,CAAd;AACA,iBAAK,MAAL,CAAY,UAAZ,GAAyB,MAAzB;AACD;AACD;;AAEF,aAAK,CAAL;AACE,mBAAS,KAAK,OAAL,CAAa,IAAb,CAAkB,KAAK,MAAL,CAAY,MAA9B,CAAT;AACA,cAAI,MAAJ,EAAY;AACV,iBAAK,MAAL,GAAc,CAAd;AACA,iBAAK,UAAL,CAAgB,MAAhB;AACD;AACD;;AAEF;AACE,mBAAS,IAAT;AAjCJ;AAmCD;AACF,GAvFY;;AAyFb,QAAM,UAAS,OAAT,EAAkB;AACtB,QAAI,KAAK,UAAL,GAAkB,CAAtB,EAAyB,OAAO,KAAP;AACzB,WAAO,KAAK,KAAL,CAAW,OAAX,EAAoB,MAApB,CAAP;AACD,GA5FY;;AA8Fb,UAAQ,UAAS,OAAT,EAAkB;AACxB,QAAI,KAAK,UAAL,GAAkB,CAAtB,EAAyB,OAAO,KAAP;AACzB,WAAO,KAAK,KAAL,CAAW,OAAX,EAAoB,QAApB,CAAP;AACD,GAjGY;;AAmGb,QAAM,UAAS,OAAT,EAAkB,QAAlB,EAA4B;AAChC,QAAI,KAAK,UAAL,GAAkB,CAAtB,EAAyB,OAAO,KAAP;AACzB,cAAU,WAAW,EAArB;AACA,QAAI,QAAJ,EAAc,KAAK,cAAL,CAAoB,OAApB,IAA+B,QAA/B;AACd,WAAO,KAAK,KAAL,CAAW,OAAX,EAAoB,MAApB,CAAP;AACD,GAxGY;;AA0Gb,QAAM,UAAS,OAAT,EAAkB;AACpB,QAAI,KAAK,UAAL,GAAkB,CAAtB,EAAyB,OAAO,KAAP;AACzB,cAAU,WAAU,EAApB;AACA,WAAO,KAAK,KAAL,CAAW,OAAX,EAAoB,MAApB,CAAP;AACH,GA9GY;;AAgHb,SAAO,UAAS,MAAT,EAAiB,IAAjB,EAAuB;AAC5B,aAAS,UAAU,EAAnB;AACA,WAAS,QAAU,KAAK,MAAL,CAAY,cAA/B;;AAEA,QAAI,KAAK,UAAL,IAAmB,CAAvB,EAA0B;AACxB,WAAK,UAAL,GAAkB,CAAlB;AACA,WAAK,IAAL,CAAU,OAAV,EAAmB,IAAI,KAAK,UAAT,CAAoB,IAApB,EAA0B,MAA1B,CAAnB;AACA,aAAO,IAAP;AACD,KAJD,MAIO,IAAI,KAAK,UAAL,KAAoB,CAAxB,EAA2B;AAChC,WAAK,UAAL,GAAkB,CAAlB;AACA,WAAK,WAAL,CAAiB,KAAjB,CAAuB,YAAW;AAAE,aAAK,KAAL,CAAW,MAAX,EAAmB,OAAnB,EAA4B,IAA5B;AAAmC,OAAvE,EAAyE,IAAzE;AACA,aAAO,IAAP;AACD,KAJM,MAIA;AACL,aAAO,KAAP;AACD;AACF,GA/HY;;AAiIb,SAAO,UAAS,MAAT,EAAiB,IAAjB,EAAuB,IAAvB,EAA6B;AAClC,QAAI,KAAK,UAAL,IAAmB,CAAvB,EAA0B,OAAO,KAAK,MAAL,CAAY,CAAC,MAAD,EAAS,IAAT,EAAe,IAAf,CAAZ,CAAP;AAC1B,QAAI,KAAK,UAAL,GAAkB,CAAtB,EAAyB,OAAO,KAAP;;AAEzB,QAAI,kBAAkB,KAAtB,EAAgC,SAAS,IAAI,MAAJ,CAAW,MAAX,CAAT;AAChC,QAAI,OAAO,MAAP,KAAkB,QAAtB,EAAgC,SAAS,OAAO,QAAP,EAAT;;AAEhC,QAAI,UAAU,IAAI,OAAJ,EAAd;QACI,SAAW,OAAO,MAAP,KAAkB,QADjC;QAEI,OAFJ;QAEa,IAFb;;AAIA,YAAQ,IAAR,GAAiB,QAAQ,IAAR,GAAe,QAAQ,IAAR,GAAe,KAA/C;AACA,YAAQ,MAAR,GAAiB,KAAK,OAAL,CAAa,SAAS,SAAS,MAAT,GAAkB,QAA3B,CAAb,CAAjB;;AAEA,cAAU,SAAS,IAAI,MAAJ,CAAW,MAAX,EAAmB,MAAnB,CAAT,GAAsC,MAAhD;;AAEA,QAAI,IAAJ,EAAU;AACR,aAAO,OAAP;AACA,gBAAU,IAAI,MAAJ,CAAW,IAAI,KAAK,MAApB,CAAV;AACA,cAAQ,aAAR,CAAsB,IAAtB,EAA4B,CAA5B;AACA,WAAK,IAAL,CAAU,OAAV,EAAmB,CAAnB;AACD;AACD,YAAQ,IAAR,GAAe,OAAf;;AAEA,QAAI,iBAAiB,UAAS,OAAT,EAAkB;AACrC,UAAI,QAAQ,IAAI,KAAJ,EAAZ;;AAEA,YAAM,KAAN,GAAgB,IAAhB;AACA,YAAM,IAAN,GAAgB,QAAQ,IAAxB;AACA,YAAM,IAAN,GAAgB,QAAQ,IAAxB;AACA,YAAM,IAAN,GAAgB,QAAQ,IAAxB;AACA,YAAM,MAAN,GAAgB,QAAQ,MAAxB;AACA,YAAM,MAAN,GAAgB,CAAC,CAAC,KAAK,QAAvB;AACA,YAAM,MAAN,GAAgB,QAAQ,IAAR,CAAa,MAA7B;AACA,YAAM,OAAN,GAAgB,QAAQ,IAAxB;;AAEA,UAAI,MAAM,MAAV,EAAkB,MAAM,UAAN,GAAmB,OAAO,WAAP,CAAmB,CAAnB,CAAnB;;AAElB,WAAK,UAAL,CAAgB,KAAhB;AACD,KAfD;;AAiBA,QAAI,KAAK,eAAL,CAAqB,OAArB,CAA6B,QAAQ,MAArC,KAAgD,CAApD,EACE,KAAK,WAAL,CAAiB,sBAAjB,CAAwC,OAAxC,EAAiD,UAAS,KAAT,EAAgB,OAAhB,EAAyB;AACxE,UAAI,KAAJ,EAAW,OAAO,KAAK,KAAL,CAAW,iBAAX,EAA8B,MAAM,OAApC,CAAP;AACX,qBAAe,IAAf,CAAoB,IAApB,EAA0B,OAA1B;AACD,KAHD,EAGG,IAHH,EADF,KAME,eAAe,IAAf,CAAoB,IAApB,EAA0B,OAA1B;;AAEF,WAAO,IAAP;AACD,GAnLY;;AAqLb,cAAY,UAAS,KAAT,EAAgB;AAC1B,QAAI,SAAS,MAAM,MAAnB;QACI,SAAU,UAAU,GAAX,GAAkB,CAAlB,GAAuB,UAAU,KAAV,GAAkB,CAAlB,GAAsB,EAD1D;QAEI,SAAS,UAAU,MAAM,MAAN,GAAe,CAAf,GAAmB,CAA7B,CAFb;QAGI,SAAS,IAAI,MAAJ,CAAW,SAAS,MAApB,CAHb;QAII,SAAS,MAAM,MAAN,GAAe,KAAK,IAApB,GAA2B,CAJxC;;AAMA,WAAO,CAAP,IAAY,CAAC,MAAM,KAAN,GAAc,KAAK,GAAnB,GAAyB,CAA1B,KACC,MAAM,IAAN,GAAa,KAAK,IAAlB,GAAyB,CAD1B,KAEC,MAAM,IAAN,GAAa,KAAK,IAAlB,GAAyB,CAF1B,KAGC,MAAM,IAAN,GAAa,KAAK,IAAlB,GAAyB,CAH1B,IAIA,MAAM,MAJlB;;AAMA,QAAI,UAAU,GAAd,EAAmB;AACjB,aAAO,CAAP,IAAY,SAAS,MAArB;AACD,KAFD,MAEO,IAAI,UAAU,KAAd,EAAqB;AAC1B,aAAO,CAAP,IAAY,SAAS,GAArB;AACA,aAAO,aAAP,CAAqB,MAArB,EAA6B,CAA7B;AACD,KAHM,MAGA;AACL,aAAO,CAAP,IAAY,SAAS,GAArB;AACA,aAAO,aAAP,CAAqB,KAAK,KAAL,CAAW,SAAS,WAApB,CAArB,EAAuD,CAAvD;AACA,aAAO,aAAP,CAAqB,SAAS,WAA9B,EAA2C,CAA3C;AACD;;AAED,UAAM,OAAN,CAAc,IAAd,CAAmB,MAAnB,EAA2B,MAA3B;;AAEA,QAAI,MAAM,MAAV,EAAkB;AAChB,YAAM,UAAN,CAAiB,IAAjB,CAAsB,MAAtB,EAA8B,MAA9B;AACA,WAAK,IAAL,CAAU,MAAV,EAAkB,MAAM,UAAxB,EAAoC,MAApC;AACD;;AAED,SAAK,MAAL,CAAY,MAAZ;AACD,GArNY;;AAuNb,sBAAoB,YAAW;AAC7B,QAAI;AACF,UAAI,aAAa,KAAK,WAAL,CAAiB,gBAAjB,CAAkC,KAAK,QAAL,CAAc,OAAd,CAAsB,0BAAtB,CAAlC,CAAjB;AACD,KAFD,CAEE,OAAO,CAAP,EAAU;AACV,aAAO,KAAK,KAAL,CAAW,gBAAX,EAA6B,EAAE,OAA/B,CAAP;AACD;;AAED,QAAI,UAAJ,EAAgB,KAAK,QAAL,CAAc,GAAd,CAAkB,0BAAlB,EAA8C,UAA9C;;AAEhB,QAAI,QAAU,kCAAd;QACI,UAAU,CAAC,KAAD,EAAQ,KAAK,QAAL,CAAc,QAAd,EAAR,EAAkC,EAAlC,CADd;;AAGA,WAAO,IAAI,MAAJ,CAAW,QAAQ,IAAR,CAAa,MAAb,CAAX,EAAiC,MAAjC,CAAP;AACD,GApOY;;AAsOb,aAAW,UAAS,IAAT,EAAe,MAAf,EAAuB,KAAvB,EAA8B;AACvC,WAAO,KAAK,MAAZ;AACA,WAAO,KAAK,QAAZ;AACA,SAAK,MAAL,GAAc,CAAd;;AAEA,QAAI,iBAAkB,KAAK,UAAL,KAAoB,CAA1C;AACA,SAAK,UAAL,GAAkB,CAAlB;;AAEA,SAAK,WAAL,CAAiB,KAAjB,CAAuB,YAAW;AAChC,UAAI,cAAJ,EAAoB,KAAK,KAAL,CAAW,MAAX,EAAmB,OAAnB,EAA4B,IAA5B;AACpB,WAAK,UAAL,GAAkB,CAAlB;AACA,UAAI,KAAJ,EAAW,KAAK,IAAL,CAAU,OAAV,EAAmB,IAAI,KAAJ,CAAU,MAAV,CAAnB;AACX,WAAK,IAAL,CAAU,OAAV,EAAmB,IAAI,KAAK,UAAT,CAAoB,IAApB,EAA0B,MAA1B,CAAnB;AACD,KALD,EAKG,IALH;AAMD,GApPY;;AAsPb,SAAO,UAAS,IAAT,EAAe,OAAf,EAAwB;AAC7B,QAAI,KAAK,UAAL,GAAkB,CAAtB,EAAyB;AACzB,SAAK,SAAL,CAAe,KAAK,MAAL,CAAY,IAAZ,CAAf,EAAkC,OAAlC,EAA2C,IAA3C;AACD,GAzPY;;AA2Pb,gBAAc,UAAS,KAAT,EAAgB;AAC5B,QAAI,OAAO,CAAC,KAAK,IAAN,EAAY,KAAK,IAAjB,EAAuB,KAAK,IAA5B,EAAkC,GAAlC,CAAsC,UAAS,GAAT,EAAc;AAC7D,aAAO,CAAC,QAAQ,GAAT,MAAkB,GAAzB;AACD,KAFU,CAAX;;AAIA,QAAI,QAAQ,KAAK,MAAL,GAAc,IAAI,KAAJ,EAA1B;;AAEA,UAAM,KAAN,GAAe,CAAC,QAAQ,KAAK,GAAd,MAAuB,KAAK,GAA3C;AACA,UAAM,IAAN,GAAe,KAAK,CAAL,CAAf;AACA,UAAM,IAAN,GAAe,KAAK,CAAL,CAAf;AACA,UAAM,IAAN,GAAe,KAAK,CAAL,CAAf;AACA,UAAM,MAAN,GAAgB,QAAQ,KAAK,MAA7B;;AAEA,SAAK,MAAL,GAAc,CAAd;;AAEA,QAAI,CAAC,KAAK,WAAL,CAAiB,aAAjB,CAA+B,KAA/B,CAAL,EACE,OAAO,KAAK,KAAL,CAAW,gBAAX,EACH,oDAAoD,MAAM,IAAN,GAAa,CAAb,GAAiB,CAArE,IACA,gBADA,IACoB,MAAM,IAAN,GAAa,CAAb,GAAiB,CADrC,IAEA,gBAFA,IAEoB,MAAM,IAAN,GAAa,CAAb,GAAiB,CAFrC,CADG,CAAP;;AAKF,QAAI,KAAK,YAAL,CAAkB,OAAlB,CAA0B,MAAM,MAAhC,IAA0C,CAA9C,EACE,OAAO,KAAK,KAAL,CAAW,gBAAX,EAA6B,gCAAgC,MAAM,MAAnE,CAAP;;AAEF,QAAI,KAAK,eAAL,CAAqB,OAArB,CAA6B,MAAM,MAAnC,IAA6C,CAA7C,IAAkD,CAAC,MAAM,KAA7D,EACE,OAAO,KAAK,KAAL,CAAW,gBAAX,EAA6B,iDAAiD,MAAM,MAApF,CAAP;;AAEF,QAAI,KAAK,QAAL,IAAiB,KAAK,eAAL,CAAqB,OAArB,CAA6B,MAAM,MAAnC,KAA8C,CAAnE,EACE,OAAO,KAAK,KAAL,CAAW,gBAAX,EAA6B,qEAA7B,CAAP;AACH,GAxRY;;AA0Rb,gBAAc,UAAS,KAAT,EAAgB;AAC5B,QAAI,QAAQ,KAAK,MAAjB;AACA,UAAM,MAAN,GAAe,CAAC,QAAQ,KAAK,IAAd,MAAwB,KAAK,IAA5C;AACA,UAAM,MAAN,GAAgB,QAAQ,KAAK,MAA7B;;AAEA,QAAI,MAAM,MAAN,IAAgB,CAAhB,IAAqB,MAAM,MAAN,IAAgB,GAAzC,EAA8C;AAC5C,WAAK,MAAL,GAAc,MAAM,MAAN,GAAe,CAAf,GAAmB,CAAjC;AACA,UAAI,CAAC,KAAK,iBAAL,EAAL,EAA+B;AAChC,KAHD,MAGO;AACL,WAAK,MAAL,GAAc,CAAd;AACA,YAAM,WAAN,GAAqB,MAAM,MAAN,KAAiB,GAAjB,GAAuB,CAAvB,GAA2B,CAAhD;AACD;;AAED,QAAI,KAAK,eAAL,IAAwB,CAAC,MAAM,MAAnC,EACE,OAAO,KAAK,KAAL,CAAW,cAAX,EAA2B,iDAA3B,CAAP;AACH,GAzSY;;AA2Sb,wBAAsB,UAAS,MAAT,EAAiB;AACrC,QAAI,QAAQ,KAAK,MAAjB;AACA,UAAM,MAAN,GAAe,KAAK,SAAL,CAAe,MAAf,CAAf;;AAEA,SAAK,MAAL,GAAc,MAAM,MAAN,GAAe,CAAf,GAAmB,CAAjC;;AAEA,QAAI,KAAK,eAAL,CAAqB,OAArB,CAA6B,MAAM,MAAnC,IAA6C,CAA7C,IAAkD,MAAM,MAAN,GAAe,GAArE,EACE,OAAO,KAAK,KAAL,CAAW,gBAAX,EAA6B,qDAAqD,MAAM,MAAxF,CAAP;;AAEF,QAAI,CAAC,KAAK,iBAAL,EAAL,EAA+B;AAChC,GArTY;;AAuTb,qBAAmB,YAAW;AAC5B,QAAI,SAAS,KAAK,QAAL,GAAgB,KAAK,QAAL,CAAc,MAA9B,GAAuC,CAApD;;AAEA,QAAI,SAAS,KAAK,MAAL,CAAY,MAArB,GAA8B,KAAK,UAAvC,EAAmD;AACjD,WAAK,KAAL,CAAW,WAAX,EAAwB,kCAAxB;AACA,aAAO,KAAP;AACD,KAHD,MAGO;AACL,aAAO,IAAP;AACD;AACF,GAhUY;;AAkUb,cAAY,UAAS,MAAT,EAAiB;AAC3B,QAAI,QAAU,KAAK,MAAnB;QACI,UAAU,MAAM,OAAN,GAAgB,KAAK,IAAL,CAAU,MAAV,EAAkB,MAAM,UAAxB,CAD9B;QAEI,SAAU,MAAM,MAFpB;QAGI,OAHJ;QAII,IAJJ;QAIU,MAJV;QAKI,SALJ;QAKe,QALf;;AAOA,WAAO,KAAK,MAAZ;;AAEA,QAAI,WAAW,KAAK,OAAL,CAAa,YAA5B,EAA0C;AACxC,UAAI,CAAC,KAAK,QAAV,EAAoB,OAAO,KAAK,KAAL,CAAW,gBAAX,EAA6B,wCAA7B,CAAP;AACpB,WAAK,QAAL,CAAc,SAAd,CAAwB,KAAxB;AACD;;AAED,QAAI,WAAW,KAAK,OAAL,CAAa,IAAxB,IAAgC,WAAW,KAAK,OAAL,CAAa,MAA5D,EAAoE;AAClE,WAAK,QAAL,GAAgB,IAAI,OAAJ,EAAhB;AACA,WAAK,QAAL,CAAc,SAAd,CAAwB,KAAxB;AACD;;AAED,QAAI,MAAM,KAAN,IAAe,KAAK,eAAL,CAAqB,OAArB,CAA6B,MAA7B,KAAwC,CAA3D,EACE,OAAO,KAAK,YAAL,CAAkB,KAAK,QAAvB,CAAP;;AAEF,QAAI,WAAW,KAAK,OAAL,CAAa,KAA5B,EAAmC;AACjC,aAAU,QAAQ,MAAR,IAAkB,CAAnB,GAAwB,QAAQ,YAAR,CAAqB,CAArB,CAAxB,GAAkD,IAA3D;AACA,eAAU,QAAQ,MAAR,GAAiB,CAAlB,GAAuB,KAAK,OAAL,CAAa,QAAQ,KAAR,CAAc,CAAd,CAAb,CAAvB,GAAwD,IAAjE;;AAEA,UAAI,EAAE,QAAQ,MAAR,KAAmB,CAArB,KACA,EAAE,SAAS,IAAT,IAAiB,QAAQ,KAAK,kBAA9B,IAAoD,QAAQ,KAAK,kBAAnE,CADA,IAEA,KAAK,WAAL,CAAiB,OAAjB,CAAyB,IAAzB,IAAiC,CAFrC,EAGE,OAAO,KAAK,MAAL,CAAY,cAAnB;;AAEF,UAAI,QAAQ,MAAR,GAAiB,GAAjB,IAAyB,QAAQ,MAAR,GAAiB,CAAjB,IAAsB,CAAC,MAApD,EACE,OAAO,KAAK,MAAL,CAAY,cAAnB;;AAEF,WAAK,SAAL,CAAe,QAAQ,KAAK,kBAA5B,EAAgD,UAAU,EAA1D;AACD;;AAED,QAAI,WAAW,KAAK,OAAL,CAAa,IAA5B,EAAkC;AAChC,WAAK,KAAL,CAAW,OAAX,EAAoB,MAApB;AACD;;AAED,QAAI,WAAW,KAAK,OAAL,CAAa,IAA5B,EAAkC;AAChC,kBAAY,KAAK,cAAjB;AACA,gBAAY,KAAK,OAAL,CAAa,OAAb,CAAZ;AACA,iBAAY,UAAU,OAAV,CAAZ;;AAEA,aAAO,UAAU,OAAV,CAAP;AACA,UAAI,QAAJ,EAAc;AACf;AACF,GApXY;;AAsXb,gBAAc,UAAS,OAAT,EAAkB;AAC9B,QAAI,UAAU,KAAK,QAAnB;AACA,YAAQ,IAAR;;AAEA,WAAO,KAAK,QAAZ;;AAEA,SAAK,WAAL,CAAiB,sBAAjB,CAAwC,OAAxC,EAAiD,UAAS,KAAT,EAAgB,OAAhB,EAAyB;AACxE,UAAI,KAAJ,EAAW,OAAO,KAAK,KAAL,CAAW,iBAAX,EAA8B,MAAM,OAApC,CAAP;;AAEX,UAAI,UAAU,QAAQ,IAAtB;AACA,UAAI,QAAQ,MAAR,KAAmB,KAAK,OAAL,CAAa,IAApC,EAA0C,UAAU,KAAK,OAAL,CAAa,OAAb,CAAV;;AAE1C,UAAI,YAAY,IAAhB,EACE,OAAO,KAAK,KAAL,CAAW,gBAAX,EAA6B,wCAA7B,CAAP,CADF,KAGE,KAAK,IAAL,CAAU,SAAV,EAAqB,IAAI,KAAK,YAAT,CAAsB,OAAtB,CAArB;AACH,KAVD,EAUG,IAVH;AAWD,GAvYY;;AAyYb,WAAS,UAAS,MAAT,EAAiB;AACxB,QAAI;AACF,UAAI,SAAS,OAAO,QAAP,CAAgB,QAAhB,EAA0B,CAA1B,EAA6B,OAAO,MAApC,CAAb;AACA,UAAI,CAAC,KAAK,UAAL,CAAgB,IAAhB,CAAqB,MAArB,CAAL,EAAmC,OAAO,IAAP;AACpC,KAHD,CAGE,OAAO,CAAP,EAAU,CAAE;AACd,WAAO,OAAO,QAAP,CAAgB,MAAhB,EAAwB,CAAxB,EAA2B,OAAO,MAAlC,CAAP;AACD,GA/YY;;AAiZb,aAAW,UAAS,MAAT,EAAiB;AAC1B,QAAI,OAAO,MAAP,KAAkB,CAAtB,EAAyB,OAAO,OAAO,YAAP,CAAoB,CAApB,CAAP;;AAEzB,WAAO,OAAO,YAAP,CAAoB,CAApB,IAAyB,WAAzB,GACA,OAAO,YAAP,CAAoB,CAApB,CADP;AAED;AAtZY,CAAf;;AAyZA,KAAK,IAAI,GAAT,IAAgB,QAAhB,EACE,KAAK,SAAL,CAAe,GAAf,IAAsB,SAAS,GAAT,CAAtB;;AAEF,OAAO,OAAP,GAAiB,IAAjB","file":"hybi-compiled.js","sourcesContent":["'use strict';\n\nvar crypto     = require('crypto'),\n    util       = require('util'),\n    Extensions = require('websocket-extensions'),\n    Base       = require('./base'),\n    Frame      = require('./hybi/frame'),\n    Message    = require('./hybi/message');\n\nvar Hybi = function(request, url, options) {\n  Base.apply(this, arguments);\n\n  this._extensions     = new Extensions();\n  this._stage          = 0;\n  this._masking        = this._options.masking;\n  this._protocols      = this._options.protocols || [];\n  this._requireMasking = this._options.requireMasking;\n  this._pingCallbacks  = {};\n\n  if (typeof this._protocols === 'string')\n    this._protocols = this._protocols.split(/ *, */);\n\n  if (!this._request) return;\n\n  var secKey    = this._request.headers['sec-websocket-key'],\n      protos    = this._request.headers['sec-websocket-protocol'],\n      version   = this._request.headers['sec-websocket-version'],\n      supported = this._protocols;\n\n  this._headers.set('Upgrade', 'websocket');\n  this._headers.set('Connection', 'Upgrade');\n  this._headers.set('Sec-WebSocket-Accept', Hybi.generateAccept(secKey));\n\n  if (protos !== undefined) {\n    if (typeof protos === 'string') protos = protos.split(/ *, */);\n    this.protocol = protos.filter(function(p) { return supported.indexOf(p) >= 0 })[0];\n    if (this.protocol) this._headers.set('Sec-WebSocket-Protocol', this.protocol);\n  }\n\n  this.version = 'hybi-' + version;\n};\nutil.inherits(Hybi, Base);\n\nHybi.mask = function(payload, mask, offset) {\n  if (!mask || mask.length === 0) return payload;\n  offset = offset || 0;\n\n  for (var i = 0, n = payload.length - offset; i < n; i++) {\n    payload[offset + i] = payload[offset + i] ^ mask[i % 4];\n  }\n  return payload;\n};\n\nHybi.generateAccept = function(key) {\n  var sha1 = crypto.createHash('sha1');\n  sha1.update(key + Hybi.GUID);\n  return sha1.digest('base64');\n};\n\nHybi.GUID = '258EAFA5-E914-47DA-95CA-C5AB0DC85B11';\n\nvar instance = {\n  FIN:    0x80,\n  MASK:   0x80,\n  RSV1:   0x40,\n  RSV2:   0x20,\n  RSV3:   0x10,\n  OPCODE: 0x0F,\n  LENGTH: 0x7F,\n\n  OPCODES: {\n    continuation: 0,\n    text:         1,\n    binary:       2,\n    close:        8,\n    ping:         9,\n    pong:         10\n  },\n\n  OPCODE_CODES:    [0, 1, 2, 8, 9, 10],\n  MESSAGE_OPCODES: [0, 1, 2],\n  OPENING_OPCODES: [1, 2],\n\n  ERRORS: {\n    normal_closure:       1000,\n    going_away:           1001,\n    protocol_error:       1002,\n    unacceptable:         1003,\n    encoding_error:       1007,\n    policy_violation:     1008,\n    too_large:            1009,\n    extension_error:      1010,\n    unexpected_condition: 1011\n  },\n\n  ERROR_CODES:        [1000, 1001, 1002, 1003, 1007, 1008, 1009, 1010, 1011],\n  DEFAULT_ERROR_CODE: 1000,\n  MIN_RESERVED_ERROR: 3000,\n  MAX_RESERVED_ERROR: 4999,\n\n  // http://www.w3.org/International/questions/qa-forms-utf-8.en.php\n  UTF8_MATCH: /^([\\x00-\\x7F]|[\\xC2-\\xDF][\\x80-\\xBF]|\\xE0[\\xA0-\\xBF][\\x80-\\xBF]|[\\xE1-\\xEC\\xEE\\xEF][\\x80-\\xBF]{2}|\\xED[\\x80-\\x9F][\\x80-\\xBF]|\\xF0[\\x90-\\xBF][\\x80-\\xBF]{2}|[\\xF1-\\xF3][\\x80-\\xBF]{3}|\\xF4[\\x80-\\x8F][\\x80-\\xBF]{2})*$/,\n\n  addExtension: function(extension) {\n    this._extensions.add(extension);\n    return true;\n  },\n\n  parse: function(chunk) {\n    this._reader.put(chunk);\n    var buffer = true;\n    while (buffer) {\n      switch (this._stage) {\n        case 0:\n          buffer = this._reader.read(1);\n          if (buffer) this._parseOpcode(buffer[0]);\n          break;\n\n        case 1:\n          buffer = this._reader.read(1);\n          if (buffer) this._parseLength(buffer[0]);\n          break;\n\n        case 2:\n          buffer = this._reader.read(this._frame.lengthBytes);\n          if (buffer) this._parseExtendedLength(buffer);\n          break;\n\n        case 3:\n          buffer = this._reader.read(4);\n          if (buffer) {\n            this._stage = 4;\n            this._frame.maskingKey = buffer;\n          }\n          break;\n\n        case 4:\n          buffer = this._reader.read(this._frame.length);\n          if (buffer) {\n            this._stage = 0;\n            this._emitFrame(buffer);\n          }\n          break;\n\n        default:\n          buffer = null;\n      }\n    }\n  },\n\n  text: function(message) {\n    if (this.readyState > 1) return false;\n    return this.frame(message, 'text');\n  },\n\n  binary: function(message) {\n    if (this.readyState > 1) return false;\n    return this.frame(message, 'binary');\n  },\n\n  ping: function(message, callback) {\n    if (this.readyState > 1) return false;\n    message = message || '';\n    if (callback) this._pingCallbacks[message] = callback;\n    return this.frame(message, 'ping');\n  },\n\n  pong: function(message) {\n      if (this.readyState > 1) return false;\n      message = message ||'';\n      return this.frame(message, 'pong');\n  },\n\n  close: function(reason, code) {\n    reason = reason || '';\n    code   = code   || this.ERRORS.normal_closure;\n\n    if (this.readyState <= 0) {\n      this.readyState = 3;\n      this.emit('close', new Base.CloseEvent(code, reason));\n      return true;\n    } else if (this.readyState === 1) {\n      this.readyState = 2;\n      this._extensions.close(function() { this.frame(reason, 'close', code) }, this);\n      return true;\n    } else {\n      return false;\n    }\n  },\n\n  frame: function(buffer, type, code) {\n    if (this.readyState <= 0) return this._queue([buffer, type, code]);\n    if (this.readyState > 2) return false;\n\n    if (buffer instanceof Array)    buffer = new Buffer(buffer);\n    if (typeof buffer === 'number') buffer = buffer.toString();\n\n    var message = new Message(),\n        isText  = (typeof buffer === 'string'),\n        payload, copy;\n\n    message.rsv1   = message.rsv2 = message.rsv3 = false;\n    message.opcode = this.OPCODES[type || (isText ? 'text' : 'binary')];\n\n    payload = isText ? new Buffer(buffer, 'utf8') : buffer;\n\n    if (code) {\n      copy = payload;\n      payload = new Buffer(2 + copy.length);\n      payload.writeUInt16BE(code, 0);\n      copy.copy(payload, 2);\n    }\n    message.data = payload;\n\n    var onMessageReady = function(message) {\n      var frame = new Frame();\n\n      frame.final   = true;\n      frame.rsv1    = message.rsv1;\n      frame.rsv2    = message.rsv2;\n      frame.rsv3    = message.rsv3;\n      frame.opcode  = message.opcode;\n      frame.masked  = !!this._masking;\n      frame.length  = message.data.length;\n      frame.payload = message.data;\n\n      if (frame.masked) frame.maskingKey = crypto.randomBytes(4);\n\n      this._sendFrame(frame);\n    };\n\n    if (this.MESSAGE_OPCODES.indexOf(message.opcode) >= 0)\n      this._extensions.processOutgoingMessage(message, function(error, message) {\n        if (error) return this._fail('extension_error', error.message);\n        onMessageReady.call(this, message);\n      }, this);\n    else\n      onMessageReady.call(this, message);\n\n    return true;\n  },\n\n  _sendFrame: function(frame) {\n    var length = frame.length,\n        header = (length <= 125) ? 2 : (length <= 65535 ? 4 : 10),\n        offset = header + (frame.masked ? 4 : 0),\n        buffer = new Buffer(offset + length),\n        masked = frame.masked ? this.MASK : 0;\n\n    buffer[0] = (frame.final ? this.FIN : 0) |\n                (frame.rsv1 ? this.RSV1 : 0) |\n                (frame.rsv2 ? this.RSV2 : 0) |\n                (frame.rsv3 ? this.RSV3 : 0) |\n                frame.opcode;\n\n    if (length <= 125) {\n      buffer[1] = masked | length;\n    } else if (length <= 65535) {\n      buffer[1] = masked | 126;\n      buffer.writeUInt16BE(length, 2);\n    } else {\n      buffer[1] = masked | 127;\n      buffer.writeUInt32BE(Math.floor(length / 0x100000000), 2);\n      buffer.writeUInt32BE(length % 0x100000000, 6);\n    }\n\n    frame.payload.copy(buffer, offset);\n\n    if (frame.masked) {\n      frame.maskingKey.copy(buffer, header);\n      Hybi.mask(buffer, frame.maskingKey, offset);\n    }\n\n    this._write(buffer);\n  },\n\n  _handshakeResponse: function() {\n    try {\n      var extensions = this._extensions.generateResponse(this._request.headers['sec-websocket-extensions']);\n    } catch (e) {\n      return this._fail('protocol_error', e.message);\n    }\n\n    if (extensions) this._headers.set('Sec-WebSocket-Extensions', extensions);\n\n    var start   = 'HTTP/1.1 101 Switching Protocols',\n        headers = [start, this._headers.toString(), ''];\n\n    return new Buffer(headers.join('\\r\\n'), 'utf8');\n  },\n\n  _shutdown: function(code, reason, error) {\n    delete this._frame;\n    delete this._message;\n    this._stage = 5;\n\n    var sendCloseFrame = (this.readyState === 1);\n    this.readyState = 2;\n\n    this._extensions.close(function() {\n      if (sendCloseFrame) this.frame(reason, 'close', code);\n      this.readyState = 3;\n      if (error) this.emit('error', new Error(reason));\n      this.emit('close', new Base.CloseEvent(code, reason));\n    }, this);\n  },\n\n  _fail: function(type, message) {\n    if (this.readyState > 1) return;\n    this._shutdown(this.ERRORS[type], message, true);\n  },\n\n  _parseOpcode: function(octet) {\n    var rsvs = [this.RSV1, this.RSV2, this.RSV3].map(function(rsv) {\n      return (octet & rsv) === rsv;\n    });\n\n    var frame = this._frame = new Frame();\n\n    frame.final  = (octet & this.FIN) === this.FIN;\n    frame.rsv1   = rsvs[0];\n    frame.rsv2   = rsvs[1];\n    frame.rsv3   = rsvs[2];\n    frame.opcode = (octet & this.OPCODE);\n\n    this._stage = 1;\n\n    if (!this._extensions.validFrameRsv(frame))\n      return this._fail('protocol_error',\n          'One or more reserved bits are on: reserved1 = ' + (frame.rsv1 ? 1 : 0) +\n          ', reserved2 = ' + (frame.rsv2 ? 1 : 0) +\n          ', reserved3 = ' + (frame.rsv3 ? 1 : 0));\n\n    if (this.OPCODE_CODES.indexOf(frame.opcode) < 0)\n      return this._fail('protocol_error', 'Unrecognized frame opcode: ' + frame.opcode);\n\n    if (this.MESSAGE_OPCODES.indexOf(frame.opcode) < 0 && !frame.final)\n      return this._fail('protocol_error', 'Received fragmented control frame: opcode = ' + frame.opcode);\n\n    if (this._message && this.OPENING_OPCODES.indexOf(frame.opcode) >= 0)\n      return this._fail('protocol_error', 'Received new data frame but previous continuous frame is unfinished');\n  },\n\n  _parseLength: function(octet) {\n    var frame = this._frame;\n    frame.masked = (octet & this.MASK) === this.MASK;\n    frame.length = (octet & this.LENGTH);\n\n    if (frame.length >= 0 && frame.length <= 125) {\n      this._stage = frame.masked ? 3 : 4;\n      if (!this._checkFrameLength()) return;\n    } else {\n      this._stage = 2;\n      frame.lengthBytes = (frame.length === 126 ? 2 : 8);\n    }\n\n    if (this._requireMasking && !frame.masked)\n      return this._fail('unacceptable', 'Received unmasked frame but masking is required');\n  },\n\n  _parseExtendedLength: function(buffer) {\n    var frame = this._frame;\n    frame.length = this._readUInt(buffer);\n\n    this._stage = frame.masked ? 3 : 4;\n\n    if (this.MESSAGE_OPCODES.indexOf(frame.opcode) < 0 && frame.length > 125)\n      return this._fail('protocol_error', 'Received control frame having too long payload: ' + frame.length);\n\n    if (!this._checkFrameLength()) return;\n  },\n\n  _checkFrameLength: function() {\n    var length = this._message ? this._message.length : 0;\n\n    if (length + this._frame.length > this._maxLength) {\n      this._fail('too_large', 'WebSocket frame length too large');\n      return false;\n    } else {\n      return true;\n    }\n  },\n\n  _emitFrame: function(buffer) {\n    var frame   = this._frame,\n        payload = frame.payload = Hybi.mask(buffer, frame.maskingKey),\n        opcode  = frame.opcode,\n        message,\n        code, reason,\n        callbacks, callback;\n\n    delete this._frame;\n\n    if (opcode === this.OPCODES.continuation) {\n      if (!this._message) return this._fail('protocol_error', 'Received unexpected continuation frame');\n      this._message.pushFrame(frame);\n    }\n\n    if (opcode === this.OPCODES.text || opcode === this.OPCODES.binary) {\n      this._message = new Message();\n      this._message.pushFrame(frame);\n    }\n\n    if (frame.final && this.MESSAGE_OPCODES.indexOf(opcode) >= 0)\n      return this._emitMessage(this._message);\n\n    if (opcode === this.OPCODES.close) {\n      code   = (payload.length >= 2) ? payload.readUInt16BE(0) : null;\n      reason = (payload.length > 2) ? this._encode(payload.slice(2)) : null;\n\n      if (!(payload.length === 0) &&\n          !(code !== null && code >= this.MIN_RESERVED_ERROR && code <= this.MAX_RESERVED_ERROR) &&\n          this.ERROR_CODES.indexOf(code) < 0)\n        code = this.ERRORS.protocol_error;\n\n      if (payload.length > 125 || (payload.length > 2 && !reason))\n        code = this.ERRORS.protocol_error;\n\n      this._shutdown(code || this.DEFAULT_ERROR_CODE, reason || '');\n    }\n\n    if (opcode === this.OPCODES.ping) {\n      this.frame(payload, 'pong');\n    }\n\n    if (opcode === this.OPCODES.pong) {\n      callbacks = this._pingCallbacks;\n      message   = this._encode(payload);\n      callback  = callbacks[message];\n\n      delete callbacks[message];\n      if (callback) callback()\n    }\n  },\n\n  _emitMessage: function(message) {\n    var message = this._message;\n    message.read();\n\n    delete this._message;\n\n    this._extensions.processIncomingMessage(message, function(error, message) {\n      if (error) return this._fail('extension_error', error.message);\n\n      var payload = message.data;\n      if (message.opcode === this.OPCODES.text) payload = this._encode(payload);\n\n      if (payload === null)\n        return this._fail('encoding_error', 'Could not decode a text frame as UTF-8');\n      else\n        this.emit('message', new Base.MessageEvent(payload));\n    }, this);\n  },\n\n  _encode: function(buffer) {\n    try {\n      var string = buffer.toString('binary', 0, buffer.length);\n      if (!this.UTF8_MATCH.test(string)) return null;\n    } catch (e) {}\n    return buffer.toString('utf8', 0, buffer.length);\n  },\n\n  _readUInt: function(buffer) {\n    if (buffer.length === 2) return buffer.readUInt16BE(0);\n\n    return buffer.readUInt32BE(0) * 0x100000000 +\n           buffer.readUInt32BE(4);\n  }\n};\n\nfor (var key in instance)\n  Hybi.prototype[key] = instance[key];\n\nmodule.exports = Hybi;\n"]}