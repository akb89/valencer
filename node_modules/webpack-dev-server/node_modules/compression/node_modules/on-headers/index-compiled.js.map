{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;AAMA;;;;;;AAMA,IAAI,QAAQ,MAAM,SAAN,CAAgB,KAA5B;;;;;;;;;;AAUA,OAAO,OAAP,GAAiB,SAAS,SAAT,CAAmB,GAAnB,EAAwB,QAAxB,EAAkC;AACjD,MAAI,CAAC,GAAL,EAAU;AACR,UAAM,IAAI,SAAJ,CAAc,0BAAd,CAAN;AACD;;AAED,MAAI,OAAO,QAAP,KAAoB,UAAxB,EAAoC;AAClC,UAAM,IAAI,SAAJ,CAAc,sCAAd,CAAN;AACD;;AAED,MAAI,SAAJ,GAAgB,gBAAgB,IAAI,SAApB,EAA+B,QAA/B,CAAhB;AACD,CAVD;;AAYA,SAAS,eAAT,CAAyB,aAAzB,EAAwC,QAAxC,EAAkD;AAChD,MAAI,QAAQ,KAAZ;;;AAGA,SAAO,SAAS,SAAT,CAAmB,UAAnB,EAA+B;;AAEpC,QAAI,OAAO,oBAAoB,KAApB,CAA0B,IAA1B,EAAgC,SAAhC,CAAX;;;AAGA,QAAI,CAAC,KAAL,EAAY;AACV,cAAQ,IAAR;AACA,eAAS,IAAT,CAAc,IAAd;;;AAGA,UAAI,OAAO,KAAK,CAAL,CAAP,KAAmB,QAAnB,IAA+B,KAAK,UAAL,KAAoB,KAAK,CAAL,CAAvD,EAAgE;AAC9D,aAAK,CAAL,IAAU,KAAK,UAAf;AACA,aAAK,MAAL,GAAc,CAAd;AACD;AACF;;AAED,kBAAc,KAAd,CAAoB,IAApB,EAA0B,IAA1B;AACD,GAjBD;AAkBD;;AAED,SAAS,mBAAT,CAA6B,UAA7B,EAAyC;AACvC,MAAI,SAAS,UAAU,MAAvB;AACA,MAAI,cAAc,SAAS,CAAT,IAAc,OAAO,UAAU,CAAV,CAAP,KAAwB,QAAtC,GACd,CADc,GAEd,CAFJ;;AAIA,MAAI,UAAU,UAAU,cAAc,CAAxB,GACV,UAAU,WAAV,CADU,GAEV,SAFJ;;AAIA,OAAK,UAAL,GAAkB,UAAlB;;;AAGA,MAAI,MAAM,OAAN,CAAc,OAAd,CAAJ,EAA4B;;AAE1B,SAAK,IAAI,IAAI,CAAR,EAAW,MAAM,QAAQ,MAA9B,EAAsC,IAAI,GAA1C,EAA+C,EAAE,CAAjD,EAAoD;AAClD,WAAK,SAAL,CAAe,QAAQ,CAAR,EAAW,CAAX,CAAf,EAA8B,QAAQ,CAAR,EAAW,CAAX,CAA9B;AACD;AACF,GALD,MAKO,IAAI,OAAJ,EAAa;;AAElB,QAAI,OAAO,OAAO,IAAP,CAAY,OAAZ,CAAX;AACA,SAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,KAAK,MAAzB,EAAiC,GAAjC,EAAsC;AACpC,UAAI,IAAI,KAAK,CAAL,CAAR;AACA,UAAI,CAAJ,EAAO,KAAK,SAAL,CAAe,CAAf,EAAkB,QAAQ,CAAR,CAAlB;AACR;AACF;;;AAGD,MAAI,OAAO,IAAI,KAAJ,CAAU,KAAK,GAAL,CAAS,MAAT,EAAiB,WAAjB,CAAV,CAAX;AACA,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,KAAK,MAAzB,EAAiC,GAAjC,EAAsC;AACpC,SAAK,CAAL,IAAU,UAAU,CAAV,CAAV;AACD;;AAED,SAAO,IAAP;AACD","file":"index-compiled.js","sourcesContent":["/*!\n * on-headers\n * Copyright(c) 2014 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Reference to Array slice.\n */\n\nvar slice = Array.prototype.slice\n\n/**\n * Execute a listener when a response is about to write headers.\n *\n * @param {Object} res\n * @return {Function} listener\n * @api public\n */\n\nmodule.exports = function onHeaders(res, listener) {\n  if (!res) {\n    throw new TypeError('argument res is required')\n  }\n\n  if (typeof listener !== 'function') {\n    throw new TypeError('argument listener must be a function')\n  }\n\n  res.writeHead = createWriteHead(res.writeHead, listener)\n}\n\nfunction createWriteHead(prevWriteHead, listener) {\n  var fired = false;\n\n  // return function with core name and argument list\n  return function writeHead(statusCode) {\n    // set headers from arguments\n    var args = setWriteHeadHeaders.apply(this, arguments);\n\n    // fire listener\n    if (!fired) {\n      fired = true\n      listener.call(this)\n\n      // pass-along an updated status code\n      if (typeof args[0] === 'number' && this.statusCode !== args[0]) {\n        args[0] = this.statusCode\n        args.length = 1\n      }\n    }\n\n    prevWriteHead.apply(this, args);\n  }\n}\n\nfunction setWriteHeadHeaders(statusCode) {\n  var length = arguments.length\n  var headerIndex = length > 1 && typeof arguments[1] === 'string'\n    ? 2\n    : 1\n\n  var headers = length >= headerIndex + 1\n    ? arguments[headerIndex]\n    : undefined\n\n  this.statusCode = statusCode\n\n  // the following block is from node.js core\n  if (Array.isArray(headers)) {\n    // handle array case\n    for (var i = 0, len = headers.length; i < len; ++i) {\n      this.setHeader(headers[i][0], headers[i][1])\n    }\n  } else if (headers) {\n    // handle object case\n    var keys = Object.keys(headers)\n    for (var i = 0; i < keys.length; i++) {\n      var k = keys[i]\n      if (k) this.setHeader(k, headers[k])\n    }\n  }\n\n  // copy leading arguments\n  var args = new Array(Math.min(length, headerIndex))\n  for (var i = 0; i < args.length; i++) {\n    args[i] = arguments[i]\n  }\n\n  return args\n}\n"]}