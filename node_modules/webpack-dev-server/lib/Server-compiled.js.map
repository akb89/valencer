{"version":3,"sources":["Server.js"],"names":[],"mappings":"AAAA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,uBAAuB,QAAQ,wBAAR,CAA3B;AACA,IAAI,UAAU,QAAQ,SAAR,CAAd;AACA,IAAI,WAAW,QAAQ,aAAR,CAAf;AACA,IAAI,SAAS,QAAQ,QAAR,CAAb;AACA,IAAI,cAAc,QAAQ,cAAR,CAAlB;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,QAAQ,QAAQ,OAAR,CAAZ;AACA,IAAI,YAAY,QAAQ,YAAR,CAAhB;AACA,IAAI,QAAQ,IAAI,UAAU,iBAAd,CAAgC,EAAC,QAAQ,KAAT,EAAhC,CAAZ;AACA,IAAI,aAAa,QAAQ,aAAR,CAAjB;AACA,IAAI,qBAAqB,QAAQ,8BAAR,CAAzB;;AAEA,SAAS,MAAT,CAAgB,QAAhB,EAA0B,OAA1B,EAAmC;;AAElC,KAAG,CAAC,OAAJ,EAAa,UAAU,EAAV;;AAEb,KAAI,QAAQ,IAAR,IAAgB,CAAC,QAAQ,QAA7B,EAAuC;AACtC,QAAM,IAAI,KAAJ,CAAU,6CAAV,CAAN;AACA;;AAED,MAAK,GAAL,GAAW,QAAQ,GAAnB;AACA,MAAK,OAAL,GAAe,QAAQ,OAAvB;AACA,MAAK,OAAL,GAAe,EAAf;;;AAGA,KAAI,gBAAgB,YAAW;AAC9B,OAAK,SAAL,CAAe,KAAK,OAApB,EAA6B,SAA7B;AACA,EAFmB,CAElB,IAFkB,CAEb,IAFa,CAApB;AAGA,UAAS,MAAT,CAAgB,SAAhB,EAA2B,aAA3B;AACA,UAAS,MAAT,CAAgB,SAAhB,EAA2B,aAA3B;AACA,UAAS,MAAT,CAAgB,MAAhB,EAAwB,UAAS,KAAT,EAAgB;AACvC,OAAK,UAAL,CAAgB,KAAK,OAArB,EAA8B,MAAM,MAAN,EAA9B;AACA,OAAK,MAAL,GAAc,KAAd;AACA,EAHuB,CAGtB,IAHsB,CAGjB,IAHiB,CAAxB;;;AAMA,KAAI,WAAW,KAAK,QAAL,GAAgB,IAAI,WAAJ,EAA/B;AACA,IAAG,gBAAH,CAAoB,KAAK,IAAL,CAAU,SAAV,EAAqB,IAArB,EAA2B,QAA3B,EAAqC,WAArC,CAApB,EAAuE,IAAvE,CAA4E,QAA5E;;;AAGA,KAAI,SAAS,IAAI,WAAJ,EAAb;AACA,IAAG,gBAAH,CAAoB,KAAK,IAAL,CAAU,SAAV,EAAqB,IAArB,EAA2B,QAA3B,EAAqC,gBAArC,CAApB,EAA4E,IAA5E,CAAiF,MAAjF;;;AAGA,KAAI,YAAY,IAAI,WAAJ,EAAhB;AACA,IAAG,gBAAH,CAAoB,KAAK,IAAL,CAAU,SAAV,EAAqB,IAArB,EAA2B,QAA3B,EAAqC,iBAArC,CAApB,EAA6E,IAA7E,CAAkF,SAAlF;;;AAGA,KAAI,MAAM,KAAK,GAAL,GAAW,IAAI,OAAJ,EAArB;;;AAGA,MAAK,UAAL,GAAkB,qBAAqB,QAArB,EAA+B,OAA/B,CAAlB;;AAEA,KAAI,GAAJ,CAAQ,wCAAR,EAAkD,UAAS,GAAT,EAAc,GAAd,EAAmB;AACpE,MAAI,SAAJ,CAAc,cAAd,EAA8B,wBAA9B;AACA,SAAO,IAAP,CAAY,GAAZ;AACA,EAHD;;AAKA,KAAI,GAAJ,CAAQ,wBAAR,EAAkC,UAAS,GAAT,EAAc,GAAd,EAAmB;AACpD,MAAI,SAAJ,CAAc,cAAd,EAA8B,wBAA9B;AACA,YAAU,IAAV,CAAe,GAAf;AACA,EAHD;;AAKA,KAAI,GAAJ,CAAQ,uBAAR,EAAiC,UAAS,GAAT,EAAc,GAAd,EAAmB;AACnD,MAAI,SAAJ,CAAc,cAAd,EAA8B,WAA9B;AACA,OAAK,QAAL,CAAc,IAAd,CAAmB,GAAnB;AACA,EAHgC,CAG/B,IAH+B,CAG1B,IAH0B,CAAjC;;AAKA,KAAI,GAAJ,CAAQ,qBAAR,EAA+B,UAAS,GAAT,EAAc,GAAd,EAAmB;AACjD,MAAI,SAAJ,CAAc,cAAd,EAA8B,WAA9B;AACA,MAAI,KAAJ,CAAU,iEAAV;AACA,MAAI,OAAO,KAAK,UAAL,CAAgB,kBAAhB,CAAmC,QAAQ,UAAR,IAAsB,GAAzD,CAAX;AACA,MAAI,KAAK,KAAK,UAAL,CAAgB,UAAzB;AACA,WAAS,cAAT,CAAwB,OAAxB,EAAiC,QAAjC,EAA2C;AAC1C,OAAI,UAAU,GAAG,WAAH,CAAe,QAAf,CAAd;AACA,OAAI,KAAJ,CAAU,MAAV;AACA,WAAQ,OAAR,CAAgB,UAAS,IAAT,EAAe;AAC9B,QAAI,IAAI,WAAW,GAAX,GAAiB,IAAzB;AACA,QAAG,GAAG,QAAH,CAAY,CAAZ,EAAe,MAAf,EAAH,EAA4B;AAC3B,SAAI,KAAJ,CAAU,eAAV;AACA,SAAI,KAAJ,CAAU,UAAU,IAApB;AACA,SAAI,KAAJ,CAAU,IAAV;AACA,SAAI,KAAJ,CAAU,IAAV;AACA,SAAI,KAAJ,CAAU,WAAV;AACA,SAAG,QAAQ,IAAR,CAAa,IAAb,CAAH,EAAuB;AACtB,UAAI,WAAW,KAAK,MAAL,CAAY,CAAZ,EAAe,KAAK,MAAL,GAAc,CAA7B,CAAf;AACA,UAAI,KAAJ,CAAU,eAAV;AACA,UAAI,KAAJ,CAAU,UAAU,QAApB;AACA,UAAI,KAAJ,CAAU,IAAV;AACA,UAAI,KAAJ,CAAU,QAAV;AACA,UAAI,KAAJ,CAAU,uBAAV;AACA,UAAI,KAAJ,CAAU,IAAV;AACA,UAAI,KAAJ,CAAU,cAAV;AACA,UAAI,KAAJ,CAAU,QAAQ,OAAR,CAAgB,2BAAhB,EAA6C,uBAA7C,IAAwE,QAAlF;AACA,UAAI,KAAJ,CAAU,gCAAV;AACA;AACD,KAlBD,MAkBO;AACN,SAAI,KAAJ,CAAU,MAAV;AACA,SAAI,KAAJ,CAAU,IAAV;AACA,SAAI,KAAJ,CAAU,MAAV;AACA,oBAAe,UAAU,IAAV,GAAiB,GAAhC,EAAqC,CAArC;AACA,SAAI,KAAJ,CAAU,OAAV;AACA;AACD,IA3BD;AA4BA,OAAI,KAAJ,CAAU,OAAV;AACA;AACD,iBAAe,QAAQ,UAAR,IAAsB,GAArC,EAA0C,IAA1C;AACA,MAAI,GAAJ,CAAQ,gBAAR;AACA,EAxC8B,CAwC7B,IAxC6B,CAwCxB,IAxCwB,CAA/B;;AA0CA,KAAI,WAAW;AACd,YAAU,YAAW;AACpB,OAAI,QAAQ,QAAZ,EAAsB;;AAErB,QAAI,GAAJ,CAAQ,UAAR;AACA;AACD,GALS,CAKR,IALQ,CAKH,IALG,CADI;;AAQd,SAAO,YAAW;AACjB,OAAI,QAAQ,KAAZ,EAAmB;AAClB,QAAI,CAAC,MAAM,OAAN,CAAc,QAAQ,KAAtB,CAAL,EAAmC;AAClC,aAAQ,KAAR,GAAgB,OAAO,IAAP,CAAY,QAAQ,KAApB,EAA2B,GAA3B,CAA+B,UAAU,IAAV,EAAgB;AAC9D,UAAI,YAAJ;AACA,UAAI,OAAO,QAAQ,KAAR,CAAc,IAAd,CAAP,KAA+B,QAAnC,EAA6C;AAC5C,sBAAe,EAAC,MAAM,IAAP,EAAa,QAAQ,QAAQ,KAAR,CAAc,IAAd,CAArB,EAAf;AACA,OAFD,MAEO;AACN,sBAAe,QAAQ,KAAR,CAAc,IAAd,CAAf;AACA,oBAAa,IAAb,GAAoB,IAApB;AACA;AACD,aAAO,YAAP;AACA,MATe,CAAhB;AAUA;AACD,YAAQ,KAAR,CAAc,OAAd,CAAsB,UAAU,YAAV,EAAwB;AAC7C,kBAAa,EAAb,GAAkB,aAAa,cAAb,CAA4B,IAA5B,IAAoC,aAAa,EAAjD,GAAsD,IAAxE;AACA,SAAI,GAAJ,CAAQ,aAAa,IAArB,EAA2B,UAAU,GAAV,EAAe,GAAf,EAAoB,IAApB,EAA0B;AACpD,UAAI,YAAY,OAAO,aAAa,MAApB,KAA+B,UAA/B,GAA4C,aAAa,MAAb,CAAoB,GAApB,EAAyB,GAAzB,EAA8B,YAA9B,CAA5C,GAA0F,KAA1G;AACA,UAAI,SAAJ,EAAe;AACd,WAAI,GAAJ,GAAU,SAAV;AACA;AACA,OAHD,MAGO;AACN,WAAG,OAAO,aAAa,OAApB,KAAgC,UAAnC,EAA+C,aAAa,OAAb,CAAqB,GAArB,EAA0B,YAA1B;AAC/C,WAAI,aAAa,IAAjB,EAAuB;AACtB,YAAI,OAAJ,CAAY,IAAZ,GAAmB,aAAa,IAAhC;AACA;AACD,aAAM,GAAN,CAAU,GAAV,EAAe,GAAf,EAAoB,YAApB,EAAkC,UAAS,GAAT,EAAa;AAC9C,YAAI,MAAM,qBAAqB,aAAa,MAAlC,GAA2C,IAA3C,GAAkD,IAAI,OAAtD,GAAgE,GAA1E;AACA,aAAK,SAAL,CAAe,KAAK,OAApB,EAA6B,aAA7B,EAA4C,CAAC,GAAD,CAA5C;AACA,YAAI,UAAJ,GAAiB,GAAjB;AACA,YAAI,GAAJ;AACA,QALiC,CAKhC,IALgC,CAK3B,IAL2B,CAAlC;AAMA,WAAI,aAAa,SAAjB,EAA4B;AAC3B,qBAAa,SAAb,CAAuB,KAAvB;AACA;AACD;AACD,MApB0B,CAoBzB,IApByB,CAoBpB,IApBoB,CAA3B;AAqBA,KAvBqB,CAuBpB,IAvBoB,CAuBf,IAvBe,CAAtB;AAwBA;AACD,GAvCM,CAuCL,IAvCK,CAuCA,IAvCA,CARO;;AAiDd,sBAAoB,YAAW;AAC9B,OAAI,QAAQ,kBAAZ,EAAgC;;AAE/B,QAAI,GAAJ,CAAQ,mBAAmB,OAAO,QAAQ,kBAAf,KAAsC,QAAtC,GAAiD,QAAQ,kBAAzD,GAA8E,IAAjG,CAAR;AACA;AACD,GALmB,CAKlB,IALkB,CAKb,IALa,CAjDN;;AAwDd,eAAa,YAAW;AACvB,OAAG,QAAQ,WAAR,KAAwB,KAA3B,EAAkC;AACjC,QAAI,cAAc,QAAQ,WAAR,IAAuB,QAAQ,GAAR,EAAzC;;AAEA,QAAG,OAAO,WAAP,KAAuB,QAA1B,EAAoC;AACnC,aAAQ,GAAR,CAAY,gNAAZ;AACA,aAAQ,GAAR,CAAY,8DAAZ;;AAEA,SAAI,GAAJ,CAAQ,GAAR,EAAa,UAAS,GAAT,EAAc,GAAd,EAAmB;AAC/B,YAAM,GAAN,CAAU,GAAV,EAAe,GAAf,EAAoB,WAApB,EAAiC,UAAS,GAAT,EAAc;AAC9C,WAAI,MAAM,qBAAqB,YAAY,MAAjC,GAA0C,IAA1C,GAAiD,IAAI,OAArD,GAA+D,GAAzE;AACA,YAAK,SAAL,CAAe,KAAK,OAApB,EAA6B,aAA7B,EAA4C,CAAC,GAAD,CAA5C;AACA,WAAI,UAAJ,GAAiB,GAAjB;AACA,WAAI,GAAJ;AACA,OALgC,CAK/B,IAL+B,CAK1B,IAL0B,CAAjC;AAMA,MAPY,CAOX,IAPW,CAON,IAPM,CAAb;AAQA,KAZD,MAYO,IAAG,kBAAkB,IAAlB,CAAuB,WAAvB,CAAH,EAAwC;;AAE9C,SAAI,GAAJ,CAAQ,GAAR,EAAa,UAAS,GAAT,EAAc,GAAd,EAAmB;AAC/B,UAAI,SAAJ,CAAc,GAAd,EAAmB;AAClB,mBAAY,cAAc,IAAI,IAAlB,IAA0B,IAAI,UAAJ,CAAe,MAAf,IAAyB,EAAnD;AADM,OAAnB;AAGA,UAAI,GAAJ;AACA,MALY,CAKX,IALW,CAKN,IALM,CAAb;AAMA,KARM,MAQA,IAAG,OAAO,WAAP,KAAuB,QAA1B,EAAoC;;AAE1C,SAAI,GAAJ,CAAQ,GAAR,EAAa,UAAS,GAAT,EAAc,GAAd,EAAmB;AAC/B,UAAI,SAAJ,CAAc,GAAd,EAAmB;AAClB,mBAAY,iBAAiB,WAAjB,GAA+B,IAAI,IAAnC,IAA2C,IAAI,UAAJ,CAAe,MAAf,IAAyB,EAApE;AADM,OAAnB;AAGA,UAAI,GAAJ;AACA,MALY,CAKX,IALW,CAKN,IALM,CAAb;AAMA,KARM,MAQA;;AAEN,SAAI,GAAJ,CAAQ,GAAR,EAAa,QAAQ,MAAR,CAAe,WAAf,CAAb,EAA0C,WAAW,WAAX,CAA1C;AACA;AACD;AACD,GArCY,CAqCX,IArCW,CAqCN,IArCM,CAxDC;;AA+Fd,cAAY,YAAW;;AAEtB,OAAI,GAAJ,CAAQ,KAAK,UAAb;AACA,GAHW,CAGV,IAHU,CAGL,IAHK,CA/FE;;AAoGd,WAAS,YAAW;AACnB,OAAI,GAAJ,CAAQ,GAAR,EAAa,KAAK,iBAAL,CAAuB,IAAvB,CAA4B,IAA5B,CAAb;AACA,GAFQ,CAEP,IAFO,CAEF,IAFE,CApGK;;AAwGd,aAAW,YAAW;AACrB,OAAI,GAAJ,CAAQ,GAAR,EAAa,KAAK,cAAL,CAAoB,IAApB,CAAyB,IAAzB,CAAb;AACA,GAFU,CAET,IAFS,CAEJ,IAFI,CAxGG;;AA4Gd,SAAO,YAAW;AACjB,OAAG,OAAO,QAAQ,KAAf,KAAyB,UAA5B,EACC,QAAQ,KAAR,CAAc,GAAd;AACD,GAHM,CAGL,IAHK,CAGA,IAHA;AA5GO,EAAf;;AAkHA,KAAI,kBAAkB,CAAC,OAAD,EAAU,SAAV,EAAqB,YAArB,CAAtB;AACA,KAAG,QAAQ,KAAX,EACC,gBAAgB,IAAhB,CAAqB,OAArB;AACD,KAAG,QAAQ,kBAAX,EACC,gBAAgB,IAAhB,CAAqB,oBAArB,EAA2C,YAA3C;AACD,iBAAgB,IAAhB,CAAqB,WAArB;AACA,KAAG,QAAQ,WAAR,KAAwB,KAA3B,EACC,gBAAgB,IAAhB,CAAqB,aAArB;;AAED,KAAG,QAAQ,QAAX,EACC,gBAAgB,OAAhB,CAAwB,UAAxB;;AAED,EAAC,QAAQ,QAAR,IAAoB,eAArB,EAAsC,OAAtC,CAA8C,UAAS,OAAT,EAAkB;AAC/D,WAAS,OAAT;AACA,EAFD,EAEG,IAFH;;AAIA,KAAI,QAAQ,KAAZ,EAAmB;;AAElB,MAAI,OAAO,QAAQ,KAAf,KAAyB,SAA7B,EAAwC;AACvC,WAAQ,KAAR,GAAgB;AACf,SAAK,QAAQ,GADE;AAEf,UAAM,QAAQ,IAFC;AAGf,QAAI,QAAQ;AAHG,IAAhB;AAKA;;;AAGD,UAAQ,KAAR,CAAc,GAAd,GAAoB,QAAQ,KAAR,CAAc,GAAd,IAAqB,GAAG,YAAH,CAAgB,KAAK,IAAL,CAAU,SAAV,EAAqB,mBAArB,CAAhB,CAAzC;AACA,UAAQ,KAAR,CAAc,IAAd,GAAqB,QAAQ,KAAR,CAAc,IAAd,IAAsB,GAAG,YAAH,CAAgB,KAAK,IAAL,CAAU,SAAV,EAAqB,mBAArB,CAAhB,CAA3C;AACA,UAAQ,KAAR,CAAc,EAAd,GAAmB,QAAQ,KAAR,CAAc,EAAd,IAAoB,GAAG,YAAH,CAAgB,KAAK,IAAL,CAAU,SAAV,EAAqB,eAArB,CAAhB,CAAvC;;AAEA,OAAK,YAAL,GAAoB,MAAM,YAAN,CAAmB,QAAQ,KAA3B,EAAkC,GAAlC,CAApB;AACA,EAhBD,MAgBO;AACN,OAAK,YAAL,GAAoB,KAAK,YAAL,CAAkB,GAAlB,CAApB;AACA;AACD;;AAED,OAAO,SAAP,CAAiB,GAAjB,GAAuB,YAAW;AACjC,MAAK,GAAL,CAAS,GAAT,CAAa,KAAb,CAAmB,KAAK,GAAxB,EAA6B,SAA7B;AACA,CAFD;;AAIA,OAAO,SAAP,CAAiB,iBAAjB,GAAqC,UAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB;AAC7D,KAAG,KAAK,OAAR,EAAiB;AAChB,OAAI,IAAI,IAAR,IAAgB,KAAK,OAArB,EAA8B;AAC7B,OAAI,SAAJ,CAAc,IAAd,EAAoB,KAAK,OAAL,CAAa,IAAb,CAApB;AACA;AACD;;AAED;AACA,CARD;;;AAWA,OAAO,SAAP,CAAiB,MAAjB,GAA0B,YAAW;AACpC,MAAK,YAAL,CAAkB,MAAlB,CAAyB,KAAzB,CAA+B,KAAK,YAApC,EAAkD,SAAlD;AACA,KAAI,aAAa,OAAO,YAAP,CAAoB;;AAEpC,OAAK,UAAS,QAAT,EAAmB,IAAnB,EAAyB;AAC7B,OAAI,aAAa,OAAjB,EAA0B;AACzB,YAAQ,GAAR,CAAY,IAAZ;AACA;AACD;AANmC,EAApB,CAAjB;AAQA,YAAW,EAAX,CAAc,YAAd,EAA4B,UAAS,IAAT,EAAe;AAC1C,OAAK,OAAL,CAAa,IAAb,CAAkB,IAAlB;;;AAGA,OAAK,EAAL,CAAQ,OAAR,EAAiB,YAAW;AAC3B,OAAI,YAAY,KAAK,OAAL,CAAa,OAAb,CAAqB,IAArB,CAAhB;AACA,OAAI,aAAa,CAAjB,EAAoB;AACnB,SAAK,OAAL,CAAa,MAAb,CAAoB,SAApB,EAA+B,CAA/B;AACA;AACD,GALgB,CAKf,IALe,CAKV,IALU,CAAjB;;AAOA,MAAG,KAAK,GAAR,EAAa,KAAK,SAAL,CAAe,CAAC,IAAD,CAAf,EAAuB,KAAvB;AACb,MAAG,CAAC,KAAK,MAAT,EAAiB;AACjB,OAAK,UAAL,CAAgB,CAAC,IAAD,CAAhB,EAAwB,KAAK,MAAL,CAAY,MAAZ,EAAxB,EAA8C,IAA9C;AACA,EAd2B,CAc1B,IAd0B,CAcrB,IAdqB,CAA5B;;AAgBA,YAAW,eAAX,CAA2B,KAAK,YAAhC,EAA8C;AAC7C,UAAQ;AADqC,EAA9C;AAGA,CA7BD;;AA+BA,OAAO,SAAP,CAAiB,KAAjB,GAAyB,YAAW;AACnC,MAAK,OAAL,CAAa,OAAb,CAAqB,UAAS,IAAT,EAAe;AACnC,OAAK,KAAL;AACA,EAFD;AAGA,MAAK,OAAL,GAAe,EAAf;AACA,MAAK,UAAL,CAAgB,KAAhB;AACA,CAND;;AAQA,OAAO,SAAP,CAAiB,SAAjB,GAA6B,UAAS,OAAT,EAAkB,IAAlB,EAAwB,IAAxB,EAA8B;AAC1D,SAAQ,OAAR,CAAgB,UAAS,IAAT,EAAe;AAC9B,OAAK,KAAL,CAAW,KAAK,SAAL,CAAe,EAAC,MAAM,IAAP,EAAa,MAAM,IAAnB,EAAf,CAAX;AACA,EAFD;AAGA,CAJD;;AAMA,OAAO,SAAP,CAAiB,cAAjB,GAAkC,UAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB;AAC1D,KAAI,QAAQ,IAAI,IAAhB;AACA,KAAI;AACH,MAAG,CAAC,KAAK,UAAL,CAAgB,UAAhB,CAA2B,QAA3B,CAAoC,KAAK,UAAL,CAAgB,kBAAhB,CAAmC,QAAQ,KAA3C,CAApC,EAAuF,MAAvF,EAAJ,EACC,OAAO,MAAP;;AAED,MAAI,KAAJ,CAAU,qHAAV;AACA,MAAI,KAAJ,CAAU,KAAV;AACA,MAAI,KAAJ,CAAU,KAAV;AACA,MAAI,KAAJ,CAAU,IAAI,UAAJ,CAAe,MAAf,IAAyB,EAAnC;AACA,MAAI,GAAJ,CAAQ,2BAAR;AACA,EATD,CASE,OAAM,CAAN,EAAS;AAAE,SAAO,MAAP;AAAgB;AAC7B,CAZD;;;AAeA,OAAO,SAAP,CAAiB,UAAjB,GAA8B,UAAS,OAAT,EAAkB,KAAlB,EAAyB,KAAzB,EAAgC;AAC7D,KAAG,CAAC,KAAD,IAAU,KAAV,KAAoB,CAAC,MAAM,MAAP,IAAiB,MAAM,MAAN,CAAa,MAAb,KAAwB,CAA7D,KAAmE,MAAM,MAAzE,IAAmF,MAAM,MAAN,CAAa,KAAb,CAAmB,UAAS,KAAT,EAAgB;AACxH,SAAO,CAAC,MAAM,OAAd;AACA,EAFqF,CAAtF,EAEI,OAAO,KAAK,SAAL,CAAe,OAAf,EAAwB,UAAxB,CAAP;AACJ,MAAK,SAAL,CAAe,OAAf,EAAwB,MAAxB,EAAgC,MAAM,IAAtC;AACA,KAAG,MAAM,MAAN,CAAa,MAAb,GAAsB,CAAzB,EACC,KAAK,SAAL,CAAe,OAAf,EAAwB,QAAxB,EAAkC,MAAM,MAAxC,EADD,KAEK,IAAG,MAAM,QAAN,CAAe,MAAf,GAAwB,CAA3B,EACJ,KAAK,SAAL,CAAe,OAAf,EAAwB,UAAxB,EAAoC,MAAM,QAA1C,EADI,KAGJ,KAAK,SAAL,CAAe,OAAf,EAAwB,IAAxB;AACD,CAXD;;AAaA,OAAO,SAAP,CAAiB,UAAjB,GAA8B,YAAW;AACxC,KAAG,KAAK,UAAR,EAAoB,KAAK,UAAL,CAAgB,UAAhB;AACpB,CAFD;;AAIA,OAAO,OAAP,GAAiB,MAAjB","file":"Server-compiled.js","sourcesContent":["var fs = require(\"fs\");\r\nvar path = require(\"path\");\r\nvar webpackDevMiddleware = require(\"webpack-dev-middleware\");\r\nvar express = require(\"express\");\r\nvar compress = require(\"compression\");\r\nvar sockjs = require(\"sockjs\");\r\nvar StreamCache = require(\"stream-cache\");\r\nvar http = require(\"http\");\r\nvar https = require(\"https\");\r\nvar httpProxy = require(\"http-proxy\");\r\nvar proxy = new httpProxy.createProxyServer({secure: false});\r\nvar serveIndex = require(\"serve-index\");\r\nvar historyApiFallback = require(\"connect-history-api-fallback\");\r\n\r\nfunction Server(compiler, options) {\r\n\t// Default options\r\n\tif(!options) options = {};\r\n\r\n\tif (options.lazy && !options.filename) {\r\n\t\tthrow new Error(\"'filename' option must be set in lazy mode.\");\r\n\t}\r\n\r\n\tthis.hot = options.hot;\r\n\tthis.headers = options.headers;\r\n\tthis.sockets = [];\r\n\r\n\t// Listening for events\r\n\tvar invalidPlugin = function() {\r\n\t\tthis.sockWrite(this.sockets, \"invalid\");\r\n\t}.bind(this);\r\n\tcompiler.plugin(\"compile\", invalidPlugin);\r\n\tcompiler.plugin(\"invalid\", invalidPlugin);\r\n\tcompiler.plugin(\"done\", function(stats) {\r\n\t\tthis._sendStats(this.sockets, stats.toJson());\r\n\t\tthis._stats = stats;\r\n\t}.bind(this));\r\n\r\n\t// Prepare live html page\r\n\tvar livePage = this.livePage = new StreamCache();\r\n\tfs.createReadStream(path.join(__dirname, \"..\", \"client\", \"live.html\")).pipe(livePage);\r\n\r\n\t// Prepare the live js file\r\n\tvar liveJs = new StreamCache();\r\n\tfs.createReadStream(path.join(__dirname, \"..\", \"client\", \"live.bundle.js\")).pipe(liveJs);\r\n\r\n\t// Prepare the inlined js file\r\n\tvar inlinedJs = new StreamCache();\r\n\tfs.createReadStream(path.join(__dirname, \"..\", \"client\", \"index.bundle.js\")).pipe(inlinedJs);\r\n\r\n\t// Init express server\r\n\tvar app = this.app = new express();\r\n\r\n\t// middleware for serving webpack bundle\r\n\tthis.middleware = webpackDevMiddleware(compiler, options);\r\n\r\n\tapp.get(\"/__webpack_dev_server__/live.bundle.js\", function(req, res) {\r\n\t\tres.setHeader(\"Content-Type\", \"application/javascript\");\r\n\t\tliveJs.pipe(res);\r\n\t});\r\n\r\n\tapp.get(\"/webpack-dev-server.js\", function(req, res) {\r\n\t\tres.setHeader(\"Content-Type\", \"application/javascript\");\r\n\t\tinlinedJs.pipe(res);\r\n\t});\r\n\r\n\tapp.get(\"/webpack-dev-server/*\", function(req, res) {\r\n\t\tres.setHeader(\"Content-Type\", \"text/html\");\r\n\t\tthis.livePage.pipe(res);\r\n\t}.bind(this));\r\n\r\n\tapp.get(\"/webpack-dev-server\", function(req, res) {\r\n\t\tres.setHeader(\"Content-Type\", \"text/html\");\r\n\t\tres.write('<!DOCTYPE html><html><head><meta charset=\"utf-8\"/></head><body>');\r\n\t\tvar path = this.middleware.getFilenameFromUrl(options.publicPath || \"/\");\r\n\t\tvar fs = this.middleware.fileSystem;\r\n\t\tfunction writeDirectory(baseUrl, basePath) {\r\n\t\t\tvar content = fs.readdirSync(basePath);\r\n\t\t\tres.write(\"<ul>\");\r\n\t\t\tcontent.forEach(function(item) {\r\n\t\t\t\tvar p = basePath + \"/\" + item;\r\n\t\t\t\tif(fs.statSync(p).isFile()) {\r\n\t\t\t\t\tres.write('<li><a href=\"');\r\n\t\t\t\t\tres.write(baseUrl + item);\r\n\t\t\t\t\tres.write('\">');\r\n\t\t\t\t\tres.write(item);\r\n\t\t\t\t\tres.write('</a></li>');\r\n\t\t\t\t\tif(/\\.js$/.test(item)) {\r\n\t\t\t\t\t\tvar htmlItem = item.substr(0, item.length - 3);\r\n\t\t\t\t\t\tres.write('<li><a href=\"');\r\n\t\t\t\t\t\tres.write(baseUrl + htmlItem);\r\n\t\t\t\t\t\tres.write('\">');\r\n\t\t\t\t\t\tres.write(htmlItem);\r\n\t\t\t\t\t\tres.write('</a> (magic html for ');\r\n\t\t\t\t\t\tres.write(item);\r\n\t\t\t\t\t\tres.write(') (<a href=\"');\r\n\t\t\t\t\t\tres.write(baseUrl.replace(/(^(https?:\\/\\/[^\\/]+)?\\/)/, \"$1webpack-dev-server/\") + htmlItem);\r\n\t\t\t\t\t\tres.write('\">webpack-dev-server</a>)</li>');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tres.write('<li>');\r\n\t\t\t\t\tres.write(item);\r\n\t\t\t\t\tres.write('<br>');\r\n\t\t\t\t\twriteDirectory(baseUrl + item + \"/\", p);\r\n\t\t\t\t\tres.write('</li>');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tres.write(\"</ul>\");\r\n\t\t}\r\n\t\twriteDirectory(options.publicPath || \"/\", path);\r\n\t\tres.end('</body></html>');\r\n\t}.bind(this));\r\n\r\n\tvar features = {\r\n\t\tcompress: function() {\r\n\t\t\tif (options.compress) {\r\n\t\t\t\t// Enable gzip compression.\r\n\t\t\t\tapp.use(compress());\r\n\t\t\t}\r\n\t\t}.bind(this),\r\n\r\n\t\tproxy: function() {\r\n\t\t\tif (options.proxy) {\r\n\t\t\t\tif (!Array.isArray(options.proxy)) {\r\n\t\t\t\t\toptions.proxy = Object.keys(options.proxy).map(function (path) {\r\n\t\t\t\t\t\tvar proxyOptions;\r\n\t\t\t\t\t\tif (typeof options.proxy[path] === 'string') {\r\n\t\t\t\t\t\t\tproxyOptions = {path: path, target: options.proxy[path]};\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tproxyOptions = options.proxy[path];\r\n\t\t\t\t\t\t\tproxyOptions.path = path;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn proxyOptions;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\toptions.proxy.forEach(function (proxyOptions) {\r\n\t\t\t\t\tproxyOptions.ws = proxyOptions.hasOwnProperty('ws') ? proxyOptions.ws : true;\r\n\t\t\t\t\tapp.all(proxyOptions.path, function (req, res, next) {\r\n\t\t\t\t\t\tvar bypassUrl = typeof proxyOptions.bypass === 'function' ? proxyOptions.bypass(req, res, proxyOptions) : false;\r\n\t\t\t\t\t\tif (bypassUrl) {\r\n\t\t\t\t\t\t\treq.url = bypassUrl;\r\n\t\t\t\t\t\t\tnext();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif(typeof proxyOptions.rewrite === 'function') proxyOptions.rewrite(req, proxyOptions);\r\n\t\t\t\t\t\t\tif (proxyOptions.host) {\r\n\t\t\t\t\t\t\t\treq.headers.host = proxyOptions.host;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tproxy.web(req, res, proxyOptions, function(err){\r\n\t\t\t\t\t\t\t\tvar msg = \"cannot proxy to \" + proxyOptions.target + \" (\" + err.message + \")\";\r\n\t\t\t\t\t\t\t\tthis.sockWrite(this.sockets, \"proxy-error\", [msg]);\r\n\t\t\t\t\t\t\t\tres.statusCode = 502;\r\n\t\t\t\t\t\t\t\tres.end();\r\n\t\t\t\t\t\t\t}.bind(this));\r\n\t\t\t\t\t\t\tif (proxyOptions.configure) {\r\n\t\t\t\t\t\t\t\tproxyOptions.configure(proxy);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t}.bind(this));\r\n\t\t\t}\r\n\t\t}.bind(this),\r\n\r\n\t\thistoryApiFallback: function() {\r\n\t\t\tif (options.historyApiFallback) {\r\n\t\t\t\t// Fall back to /index.html if nothing else matches.\r\n\t\t\t\tapp.use(historyApiFallback(typeof options.historyApiFallback === 'object' ? options.historyApiFallback : null));\r\n\t\t\t}\r\n\t\t}.bind(this),\r\n\r\n\t\tcontentBase: function() {\r\n\t\t\tif(options.contentBase !== false) {\r\n\t\t\t\tvar contentBase = options.contentBase || process.cwd();\r\n\r\n\t\t\t\tif(typeof contentBase === \"object\") {\r\n\t\t\t\t\tconsole.log('Using contentBase as a proxy is deprecated and will be removed in the next major version. Please use the proxy option instead.\\n\\nTo update remove the contentBase option from webpack.config.js and add this:');\r\n\t\t\t\t\tconsole.log('proxy: {\\n\\t\"*\": <your current contentBase configuration>\\n}');\r\n\t\t\t\t\t// Proxy every request to contentBase.target\r\n\t\t\t\t\tapp.all(\"*\", function(req, res) {\r\n\t\t\t\t\t\tproxy.web(req, res, contentBase, function(err) {\r\n\t\t\t\t\t\t\tvar msg = \"cannot proxy to \" + contentBase.target + \" (\" + err.message + \")\";\r\n\t\t\t\t\t\t\tthis.sockWrite(this.sockets, \"proxy-error\", [msg]);\r\n\t\t\t\t\t\t\tres.statusCode = 502;\r\n\t\t\t\t\t\t\tres.end();\r\n\t\t\t\t\t\t}.bind(this));\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t} else if(/^(https?:)?\\/\\//.test(contentBase)) {\r\n\t\t\t\t\t// Redirect every request to contentBase\r\n\t\t\t\t\tapp.get(\"*\", function(req, res) {\r\n\t\t\t\t\t\tres.writeHead(302, {\r\n\t\t\t\t\t\t\t'Location': contentBase + req.path + (req._parsedUrl.search || \"\")\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tres.end();\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t} else if(typeof contentBase === \"number\") {\r\n\t\t\t\t\t// Redirect every request to the port contentBase\r\n\t\t\t\t\tapp.get(\"*\", function(req, res) {\r\n\t\t\t\t\t\tres.writeHead(302, {\r\n\t\t\t\t\t\t\t'Location': \"//localhost:\" + contentBase + req.path + (req._parsedUrl.search || \"\")\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tres.end();\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// route content request\r\n\t\t\t\t\tapp.get(\"*\", express.static(contentBase), serveIndex(contentBase));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}.bind(this),\r\n\r\n\t\tmiddleware: function() {\r\n\t\t\t// include our middleware to ensure it is able to handle '/index.html' request after redirect\r\n\t\t\tapp.use(this.middleware);\r\n\t\t}.bind(this),\r\n\r\n\t\theaders: function() {\r\n\t\t\tapp.get(\"*\", this.setContentHeaders.bind(this));\r\n\t\t}.bind(this),\r\n\r\n\t\tmagicHtml: function() {\r\n\t\t\tapp.get(\"*\", this.serveMagicHtml.bind(this));\r\n\t\t}.bind(this),\r\n\r\n\t\tsetup: function() {\r\n\t\t\tif(typeof options.setup === \"function\")\r\n\t\t\t\toptions.setup(app);\r\n\t\t}.bind(this)\r\n\t};\r\n\r\n\tvar defaultFeatures = [\"setup\", \"headers\", \"middleware\"];\r\n\tif(options.proxy)\r\n\t\tdefaultFeatures.push(\"proxy\");\r\n\tif(options.historyApiFallback)\r\n\t\tdefaultFeatures.push(\"historyApiFallback\", \"middleware\");\r\n\tdefaultFeatures.push(\"magicHtml\");\r\n\tif(options.contentBase !== false)\r\n\t\tdefaultFeatures.push(\"contentBase\");\r\n\t// compress is placed last and uses unshift so that it will be the first middleware used\r\n\tif(options.compress)\r\n\t\tdefaultFeatures.unshift(\"compress\");\r\n\r\n\t(options.features || defaultFeatures).forEach(function(feature) {\r\n\t\tfeatures[feature]();\r\n\t}, this);\r\n\r\n\tif (options.https) {\r\n\t\t// for keep supporting CLI parameters\r\n\t\tif (typeof options.https === 'boolean') {\r\n\t\t\toptions.https = {\r\n\t\t\t\tkey: options.key,\r\n\t\t\t\tcert: options.cert,\r\n\t\t\t\tca: options.ca\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// using built-in self-signed certificate if no certificate was configured\r\n\t\toptions.https.key = options.https.key || fs.readFileSync(path.join(__dirname, \"../ssl/server.key\"));\r\n\t\toptions.https.cert = options.https.cert || fs.readFileSync(path.join(__dirname, \"../ssl/server.crt\"));\r\n\t\toptions.https.ca = options.https.ca || fs.readFileSync(path.join(__dirname, \"../ssl/ca.crt\"));\r\n\r\n\t\tthis.listeningApp = https.createServer(options.https, app);\r\n\t} else {\r\n\t\tthis.listeningApp = http.createServer(app);\r\n\t}\r\n}\r\n\r\nServer.prototype.use = function() {\r\n\tthis.app.use.apply(this.app, arguments);\r\n}\r\n\r\nServer.prototype.setContentHeaders = function(req, res, next) {\r\n\tif(this.headers) {\r\n\t\tfor(var name in this.headers) {\r\n\t\t\tres.setHeader(name, this.headers[name]);\r\n\t\t}\r\n\t}\r\n\r\n\tnext();\r\n}\r\n\r\n// delegate listen call and init sockjs\r\nServer.prototype.listen = function() {\r\n\tthis.listeningApp.listen.apply(this.listeningApp, arguments);\r\n\tvar sockServer = sockjs.createServer({\r\n\t\t// Limit useless logs\r\n\t\tlog: function(severity, line) {\r\n\t\t\tif (severity === \"error\") {\r\n\t\t\t\tconsole.log(line);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tsockServer.on(\"connection\", function(conn) {\r\n\t\tthis.sockets.push(conn);\r\n\r\n\t\t// Remove the connection when it's closed\r\n\t\tconn.on(\"close\", function() {\r\n\t\t\tvar connIndex = this.sockets.indexOf(conn);\r\n\t\t\tif (connIndex >= 0) {\r\n\t\t\t\tthis.sockets.splice(connIndex, 1);\r\n\t\t\t}\r\n\t\t}.bind(this));\r\n\t\t\r\n\t\tif(this.hot) this.sockWrite([conn], \"hot\");\r\n\t\tif(!this._stats) return;\r\n\t\tthis._sendStats([conn], this._stats.toJson(), true);\r\n\t}.bind(this));\r\n\r\n\tsockServer.installHandlers(this.listeningApp, {\r\n\t\tprefix: '/sockjs-node'\r\n\t});\r\n}\r\n\r\nServer.prototype.close = function() {\r\n\tthis.sockets.forEach(function(sock) {\r\n\t\tsock.close();\r\n\t});\r\n\tthis.sockets = [];\r\n\tthis.middleware.close();\r\n}\r\n\r\nServer.prototype.sockWrite = function(sockets, type, data) {\r\n\tsockets.forEach(function(sock) {\r\n\t\tsock.write(JSON.stringify({type: type, data: data}));\r\n\t});\r\n}\r\n\r\nServer.prototype.serveMagicHtml = function(req, res, next) {\r\n\tvar _path = req.path;\r\n\ttry {\r\n\t\tif(!this.middleware.fileSystem.statSync(this.middleware.getFilenameFromUrl(_path + \".js\")).isFile())\r\n\t\t\treturn next();\r\n\t\t// Serve a page that executes the javascript\r\n\t\tres.write('<!DOCTYPE html><html><head><meta charset=\"utf-8\"/></head><body><script type=\"text/javascript\" charset=\"utf-8\" src=\"');\r\n\t\tres.write(_path);\r\n\t\tres.write('.js');\r\n\t\tres.write(req._parsedUrl.search || \"\");\r\n\t\tres.end('\"></script></body></html>');\r\n\t} catch(e) { return next(); }\r\n}\r\n\r\n// send stats to a socket or multiple sockets\r\nServer.prototype._sendStats = function(sockets, stats, force) {\r\n\tif(!force && stats && (!stats.errors || stats.errors.length === 0) && stats.assets && stats.assets.every(function(asset) {\r\n\t\treturn !asset.emitted;\r\n\t})) return this.sockWrite(sockets, \"still-ok\");\r\n\tthis.sockWrite(sockets, \"hash\", stats.hash);\r\n\tif(stats.errors.length > 0)\r\n\t\tthis.sockWrite(sockets, \"errors\", stats.errors);\r\n\telse if(stats.warnings.length > 0)\r\n\t\tthis.sockWrite(sockets, \"warnings\", stats.warnings);\r\n\telse\r\n\t\tthis.sockWrite(sockets, \"ok\");\r\n}\r\n\r\nServer.prototype.invalidate = function() {\r\n\tif(this.middleware) this.middleware.invalidate();\r\n}\r\n\r\nmodule.exports = Server;\r\n"]}