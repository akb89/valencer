{"version":3,"sources":["rfc4253.js"],"names":[],"mappings":"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","file":"rfc4253-compiled.js","sourcesContent":["// Copyright 2015 Joyent, Inc.\n\nmodule.exports = {\n\tread: read.bind(undefined, false, undefined),\n\treadType: read.bind(undefined, false),\n\twrite: write,\n\t/* semi-private api, used by sshpk-agent */\n\treadPartial: read.bind(undefined, true),\n\n\t/* shared with ssh format */\n\treadInternal: read,\n\tkeyTypeToAlg: keyTypeToAlg,\n\talgToKeyType: algToKeyType\n};\n\nvar assert = require('assert-plus');\nvar algs = require('../algs');\nvar utils = require('../utils');\nvar Key = require('../key');\nvar PrivateKey = require('../private-key');\nvar SSHBuffer = require('../ssh-buffer');\n\nfunction algToKeyType(alg) {\n\tassert.string(alg);\n\tif (alg === 'ssh-dss')\n\t\treturn ('dsa');\n\telse if (alg === 'ssh-rsa')\n\t\treturn ('rsa');\n\telse if (alg === 'ssh-ed25519')\n\t\treturn ('ed25519');\n\telse if (alg === 'ssh-curve25519')\n\t\treturn ('curve25519');\n\telse if (alg.match(/^ecdsa-sha2-/))\n\t\treturn ('ecdsa');\n\telse\n\t\tthrow (new Error('Unknown algorithm ' + alg));\n}\n\nfunction keyTypeToAlg(key) {\n\tassert.object(key);\n\tif (key.type === 'dsa')\n\t\treturn ('ssh-dss');\n\telse if (key.type === 'rsa')\n\t\treturn ('ssh-rsa');\n\telse if (key.type === 'ed25519')\n\t\treturn ('ssh-ed25519');\n\telse if (key.type === 'curve25519')\n\t\treturn ('ssh-curve25519');\n\telse if (key.type === 'ecdsa')\n\t\treturn ('ecdsa-sha2-' + key.part.curve.data.toString());\n\telse\n\t\tthrow (new Error('Unknown key type ' + key.type));\n}\n\nfunction read(partial, type, buf) {\n\tif (typeof (buf) === 'string')\n\t\tbuf = new Buffer(buf);\n\tassert.buffer(buf, 'buf');\n\n\tvar key = {};\n\n\tvar parts = key.parts = [];\n\tvar sshbuf = new SSHBuffer({buffer: buf});\n\n\tvar alg = sshbuf.readString();\n\tassert.ok(!sshbuf.atEnd(), 'key must have at least one part');\n\n\tkey.type = algToKeyType(alg);\n\n\tvar partCount = algs.info[key.type].parts.length;\n\tif (type && type === 'private')\n\t\tpartCount = algs.privInfo[key.type].parts.length;\n\n\twhile (!sshbuf.atEnd() && parts.length < partCount)\n\t\tparts.push(sshbuf.readPart());\n\twhile (!partial && !sshbuf.atEnd())\n\t\tparts.push(sshbuf.readPart());\n\n\tassert.ok(parts.length >= 1,\n\t    'key must have at least one part');\n\tassert.ok(partial || sshbuf.atEnd(),\n\t    'leftover bytes at end of key');\n\n\tvar Constructor = Key;\n\tvar algInfo = algs.info[key.type];\n\tif (type === 'private' || algInfo.parts.length !== parts.length) {\n\t\talgInfo = algs.privInfo[key.type];\n\t\tConstructor = PrivateKey;\n\t}\n\tassert.strictEqual(algInfo.parts.length, parts.length);\n\n\tif (key.type === 'ecdsa') {\n\t\tvar res = /^ecdsa-sha2-(.+)$/.exec(alg);\n\t\tassert.ok(res !== null);\n\t\tassert.strictEqual(res[1], parts[0].data.toString());\n\t}\n\n\tvar normalized = true;\n\tfor (var i = 0; i < algInfo.parts.length; ++i) {\n\t\tparts[i].name = algInfo.parts[i];\n\t\tif (parts[i].name !== 'curve' &&\n\t\t    algInfo.normalize !== false) {\n\t\t\tvar p = parts[i];\n\t\t\tvar nd = utils.mpNormalize(p.data);\n\t\t\tif (nd !== p.data) {\n\t\t\t\tp.data = nd;\n\t\t\t\tnormalized = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (normalized)\n\t\tkey._rfc4253Cache = sshbuf.toBuffer();\n\n\tif (partial && typeof (partial) === 'object') {\n\t\tpartial.remainder = sshbuf.remainder();\n\t\tpartial.consumed = sshbuf._offset;\n\t}\n\n\treturn (new Constructor(key));\n}\n\nfunction write(key) {\n\tassert.object(key);\n\n\tvar alg = keyTypeToAlg(key);\n\tvar i;\n\n\tvar algInfo = algs.info[key.type];\n\tif (PrivateKey.isPrivateKey(key))\n\t\talgInfo = algs.privInfo[key.type];\n\tvar parts = algInfo.parts;\n\n\tvar buf = new SSHBuffer({});\n\n\tbuf.writeString(alg);\n\n\tfor (i = 0; i < parts.length; ++i) {\n\t\tvar data = key.part[parts[i]].data;\n\t\tif (algInfo.normalize !== false)\n\t\t\tdata = utils.mpNormalize(data);\n\t\tbuf.writeBuffer(data);\n\t}\n\n\treturn (buf.toBuffer());\n}\n"]}