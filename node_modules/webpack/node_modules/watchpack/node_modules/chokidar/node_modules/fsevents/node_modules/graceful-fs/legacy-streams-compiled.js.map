{"version":3,"sources":["legacy-streams.js"],"names":[],"mappings":"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","file":"legacy-streams-compiled.js","sourcesContent":["var Stream = require('stream').Stream\n\nmodule.exports = legacy\n\nfunction legacy (fs) {\n  return {\n    ReadStream: ReadStream,\n    WriteStream: WriteStream\n  }\n\n  function ReadStream (path, options) {\n    if (!(this instanceof ReadStream)) return new ReadStream(path, options);\n\n    Stream.call(this);\n\n    var self = this;\n\n    this.path = path;\n    this.fd = null;\n    this.readable = true;\n    this.paused = false;\n\n    this.flags = 'r';\n    this.mode = 438; /*=0666*/\n    this.bufferSize = 64 * 1024;\n\n    options = options || {};\n\n    // Mixin options into this\n    var keys = Object.keys(options);\n    for (var index = 0, length = keys.length; index < length; index++) {\n      var key = keys[index];\n      this[key] = options[key];\n    }\n\n    if (this.encoding) this.setEncoding(this.encoding);\n\n    if (this.start !== undefined) {\n      if ('number' !== typeof this.start) {\n        throw TypeError('start must be a Number');\n      }\n      if (this.end === undefined) {\n        this.end = Infinity;\n      } else if ('number' !== typeof this.end) {\n        throw TypeError('end must be a Number');\n      }\n\n      if (this.start > this.end) {\n        throw new Error('start must be <= end');\n      }\n\n      this.pos = this.start;\n    }\n\n    if (this.fd !== null) {\n      process.nextTick(function() {\n        self._read();\n      });\n      return;\n    }\n\n    fs.open(this.path, this.flags, this.mode, function (err, fd) {\n      if (err) {\n        self.emit('error', err);\n        self.readable = false;\n        return;\n      }\n\n      self.fd = fd;\n      self.emit('open', fd);\n      self._read();\n    })\n  }\n\n  function WriteStream (path, options) {\n    if (!(this instanceof WriteStream)) return new WriteStream(path, options);\n\n    Stream.call(this);\n\n    this.path = path;\n    this.fd = null;\n    this.writable = true;\n\n    this.flags = 'w';\n    this.encoding = 'binary';\n    this.mode = 438; /*=0666*/\n    this.bytesWritten = 0;\n\n    options = options || {};\n\n    // Mixin options into this\n    var keys = Object.keys(options);\n    for (var index = 0, length = keys.length; index < length; index++) {\n      var key = keys[index];\n      this[key] = options[key];\n    }\n\n    if (this.start !== undefined) {\n      if ('number' !== typeof this.start) {\n        throw TypeError('start must be a Number');\n      }\n      if (this.start < 0) {\n        throw new Error('start must be >= zero');\n      }\n\n      this.pos = this.start;\n    }\n\n    this.busy = false;\n    this._queue = [];\n\n    if (this.fd === null) {\n      this._open = fs.open;\n      this._queue.push([this._open, this.path, this.flags, this.mode, undefined]);\n      this.flush();\n    }\n  }\n}\n"]}