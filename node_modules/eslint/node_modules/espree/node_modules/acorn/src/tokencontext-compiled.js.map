{"version":3,"sources":["tokencontext.js"],"names":[],"mappings":"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","file":"tokencontext-compiled.js","sourcesContent":["// The algorithm used to determine whether a regexp can appear at a\n// given point in the program is loosely based on sweet.js' approach.\n// See https://github.com/mozilla/sweet.js/wiki/design\n\nimport {Parser} from \"./state\"\nimport {types as tt} from \"./tokentype\"\nimport {lineBreak} from \"./whitespace\"\n\nexport class TokContext {\n  constructor(token, isExpr, preserveSpace, override) {\n    this.token = token\n    this.isExpr = !!isExpr\n    this.preserveSpace = !!preserveSpace\n    this.override = override\n  }\n}\n\nexport const types = {\n  b_stat: new TokContext(\"{\", false),\n  b_expr: new TokContext(\"{\", true),\n  b_tmpl: new TokContext(\"${\", true),\n  p_stat: new TokContext(\"(\", false),\n  p_expr: new TokContext(\"(\", true),\n  q_tmpl: new TokContext(\"`\", true, true, p => p.readTmplToken()),\n  f_expr: new TokContext(\"function\", true)\n}\n\nconst pp = Parser.prototype\n\npp.initialContext = function() {\n  return [types.b_stat]\n}\n\npp.braceIsBlock = function(prevType) {\n  if (prevType === tt.colon) {\n    let parent = this.curContext()\n    if (parent === types.b_stat || parent === types.b_expr)\n      return !parent.isExpr\n  }\n  if (prevType === tt._return)\n    return lineBreak.test(this.input.slice(this.lastTokEnd, this.start))\n  if (prevType === tt._else || prevType === tt.semi || prevType === tt.eof || prevType === tt.parenR)\n    return true\n  if (prevType == tt.braceL)\n    return this.curContext() === types.b_stat\n  return !this.exprAllowed\n}\n\npp.updateContext = function(prevType) {\n  let update, type = this.type\n  if (type.keyword && prevType == tt.dot)\n    this.exprAllowed = false\n  else if (update = type.updateContext)\n    update.call(this, prevType)\n  else\n    this.exprAllowed = type.beforeExpr\n}\n\n// Token-specific context update code\n\ntt.parenR.updateContext = tt.braceR.updateContext = function() {\n  if (this.context.length == 1) {\n    this.exprAllowed = true\n    return\n  }\n  let out = this.context.pop()\n  if (out === types.b_stat && this.curContext() === types.f_expr) {\n    this.context.pop()\n    this.exprAllowed = false\n  } else if (out === types.b_tmpl) {\n    this.exprAllowed = true\n  } else {\n    this.exprAllowed = !out.isExpr\n  }\n}\n\ntt.braceL.updateContext = function(prevType) {\n  this.context.push(this.braceIsBlock(prevType) ? types.b_stat : types.b_expr)\n  this.exprAllowed = true\n}\n\ntt.dollarBraceL.updateContext = function() {\n  this.context.push(types.b_tmpl)\n  this.exprAllowed = true\n}\n\ntt.parenL.updateContext = function(prevType) {\n  let statementParens = prevType === tt._if || prevType === tt._for || prevType === tt._with || prevType === tt._while\n  this.context.push(statementParens ? types.p_stat : types.p_expr)\n  this.exprAllowed = true\n}\n\ntt.incDec.updateContext = function() {\n  // tokExprAllowed stays unchanged\n}\n\ntt._function.updateContext = function(prevType) {\n  if (prevType.beforeExpr && prevType !== tt.semi && prevType !== tt._else &&\n      (prevType !== tt.colon || this.curContext() !== types.b_stat))\n    this.context.push(types.f_expr)\n  this.exprAllowed = false\n}\n\ntt.backQuote.updateContext = function() {\n  if (this.curContext() === types.q_tmpl)\n    this.context.pop()\n  else\n    this.context.push(types.q_tmpl)\n  this.exprAllowed = false\n}\n"]}