{"version":3,"sources":["cancel.js"],"names":[],"mappings":"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","file":"cancel-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, PromiseArray, apiRejection, debug) {\nvar util = require(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nPromise.prototype[\"break\"] = Promise.prototype.cancel = function() {\n    if (!debug.cancellation()) return this._warn(\"cancellation is disabled\");\n\n    var promise = this;\n    var child = promise;\n    while (promise.isCancellable()) {\n        if (!promise._cancelBy(child)) {\n            if (child._isFollowing()) {\n                child._followee().cancel();\n            } else {\n                child._cancelBranched();\n            }\n            break;\n        }\n\n        var parent = promise._cancellationParent;\n        if (parent == null || !parent.isCancellable()) {\n            if (promise._isFollowing()) {\n                promise._followee().cancel();\n            } else {\n                promise._cancelBranched();\n            }\n            break;\n        } else {\n            if (promise._isFollowing()) promise._followee().cancel();\n            child = promise;\n            promise = parent;\n        }\n    }\n};\n\nPromise.prototype._branchHasCancelled = function() {\n    this._branchesRemainingToCancel--;\n};\n\nPromise.prototype._enoughBranchesHaveCancelled = function() {\n    return this._branchesRemainingToCancel === undefined ||\n           this._branchesRemainingToCancel <= 0;\n};\n\nPromise.prototype._cancelBy = function(canceller) {\n    if (canceller === this) {\n        this._branchesRemainingToCancel = 0;\n        this._invokeOnCancel();\n        return true;\n    } else {\n        this._branchHasCancelled();\n        if (this._enoughBranchesHaveCancelled()) {\n            this._invokeOnCancel();\n            return true;\n        }\n    }\n    return false;\n};\n\nPromise.prototype._cancelBranched = function() {\n    if (this._enoughBranchesHaveCancelled()) {\n        this._cancel();\n    }\n};\n\nPromise.prototype._cancel = function() {\n    if (!this.isCancellable()) return;\n\n    this._setCancelled();\n    async.invoke(this._cancelPromises, this, undefined);\n};\n\nPromise.prototype._cancelPromises = function() {\n    if (this._length() > 0) this._settlePromises();\n};\n\nPromise.prototype._unsetOnCancel = function() {\n    this._onCancelField = undefined;\n};\n\nPromise.prototype.isCancellable = function() {\n    return this.isPending() && !this.isCancelled();\n};\n\nPromise.prototype._doInvokeOnCancel = function(onCancelCallback, internalOnly) {\n    if (util.isArray(onCancelCallback)) {\n        for (var i = 0; i < onCancelCallback.length; ++i) {\n            this._doInvokeOnCancel(onCancelCallback[i], internalOnly);\n        }\n    } else if (onCancelCallback !== undefined) {\n        if (typeof onCancelCallback === \"function\") {\n            if (!internalOnly) {\n                var e = tryCatch(onCancelCallback).call(this._boundValue());\n                if (e === errorObj) {\n                    this._attachExtraTrace(e.e);\n                    async.throwLater(e.e);\n                }\n            }\n        } else {\n            onCancelCallback._resultCancelled(this);\n        }\n    }\n};\n\nPromise.prototype._invokeOnCancel = function() {\n    var onCancelCallback = this._onCancel();\n    this._unsetOnCancel();\n    async.invoke(this._doInvokeOnCancel, this, onCancelCallback);\n};\n\nPromise.prototype._invokeInternalOnCancel = function() {\n    if (this.isCancellable()) {\n        this._doInvokeOnCancel(this._onCancel(), true);\n        this._unsetOnCancel();\n    }\n};\n\nPromise.prototype._resultCancelled = function() {\n    this.cancel();\n};\n\n};\n"]}