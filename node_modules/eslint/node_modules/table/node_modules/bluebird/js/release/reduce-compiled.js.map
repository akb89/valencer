{"version":3,"sources":["reduce.js"],"names":[],"mappings":"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","file":"reduce-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar getDomain = Promise._getDomain;\nvar util = require(\"./util\");\nvar tryCatch = util.tryCatch;\n\nfunction ReductionPromiseArray(promises, fn, initialValue, _each) {\n    this.constructor$(promises);\n    var domain = getDomain();\n    this._fn = domain === null ? fn : domain.bind(fn);\n    if (initialValue !== undefined) {\n        initialValue = Promise.resolve(initialValue);\n        initialValue._attachCancellationCallback(this);\n    }\n    this._initialValue = initialValue;\n    this._currentCancellable = null;\n    this._eachValues = _each === INTERNAL ? [] : undefined;\n    this._promise._captureStackTrace();\n    this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._gotAccum = function(accum) {\n    if (this._eachValues !== undefined && accum !== INTERNAL) {\n        this._eachValues.push(accum);\n    }\n};\n\nReductionPromiseArray.prototype._eachComplete = function(value) {\n    this._eachValues.push(value);\n    return this._eachValues;\n};\n\nReductionPromiseArray.prototype._init = function() {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function() {\n    this._resolve(this._eachValues !== undefined ? this._eachValues\n                                                 : this._initialValue);\n};\n\nReductionPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n};\n\nReductionPromiseArray.prototype._resolve = function(value) {\n    this._promise._resolveCallback(value);\n    this._values = null;\n};\n\nReductionPromiseArray.prototype._resultCancelled = function(sender) {\n    if (sender === this._initialValue) return this._cancel();\n    if (this._isResolved()) return;\n    this._resultCancelled$();\n    if (this._currentCancellable instanceof Promise) {\n        this._currentCancellable.cancel();\n    }\n    if (this._initialValue instanceof Promise) {\n        this._initialValue.cancel();\n    }\n};\n\nReductionPromiseArray.prototype._iterate = function (values) {\n    this._values = values;\n    var value;\n    var i;\n    var length = values.length;\n    if (this._initialValue !== undefined) {\n        value = this._initialValue;\n        i = 0;\n    } else {\n        value = Promise.resolve(values[0]);\n        i = 1;\n    }\n\n    this._currentCancellable = value;\n\n    if (!value.isRejected()) {\n        for (; i < length; ++i) {\n            var ctx = {\n                accum: null,\n                value: values[i],\n                index: i,\n                length: length,\n                array: this\n            };\n            value = value._then(gotAccum, undefined, undefined, ctx, undefined);\n        }\n    }\n\n    if (this._eachValues !== undefined) {\n        value = value\n            ._then(this._eachComplete, undefined, undefined, this, undefined);\n    }\n    value._then(completed, completed, undefined, value, this);\n};\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n\nfunction completed(valueOrReason, array) {\n    if (this.isFulfilled()) {\n        array._resolve(valueOrReason);\n    } else {\n        array._reject(valueOrReason);\n    }\n}\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nfunction gotAccum(accum) {\n    this.accum = accum;\n    this.array._gotAccum(accum);\n    var value = tryConvertToPromise(this.value, this.array._promise);\n    if (value instanceof Promise) {\n        this.array._currentCancellable = value;\n        return value._then(gotValue, undefined, undefined, this, undefined);\n    } else {\n        return gotValue.call(this, value);\n    }\n}\n\nfunction gotValue(value) {\n    var array = this.array;\n    var promise = array._promise;\n    var fn = tryCatch(array._fn);\n    promise._pushContext();\n    var ret;\n    if (array._eachValues !== undefined) {\n        ret = fn.call(promise._boundValue(), value, this.index, this.length);\n    } else {\n        ret = fn.call(promise._boundValue(),\n                              this.accum, value, this.index, this.length);\n    }\n    if (ret instanceof Promise) {\n        array._currentCancellable = ret;\n    }\n    var promiseCreated = promise._popContext();\n    debug.checkForgottenReturns(\n        ret,\n        promiseCreated,\n        array._eachValues !== undefined ? \"Promise.each\" : \"Promise.reduce\",\n        promise\n    );\n    return ret;\n}\n};\n"]}