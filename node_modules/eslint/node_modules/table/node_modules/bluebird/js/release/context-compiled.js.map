{"version":3,"sources":["context.js"],"names":[],"mappings":"AAAA;;AACA,OAAO,OAAP,GAAiB,UAAS,OAAT,EAAkB;AACnC,QAAI,kBAAkB,KAAtB;AACA,QAAI,eAAe,EAAnB;;AAEA,YAAQ,SAAR,CAAkB,eAAlB,GAAoC,YAAW,CAAE,CAAjD;AACA,YAAQ,SAAR,CAAkB,YAAlB,GAAiC,YAAW,CAAE,CAA9C;AACA,YAAQ,SAAR,CAAkB,WAAlB,GAAgC,YAAW;AAAC,eAAO,IAAP;AAAa,KAAzD;AACA,YAAQ,YAAR,GAAuB,QAAQ,SAAR,CAAkB,YAAlB,GAAiC,YAAW,CAAE,CAArE;;AAEA,aAAS,OAAT,GAAmB;AACf,aAAK,MAAL,GAAc,IAAI,QAAQ,aAAZ,CAA0B,aAA1B,CAAd;AACH;AACD,YAAQ,SAAR,CAAkB,YAAlB,GAAiC,YAAY;AACzC,YAAI,KAAK,MAAL,KAAgB,SAApB,EAA+B;AAC3B,iBAAK,MAAL,CAAY,eAAZ,GAA8B,IAA9B;AACA,yBAAa,IAAb,CAAkB,KAAK,MAAvB;AACH;AACJ,KALD;;AAOA,YAAQ,SAAR,CAAkB,WAAlB,GAAgC,YAAY;AACxC,YAAI,KAAK,MAAL,KAAgB,SAApB,EAA+B;AAC3B,gBAAI,QAAQ,aAAa,GAAb,EAAZ;AACA,gBAAI,MAAM,MAAM,eAAhB;AACA,kBAAM,eAAN,GAAwB,IAAxB;AACA,mBAAO,GAAP;AACH;AACD,eAAO,IAAP;AACH,KARD;;AAUA,aAAS,aAAT,GAAyB;AACrB,YAAI,eAAJ,EAAqB,OAAO,IAAI,OAAJ,EAAP;AACxB;;AAED,aAAS,WAAT,GAAuB;AACnB,YAAI,YAAY,aAAa,MAAb,GAAsB,CAAtC;AACA,YAAI,aAAa,CAAjB,EAAoB;AAChB,mBAAO,aAAa,SAAb,CAAP;AACH;AACD,eAAO,SAAP;AACH;AACD,YAAQ,aAAR,GAAwB,IAAxB;AACA,YAAQ,MAAR,GAAiB,aAAjB;AACA,YAAQ,yBAAR,GAAoC,YAAW,CAAE,CAAjD;AACA,YAAQ,uBAAR,GAAkC,YAAW;AACzC,YAAI,sBAAsB,QAAQ,SAAR,CAAkB,YAA5C;AACA,YAAI,qBAAqB,QAAQ,SAAR,CAAkB,WAA3C;AACA,YAAI,sBAAsB,QAAQ,YAAlC;AACA,YAAI,sBAAsB,QAAQ,SAAR,CAAkB,YAA5C;AACA,YAAI,yBAAyB,QAAQ,SAAR,CAAkB,eAA/C;AACA,gBAAQ,yBAAR,GAAoC,YAAW;AAC3C,oBAAQ,SAAR,CAAkB,YAAlB,GAAiC,mBAAjC;AACA,oBAAQ,SAAR,CAAkB,WAAlB,GAAgC,kBAAhC;AACA,oBAAQ,YAAR,GAAuB,mBAAvB;AACA,oBAAQ,SAAR,CAAkB,YAAlB,GAAiC,mBAAjC;AACA,oBAAQ,SAAR,CAAkB,eAAlB,GAAoC,sBAApC;AACA,8BAAkB,KAAlB;AACH,SAPD;AAQA,0BAAkB,IAAlB;AACA,gBAAQ,SAAR,CAAkB,YAAlB,GAAiC,QAAQ,SAAR,CAAkB,YAAnD;AACA,gBAAQ,SAAR,CAAkB,WAAlB,GAAgC,QAAQ,SAAR,CAAkB,WAAlD;AACA,gBAAQ,YAAR,GAAuB,QAAQ,SAAR,CAAkB,YAAlB,GAAiC,WAAxD;AACA,gBAAQ,SAAR,CAAkB,eAAlB,GAAoC,YAAW;AAC3C,gBAAI,MAAM,KAAK,YAAL,EAAV;AACA,gBAAI,OAAO,IAAI,eAAJ,IAAuB,IAAlC,EAAwC,IAAI,eAAJ,GAAsB,IAAtB;AAC3C,SAHD;AAIH,KAtBD;AAuBA,WAAO,OAAP;AACC,CAnED","file":"context-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise) {\nvar longStackTraces = false;\nvar contextStack = [];\n\nPromise.prototype._promiseCreated = function() {};\nPromise.prototype._pushContext = function() {};\nPromise.prototype._popContext = function() {return null;};\nPromise._peekContext = Promise.prototype._peekContext = function() {};\n\nfunction Context() {\n    this._trace = new Context.CapturedTrace(peekContext());\n}\nContext.prototype._pushContext = function () {\n    if (this._trace !== undefined) {\n        this._trace._promiseCreated = null;\n        contextStack.push(this._trace);\n    }\n};\n\nContext.prototype._popContext = function () {\n    if (this._trace !== undefined) {\n        var trace = contextStack.pop();\n        var ret = trace._promiseCreated;\n        trace._promiseCreated = null;\n        return ret;\n    }\n    return null;\n};\n\nfunction createContext() {\n    if (longStackTraces) return new Context();\n}\n\nfunction peekContext() {\n    var lastIndex = contextStack.length - 1;\n    if (lastIndex >= 0) {\n        return contextStack[lastIndex];\n    }\n    return undefined;\n}\nContext.CapturedTrace = null;\nContext.create = createContext;\nContext.deactivateLongStackTraces = function() {};\nContext.activateLongStackTraces = function() {\n    var Promise_pushContext = Promise.prototype._pushContext;\n    var Promise_popContext = Promise.prototype._popContext;\n    var Promise_PeekContext = Promise._peekContext;\n    var Promise_peekContext = Promise.prototype._peekContext;\n    var Promise_promiseCreated = Promise.prototype._promiseCreated;\n    Context.deactivateLongStackTraces = function() {\n        Promise.prototype._pushContext = Promise_pushContext;\n        Promise.prototype._popContext = Promise_popContext;\n        Promise._peekContext = Promise_PeekContext;\n        Promise.prototype._peekContext = Promise_peekContext;\n        Promise.prototype._promiseCreated = Promise_promiseCreated;\n        longStackTraces = false;\n    };\n    longStackTraces = true;\n    Promise.prototype._pushContext = Context.prototype._pushContext;\n    Promise.prototype._popContext = Context.prototype._popContext;\n    Promise._peekContext = Promise.prototype._peekContext = peekContext;\n    Promise.prototype._promiseCreated = function() {\n        var ctx = this._peekContext();\n        if (ctx && ctx._promiseCreated == null) ctx._promiseCreated = this;\n    };\n};\nreturn Context;\n};\n"]}