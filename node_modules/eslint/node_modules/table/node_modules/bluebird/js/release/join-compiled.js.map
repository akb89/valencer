{"version":3,"sources":["join.js"],"names":[],"mappings":"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","file":"join-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, tryConvertToPromise, INTERNAL) {\nvar util = require(\"./util\");\nvar canEvaluate = util.canEvaluate;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar reject;\n\nif (!false) {\nif (canEvaluate) {\n    var thenCallback = function(i) {\n        return new Function(\"value\", \"holder\", \"                             \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = value;                                           \\n\\\n            holder.checkFulfillment(this);                                   \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var promiseSetter = function(i) {\n        return new Function(\"promise\", \"holder\", \"                           \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = promise;                                         \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var generateHolderClass = function(total) {\n        var props = new Array(total);\n        for (var i = 0; i < props.length; ++i) {\n            props[i] = \"this.p\" + (i+1);\n        }\n        var assignment = props.join(\" = \") + \" = null;\";\n        var cancellationCode= \"var promise;\\n\" + props.map(function(prop) {\n            return \"                                                         \\n\\\n                promise = \" + prop + \";                                      \\n\\\n                if (promise instanceof Promise) {                            \\n\\\n                    promise.cancel();                                        \\n\\\n                }                                                            \\n\\\n            \";\n        }).join(\"\\n\");\n        var passedArguments = props.join(\", \");\n        var name = \"Holder$\" + total;\n\n\n        var code = \"return function(tryCatch, errorObj, Promise) {           \\n\\\n            'use strict';                                                    \\n\\\n            function [TheName](fn) {                                         \\n\\\n                [TheProperties]                                              \\n\\\n                this.fn = fn;                                                \\n\\\n                this.now = 0;                                                \\n\\\n            }                                                                \\n\\\n            [TheName].prototype.checkFulfillment = function(promise) {       \\n\\\n                var now = ++this.now;                                        \\n\\\n                if (now === [TheTotal]) {                                    \\n\\\n                    promise._pushContext();                                  \\n\\\n                    var callback = this.fn;                                  \\n\\\n                    var ret = tryCatch(callback)([ThePassedArguments]);      \\n\\\n                    promise._popContext();                                   \\n\\\n                    if (ret === errorObj) {                                  \\n\\\n                        promise._rejectCallback(ret.e, false);               \\n\\\n                    } else {                                                 \\n\\\n                        promise._resolveCallback(ret);                       \\n\\\n                    }                                                        \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype._resultCancelled = function() {              \\n\\\n                [CancellationCode]                                           \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            return [TheName];                                                \\n\\\n        }(tryCatch, errorObj, Promise);                                      \\n\\\n        \";\n\n        code = code.replace(/\\[TheName\\]/g, name)\n            .replace(/\\[TheTotal\\]/g, total)\n            .replace(/\\[ThePassedArguments\\]/g, passedArguments)\n            .replace(/\\[TheProperties\\]/g, assignment)\n            .replace(/\\[CancellationCode\\]/g, cancellationCode);\n\n        return new Function(\"tryCatch\", \"errorObj\", \"Promise\", code)\n                           (tryCatch, errorObj, Promise);\n    };\n\n    var holderClasses = [];\n    var thenCallbacks = [];\n    var promiseSetters = [];\n\n    for (var i = 0; i < 8; ++i) {\n        holderClasses.push(generateHolderClass(i + 1));\n        thenCallbacks.push(thenCallback(i + 1));\n        promiseSetters.push(promiseSetter(i + 1));\n    }\n\n    reject = function (reason) {\n        this._reject(reason);\n    };\n}}\n\nPromise.join = function () {\n    var last = arguments.length - 1;\n    var fn;\n    if (last > 0 && typeof arguments[last] === \"function\") {\n        fn = arguments[last];\n        if (!false) {\n            if (last <= 8 && canEvaluate) {\n                var ret = new Promise(INTERNAL);\n                ret._captureStackTrace();\n                var HolderClass = holderClasses[last - 1];\n                var holder = new HolderClass(fn);\n                var callbacks = thenCallbacks;\n\n                for (var i = 0; i < last; ++i) {\n                    var maybePromise = tryConvertToPromise(arguments[i], ret);\n                    if (maybePromise instanceof Promise) {\n                        maybePromise = maybePromise._target();\n                        var bitField = maybePromise._bitField;\n                        ;\n                        if (((bitField & 50397184) === 0)) {\n                            maybePromise._then(callbacks[i], reject,\n                                               undefined, ret, holder);\n                            promiseSetters[i](maybePromise, holder);\n                        } else if (((bitField & 33554432) !== 0)) {\n                            callbacks[i].call(ret,\n                                              maybePromise._value(), holder);\n                        } else if (((bitField & 16777216) !== 0)) {\n                            ret._reject(maybePromise._reason());\n                        } else {\n                            ret._cancel();\n                        }\n                    } else {\n                        callbacks[i].call(ret, maybePromise, holder);\n                    }\n                }\n                if (!ret._isFateSealed()) {\n                    ret._setAsyncGuaranteed();\n                    ret._setOnCancel(holder);\n                }\n                return ret;\n            }\n        }\n    }\n    var $_len = arguments.length;var args = new Array($_len); for(var $_i = 0; $_i < $_len; ++$_i) {args[$_i] = arguments[$_i];};\n    if (fn) args.pop();\n    var ret = new PromiseArray(args).promise();\n    return fn !== undefined ? ret.spread(fn) : ret;\n};\n\n};\n"]}