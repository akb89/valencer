{"version":3,"sources":["promisify.js"],"names":[],"mappings":"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","file":"promisify-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar THIS = {};\nvar util = require(\"./util\");\nvar nodebackForPromise = require(\"./nodeback\");\nvar withAppended = util.withAppended;\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar canEvaluate = util.canEvaluate;\nvar TypeError = require(\"./errors\").TypeError;\nvar defaultSuffix = \"Async\";\nvar defaultPromisified = {__isPromisified__: true};\nvar noCopyProps = [\n    \"arity\",    \"length\",\n    \"name\",\n    \"arguments\",\n    \"caller\",\n    \"callee\",\n    \"prototype\",\n    \"__isPromisified__\"\n];\nvar noCopyPropsPattern = new RegExp(\"^(?:\" + noCopyProps.join(\"|\") + \")$\");\n\nvar defaultFilter = function(name) {\n    return util.isIdentifier(name) &&\n        name.charAt(0) !== \"_\" &&\n        name !== \"constructor\";\n};\n\nfunction propsFilter(key) {\n    return !noCopyPropsPattern.test(key);\n}\n\nfunction isPromisified(fn) {\n    try {\n        return fn.__isPromisified__ === true;\n    }\n    catch (e) {\n        return false;\n    }\n}\n\nfunction hasPromisified(obj, key, suffix) {\n    var val = util.getDataPropertyOrDefault(obj, key + suffix,\n                                            defaultPromisified);\n    return val ? isPromisified(val) : false;\n}\nfunction checkValid(ret, suffix, suffixRegexp) {\n    for (var i = 0; i < ret.length; i += 2) {\n        var key = ret[i];\n        if (suffixRegexp.test(key)) {\n            var keyWithoutAsyncSuffix = key.replace(suffixRegexp, \"\");\n            for (var j = 0; j < ret.length; j += 2) {\n                if (ret[j] === keyWithoutAsyncSuffix) {\n                    throw new TypeError(\"Cannot promisify an API that has normal methods with '%s'-suffix\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\"\n                        .replace(\"%s\", suffix));\n                }\n            }\n        }\n    }\n}\n\nfunction promisifiableMethods(obj, suffix, suffixRegexp, filter) {\n    var keys = util.inheritedDataKeys(obj);\n    var ret = [];\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        var value = obj[key];\n        var passesDefaultFilter = filter === defaultFilter\n            ? true : defaultFilter(key, value, obj);\n        if (typeof value === \"function\" &&\n            !isPromisified(value) &&\n            !hasPromisified(obj, key, suffix) &&\n            filter(key, value, obj, passesDefaultFilter)) {\n            ret.push(key, value);\n        }\n    }\n    checkValid(ret, suffix, suffixRegexp);\n    return ret;\n}\n\nvar escapeIdentRegex = function(str) {\n    return str.replace(/([$])/, \"\\\\$\");\n};\n\nvar makeNodePromisifiedEval;\nif (!false) {\nvar switchCaseArgumentOrder = function(likelyArgumentCount) {\n    var ret = [likelyArgumentCount];\n    var min = Math.max(0, likelyArgumentCount - 1 - 3);\n    for(var i = likelyArgumentCount - 1; i >= min; --i) {\n        ret.push(i);\n    }\n    for(var i = likelyArgumentCount + 1; i <= 3; ++i) {\n        ret.push(i);\n    }\n    return ret;\n};\n\nvar argumentSequence = function(argumentCount) {\n    return util.filledRange(argumentCount, \"_arg\", \"\");\n};\n\nvar parameterDeclaration = function(parameterCount) {\n    return util.filledRange(\n        Math.max(parameterCount, 3), \"_arg\", \"\");\n};\n\nvar parameterCount = function(fn) {\n    if (typeof fn.length === \"number\") {\n        return Math.max(Math.min(fn.length, 1023 + 1), 0);\n    }\n    return 0;\n};\n\nmakeNodePromisifiedEval =\nfunction(callback, receiver, originalName, fn, _, multiArgs) {\n    var newParameterCount = Math.max(0, parameterCount(fn) - 1);\n    var argumentOrder = switchCaseArgumentOrder(newParameterCount);\n    var shouldProxyThis = typeof callback === \"string\" || receiver === THIS;\n\n    function generateCallForArgumentCount(count) {\n        var args = argumentSequence(count).join(\", \");\n        var comma = count > 0 ? \", \" : \"\";\n        var ret;\n        if (shouldProxyThis) {\n            ret = \"ret = callback.call(this, {{args}}, nodeback); break;\\n\";\n        } else {\n            ret = receiver === undefined\n                ? \"ret = callback({{args}}, nodeback); break;\\n\"\n                : \"ret = callback.call(receiver, {{args}}, nodeback); break;\\n\";\n        }\n        return ret.replace(\"{{args}}\", args).replace(\", \", comma);\n    }\n\n    function generateArgumentSwitchCase() {\n        var ret = \"\";\n        for (var i = 0; i < argumentOrder.length; ++i) {\n            ret += \"case \" + argumentOrder[i] +\":\" +\n                generateCallForArgumentCount(argumentOrder[i]);\n        }\n\n        ret += \"                                                             \\n\\\n        default:                                                             \\n\\\n            var args = new Array(len + 1);                                   \\n\\\n            var i = 0;                                                       \\n\\\n            for (var i = 0; i < len; ++i) {                                  \\n\\\n               args[i] = arguments[i];                                       \\n\\\n            }                                                                \\n\\\n            args[i] = nodeback;                                              \\n\\\n            [CodeForCall]                                                    \\n\\\n            break;                                                           \\n\\\n        \".replace(\"[CodeForCall]\", (shouldProxyThis\n                                ? \"ret = callback.apply(this, args);\\n\"\n                                : \"ret = callback.apply(receiver, args);\\n\"));\n        return ret;\n    }\n\n    var getFunctionCode = typeof callback === \"string\"\n                                ? (\"this != null ? this['\"+callback+\"'] : fn\")\n                                : \"fn\";\n    var body = \"'use strict';                                                \\n\\\n        var ret = function (Parameters) {                                    \\n\\\n            'use strict';                                                    \\n\\\n            var len = arguments.length;                                      \\n\\\n            var promise = new Promise(INTERNAL);                             \\n\\\n            promise._captureStackTrace();                                    \\n\\\n            var nodeback = nodebackForPromise(promise, \" + multiArgs + \");   \\n\\\n            var ret;                                                         \\n\\\n            var callback = tryCatch([GetFunctionCode]);                      \\n\\\n            switch(len) {                                                    \\n\\\n                [CodeForSwitchCase]                                          \\n\\\n            }                                                                \\n\\\n            if (ret === errorObj) {                                          \\n\\\n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\\n\\\n            }                                                                \\n\\\n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \\n\\\n            return promise;                                                  \\n\\\n        };                                                                   \\n\\\n        notEnumerableProp(ret, '__isPromisified__', true);                   \\n\\\n        return ret;                                                          \\n\\\n    \".replace(\"[CodeForSwitchCase]\", generateArgumentSwitchCase())\n        .replace(\"[GetFunctionCode]\", getFunctionCode);\n    body = body.replace(\"Parameters\", parameterDeclaration(newParameterCount));\n    return new Function(\"Promise\",\n                        \"fn\",\n                        \"receiver\",\n                        \"withAppended\",\n                        \"maybeWrapAsError\",\n                        \"nodebackForPromise\",\n                        \"tryCatch\",\n                        \"errorObj\",\n                        \"notEnumerableProp\",\n                        \"INTERNAL\",\n                        body)(\n                    Promise,\n                    fn,\n                    receiver,\n                    withAppended,\n                    maybeWrapAsError,\n                    nodebackForPromise,\n                    util.tryCatch,\n                    util.errorObj,\n                    util.notEnumerableProp,\n                    INTERNAL);\n};\n}\n\nfunction makeNodePromisifiedClosure(callback, receiver, _, fn, __, multiArgs) {\n    var defaultThis = (function() {return this;})();\n    var method = callback;\n    if (typeof method === \"string\") {\n        callback = fn;\n    }\n    function promisified() {\n        var _receiver = receiver;\n        if (receiver === THIS) _receiver = this;\n        var promise = new Promise(INTERNAL);\n        promise._captureStackTrace();\n        var cb = typeof method === \"string\" && this !== defaultThis\n            ? this[method] : callback;\n        var fn = nodebackForPromise(promise, multiArgs);\n        try {\n            cb.apply(_receiver, withAppended(arguments, fn));\n        } catch(e) {\n            promise._rejectCallback(maybeWrapAsError(e), true, true);\n        }\n        if (!promise._isFateSealed()) promise._setAsyncGuaranteed();\n        return promise;\n    }\n    util.notEnumerableProp(promisified, \"__isPromisified__\", true);\n    return promisified;\n}\n\nvar makeNodePromisified = canEvaluate\n    ? makeNodePromisifiedEval\n    : makeNodePromisifiedClosure;\n\nfunction promisifyAll(obj, suffix, filter, promisifier, multiArgs) {\n    var suffixRegexp = new RegExp(escapeIdentRegex(suffix) + \"$\");\n    var methods =\n        promisifiableMethods(obj, suffix, suffixRegexp, filter);\n\n    for (var i = 0, len = methods.length; i < len; i+= 2) {\n        var key = methods[i];\n        var fn = methods[i+1];\n        var promisifiedKey = key + suffix;\n        if (promisifier === makeNodePromisified) {\n            obj[promisifiedKey] =\n                makeNodePromisified(key, THIS, key, fn, suffix, multiArgs);\n        } else {\n            var promisified = promisifier(fn, function() {\n                return makeNodePromisified(key, THIS, key,\n                                           fn, suffix, multiArgs);\n            });\n            util.notEnumerableProp(promisified, \"__isPromisified__\", true);\n            obj[promisifiedKey] = promisified;\n        }\n    }\n    util.toFastProperties(obj);\n    return obj;\n}\n\nfunction promisify(callback, receiver, multiArgs) {\n    return makeNodePromisified(callback, receiver, undefined,\n                                callback, null, multiArgs);\n}\n\nPromise.promisify = function (fn, options) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    if (isPromisified(fn)) {\n        return fn;\n    }\n    options = Object(options);\n    var receiver = options.context === undefined ? THIS : options.context;\n    var multiArgs = !!options.multiArgs;\n    var ret = promisify(fn, receiver, multiArgs);\n    util.copyDescriptors(fn, ret, propsFilter);\n    return ret;\n};\n\nPromise.promisifyAll = function (target, options) {\n    if (typeof target !== \"function\" && typeof target !== \"object\") {\n        throw new TypeError(\"the target of promisifyAll must be an object or a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    options = Object(options);\n    var multiArgs = !!options.multiArgs;\n    var suffix = options.suffix;\n    if (typeof suffix !== \"string\") suffix = defaultSuffix;\n    var filter = options.filter;\n    if (typeof filter !== \"function\") filter = defaultFilter;\n    var promisifier = options.promisifier;\n    if (typeof promisifier !== \"function\") promisifier = makeNodePromisified;\n\n    if (!util.isIdentifier(suffix)) {\n        throw new RangeError(\"suffix must be a valid identifier\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n\n    var keys = util.inheritedDataKeys(target);\n    for (var i = 0; i < keys.length; ++i) {\n        var value = target[keys[i]];\n        if (keys[i] !== \"constructor\" &&\n            util.isClass(value)) {\n            promisifyAll(value.prototype, suffix, filter, promisifier,\n                multiArgs);\n            promisifyAll(value, suffix, filter, promisifier, multiArgs);\n        }\n    }\n\n    return promisifyAll(target, suffix, filter, promisifier, multiArgs);\n};\n};\n\n"]}